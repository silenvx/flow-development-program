---
name: hooks-reference
description: Claude Codeãƒ•ãƒƒã‚¯ã®è©³ç´°ä»•æ§˜ã€è¨­è¨ˆåŸå‰‡ã€è¨­å®šæ–¹æ³•ã€‚ãƒ•ãƒƒã‚¯ã€hookã€PreToolUseã€Stopæ™‚ã«ä½¿ç”¨ã€‚
---

# ãƒ•ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

Claude Codeãƒ•ãƒƒã‚¯ã®è©³ç´°ä»•æ§˜ã¨è¨­è¨ˆåŸå‰‡ã€‚

## æ–°è¦ãƒ•ãƒƒã‚¯å®Ÿè£…æ™‚ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼‰

æ–°ã—ã„ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹å‰ã«å¿…ãšç¢ºèªã™ã‚‹ã“ã¨ã€‚ã“ã‚Œã‚’æ€ ã‚‹ã¨CIã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã€‚

### é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ï¼ˆã‚ˆãã‚ã‚‹é–“é•ã„ï¼‰

| é–¢æ•° | æ­£ã—ã„å‘¼ã³å‡ºã— | ã‚ˆãã‚ã‚‹é–“é•ã„ |
|------|---------------|---------------|
| `make_approve_result` | `make_approve_result("hook-name")` | `make_approve_result()` â† å¼•æ•°å¿…é ˆ |
| `make_block_result` | `make_block_result("hook-name", "ç†ç”±")` | `make_block_result("ç†ç”±")` â† 2å¼•æ•°å¿…é ˆ |
| `log_hook_execution` | `log_hook_execution(..., decision="block")` | `log_hook_execution(..., result="block")` â† `decision=`ãŒæ­£ã—ã„ |

### JSONå‡ºåŠ›ï¼ˆå¿…é ˆï¼‰

```python
# âŒ æ‚ªã„ä¾‹: Pythonè¾æ›¸ã‚’ãã®ã¾ã¾å‡ºåŠ›
print(make_approve_result("my-hook"))  # {'decision': 'approve', ...}

# âœ… è‰¯ã„ä¾‹: json.dumpsã§JSONæ–‡å­—åˆ—ã«å¤‰æ›
print(json.dumps(make_approve_result("my-hook")))  # {"decision": "approve", ...}
```

**ç†ç”±**: Claude Codeã¯JSONå½¢å¼ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚Pythonè¾æ›¸å½¢å¼ï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆï¼‰ã¯è§£æã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCIå¿…é ˆï¼‰

æ–°è¦ãƒ•ãƒƒã‚¯ã«ã¯å¿…ãšãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹:

- **ãƒ•ã‚¡ã‚¤ãƒ«å**: `.claude/hooks/tests/test_<hookåï¼ˆã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢åŒºåˆ‡ã‚Šï¼‰>.py`
- **ä¾‹**: `issue-branch-check.py` â†’ `test_issue_branch_check.py`

CIã® `hook-test-requirement-check` ãŒãƒ†ã‚¹ãƒˆãªã—ã®æ–°è¦ãƒ•ãƒƒã‚¯ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã€‚

### æœ€å°å®Ÿè£…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```python
#!/usr/bin/env python3
"""ãƒ•ãƒƒã‚¯ã®èª¬æ˜."""
from __future__ import annotations

import json

from lib.execution import log_hook_execution
from lib.results import make_approve_result, make_block_result
from lib.session import parse_hook_input


def main() -> None:
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†."""
    hook_input = parse_hook_input()
    tool_name = hook_input.get("tool_name", "")

    # å¯¾è±¡å¤–ã¯ã‚¹ã‚­ãƒƒãƒ—
    if tool_name != "Bash":
        print(json.dumps(make_approve_result("my-hook")))
        return

    # ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
    # ...

    # ãƒ–ãƒ­ãƒƒã‚¯æ™‚
    print(json.dumps(make_block_result("my-hook", "ãƒ–ãƒ­ãƒƒã‚¯ç†ç”±")))
    log_hook_execution(
        hook_name="my-hook",
        decision="block",
        reason="ãƒ–ãƒ­ãƒƒã‚¯ç†ç”±",
    )


if __name__ == "__main__":
    main()
```

**è©³ç´°ã¯ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§**:

- [å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã®è©³ç´°ä»•æ§˜](#å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã®è©³ç´°ä»•æ§˜å¿…èª­)
- [ãƒ•ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](#ãƒ•ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)

## ãƒ•ãƒƒã‚¯å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

ãƒ•ãƒƒã‚¯ã¯JSONå½¢å¼ã§çµæœã‚’è¿”ã™:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | èª¬æ˜ |
|-----------|------|
| `decision` | `"approve"` ã¾ãŸã¯ `"block"` |
| `reason` | ãƒ–ãƒ­ãƒƒã‚¯ç†ç”±ï¼ˆClaudeã«é€ä¿¡ï¼‰ |
| `systemMessage` | ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |

### å‡ºåŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­è¨ˆ

ãƒ•ãƒƒã‚¯ã®å‡ºåŠ›ã¯ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ï¼ˆä¸è¦ãªå‡ºåŠ›ã‚’æœ€å°åŒ–ï¼‰:

| çŠ¶æ³ | JSONå‡ºåŠ› | exit code | ç†ç”± |
|------|----------|-----------|------|
| **å¯¾è±¡å¤–** | ãªã— | 0 | å¯¾è±¡å¤–ã§å‡ºåŠ›ã™ã‚‹ã¨ãƒ­ã‚°ãŒç…©é›‘ |
| **è¨±å¯** | ãªã— | 0 | æ­£å¸¸å‹•ä½œæ™‚ã¯æ²ˆé»™ãŒåŸå‰‡ |
| **ãƒ–ãƒ­ãƒƒã‚¯** | `{"decision": "block", "reason": "..."}` | 0 | æ˜ç¤ºçš„ãªæ‹’å¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¿…è¦ |
| **é€šçŸ¥** | `{"decision": "approve", "systemMessage": "..."}` | 0 | è¨±å¯ã—ã¤ã¤æƒ…å ±ã‚’ä¼é” |

**ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆlib/results.pyï¼‰**:
- `make_block_result(hook_name, reason)`: ãƒ–ãƒ­ãƒƒã‚¯çµæœã‚’ç”Ÿæˆ
- `make_approve_result(hook_name, message=None)`: è¨±å¯çµæœã‚’ç”Ÿæˆ

### å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã®è©³ç´°ä»•æ§˜ï¼ˆå¿…èª­ï¼‰

ãƒ•ãƒƒã‚¯å®Ÿè£…å‰ã«å¿…ãšç¢ºèªã™ã‚‹ã“ã¨ã€‚ã“ã‚Œã‚’æ€ ã‚‹ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æŒ‡æ‘˜ã•ã‚Œã‚‹ã€‚

#### `make_block_result(hook_name, reason)`

**è‡ªå‹•çš„ã«è¡Œã‚ã‚Œã‚‹å‡¦ç†**ï¼ˆæ‰‹å‹•ã§è¡Œã†å¿…è¦ãªã—ï¼‰:

| å‡¦ç† | è©³ç´° |
|------|------|
| **ãƒ­ã‚°è¨˜éŒ²** | `log_hook_execution(hook_name, "block", reason)` ã‚’å†…éƒ¨ã§å‘¼ã³å‡ºã™ï¼ˆIssue #2023ï¼‰ |
| **ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ä¸** | reasonã« `[{hook_name}]` ã‚’è‡ªå‹•è¿½åŠ  |
| **ç¶™ç¶šãƒ’ãƒ³ãƒˆä»˜ä¸** | reasonã« `CONTINUATION_HINT` ã‚’è‡ªå‹•è¿½åŠ  |
| **systemMessageç”Ÿæˆ** | ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤ºç”¨ã®systemMessageã‚’è‡ªå‹•ç”Ÿæˆ |
| **stderrå‡ºåŠ›** | `âŒ {hook_name}: {first_line}` ã‚’stderrã«å‡ºåŠ› |

**ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚„ã£ã¦ã¯ã„ã‘ãªã„ï¼‰**:

```python
# âŒ æ‚ªã„ä¾‹: é‡è¤‡å‘¼ã³å‡ºã—
log_hook_execution("my-hook", "block", reason)  # ä¸è¦ï¼ˆmake_block_resultãŒå‘¼ã¶ï¼‰
result = make_block_result("my-hook", reason)

# âŒ æ‚ªã„ä¾‹: é‡è¤‡ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
reason = f"[my-hook] {actual_reason}"  # ä¸è¦ï¼ˆmake_block_resultãŒä»˜ä¸ï¼‰
result = make_block_result("my-hook", reason)

# âœ… è‰¯ã„ä¾‹: reasonã®ã¿ã‚’æ¸¡ã™
result = make_block_result("my-hook", "æ“ä½œãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ")
```

#### `make_approve_result(hook_name, message=None)`

**ä»•æ§˜**:
- `decision: "approve"` ã¨ `systemMessage` ã‚’å«ã‚€è¾æ›¸ã‚’è¿”ã™
- messageãŒNoneã®å ´åˆã€`âœ… {hook_name}: OK` ãŒsystemMessageã«ãªã‚‹
- **`reason` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å«ã¾ã‚Œãªã„**ï¼ˆblockã¨ç•°ãªã‚‹ï¼‰

#### ãã®ä»–ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

| é–¢æ•° | ç”¨é€” |
|------|------|
| `print_continue_and_log_skip(hook_name, reason)` | å¯¾è±¡å¤–æ™‚ã®æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ï¼ˆPreToolUse/PostToolUseç”¨ï¼‰ |
| `print_approve_and_log_skip(hook_name, reason)` | å¯¾è±¡å¤–æ™‚ã®æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ï¼ˆStop hookç”¨ï¼‰ |
| `check_skip_env(hook_name, env_var)` | SKIPç’°å¢ƒå¤‰æ•°ã®ãƒã‚§ãƒƒã‚¯ã¨ãƒ­ã‚°è¨˜éŒ² |

#### `parse_hook_input()` ï¼ˆlib/session.pyï¼‰

ãƒ•ãƒƒã‚¯å…¥åŠ›ã®æ¨™æº–çš„ãªèª­ã¿å–ã‚Šæ–¹æ³•ã€‚ä»¥ä¸‹ã‚’è‡ªå‹•ã§è¡Œã†:

1. stdinã‹ã‚‰JSONã‚’èª­ã¿å–ã‚Šãƒ‘ãƒ¼ã‚¹
2. `session_id` ãŒã‚ã‚Œã°è‡ªå‹•ã§ `set_hook_session_id()` ã‚’å‘¼ã³å‡ºã™
3. ãƒ‘ãƒ¼ã‚¹ã—ãŸè¾æ›¸ã‚’è¿”ã™ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºè¾æ›¸ï¼‰

**æˆ»ã‚Šå€¤æ§‹é€ **ï¼ˆãƒ•ãƒƒã‚¯ã‚¿ã‚¤ãƒ—åˆ¥ï¼‰:

| ãƒ•ãƒƒã‚¯ã‚¿ã‚¤ãƒ— | ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|-------------|---------------|
| PreToolUse / PostToolUse | `tool_name`, `tool_input`, `session_id`, `cwd` |
| UserPromptSubmit | `user_prompt`, `session_id`, `cwd` |
| SessionStart | `session_id`, `cwd`, `source`, `transcript_path` |
| Stop | `stop_hook_active`, `session_id`, `cwd` |

**ä½¿ç”¨ä¾‹**:

```python
from lib.session import parse_hook_input

def main():
    hook_input = parse_hook_input()  # session_idãŒè‡ªå‹•è¨­å®šã•ã‚Œã‚‹
    tool_name = hook_input.get("tool_name")
    tool_input = hook_input.get("tool_input", {})
    command = tool_input.get("command", "")
    # ... ãƒ•ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
```

**ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**:

```python
# âŒ æ‚ªã„ä¾‹: æ‰‹å‹•ã§JSONãƒ‘ãƒ¼ã‚¹ã—ã¦session_idè¨­å®šã‚’å¿˜ã‚Œã‚‹
data = json.loads(sys.stdin.read())
# session_idãŒè¨­å®šã•ã‚Œãªã„ â†’ ãƒ­ã‚°ãŒæ­£ã—ãã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ç´ã¥ã‹ãªã„

# âœ… è‰¯ã„ä¾‹: parse_hook_input()ã‚’ä½¿ç”¨
hook_input = parse_hook_input()  # session_idè‡ªå‹•è¨­å®š
```

#### HookContextã¸ã®ç§»è¡Œï¼ˆIssue #2449ï¼‰

`get_claude_session_id()` ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆå›°é›£æ€§ã¨ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•æ€§ã®å•é¡ŒãŒã‚ã‚‹ã€‚æ–°ã—ã„ãƒ•ãƒƒã‚¯ã¯ `HookContext` ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚

**ç§»è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³**:

```python
# âŒ æ—§ãƒ‘ã‚¿ãƒ¼ãƒ³: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã‚’ä½¿ç”¨
from lib.session import parse_hook_input, get_claude_session_id

def main():
    hook_input = parse_hook_input()
    session_id = get_claude_session_id()  # ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã‹ã‚‰å–å¾—
    # ...

# âœ… æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³: HookContextï¼ˆDIï¼‰ã‚’ä½¿ç”¨
from lib.session import parse_hook_input, create_hook_context

def main():
    hook_input = parse_hook_input()
    ctx = create_hook_context(hook_input)
    session_id = ctx.get_session_id()  # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å–å¾—
    # ...
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

| è¦³ç‚¹ | æ—§ãƒ‘ã‚¿ãƒ¼ãƒ³ | æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³ |
|------|-----------|-----------|
| ãƒ†ã‚¹ãƒˆ | ãƒ¢ãƒƒã‚¯å›°é›£ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼‰ | ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ³¨å…¥ã§å®¹æ˜“ |
| ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ• | å•é¡Œã‚ã‚Š | å•é¡Œãªã— |
| ä¾å­˜é–¢ä¿‚ | æš—é»™çš„ | æ˜ç¤ºçš„ |

**ç§»è¡ŒçŠ¶æ³**:

- `get_claude_session_id()` ã¯deprecatedï¼ˆ`SHOW_SESSION_DEPRECATION=1` ã§è­¦å‘Šè¡¨ç¤ºï¼‰
- æ—¢å­˜ãƒ•ãƒƒã‚¯ã¯æ®µéšçš„ã«ç§»è¡Œä¸­
- æ–°è¦ãƒ•ãƒƒã‚¯ã¯å¿…ãš `HookContext` ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨

#### ãƒ•ãƒƒã‚¯å®Ÿè£…å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆå…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰

- [ ] `lib/results.py` ã®ã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ãŸã‹
- [ ] `lib/session.py` ã® `parse_hook_input()` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹
- [ ] `create_hook_context()` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ï¼ˆ`get_claude_session_id()` ã¯éæ¨å¥¨ï¼‰
- [ ] ä½¿ç”¨ã™ã‚‹é–¢æ•°ã®å‰¯ä½œç”¨ï¼ˆãƒ­ã‚°è¨˜éŒ²ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ä¸ï¼‰ã‚’ç†è§£ã—ãŸã‹
- [ ] é‡è¤‡å‡¦ç†ï¼ˆæ‰‹å‹•ãƒ­ã‚°è¨˜éŒ²ã€æ‰‹å‹•ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰ã‚’ã—ã¦ã„ãªã„ã‹

**è¨­è¨ˆåˆ¤æ–­ã®ç†ç”±**:
- JSONå‡ºåŠ›ã¯Claudeã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºç”¨ â†’ é‡è¦ãªæƒ…å ±ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ãƒ»é€šçŸ¥ï¼‰ã®ã¿
- ãƒ­ã‚°è¨˜éŒ²ã¯ç›£æŸ»ãƒ»åˆ†æç”¨ â†’ å…¨å®Ÿè¡Œã‚’è¨˜éŒ²ï¼ˆå¯¾è±¡å¤–ãƒ»è¨±å¯å«ã‚€ï¼‰
- ã€Œå…¨ã¦è¨˜éŒ²ã—ã¦ã€åˆ©ç”¨æ™‚ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ã®åŸå‰‡

**ãƒ­ã‚°è¨˜éŒ²ãƒ‘ã‚¿ãƒ¼ãƒ³**:

| çŠ¶æ³ | decisionå€¤ | ä¾‹ |
|------|------------|---|
| å¯¾è±¡å¤– | `skip` | "Not a merge command" |
| è¨±å¯ | `approve` | "All checks passed" |
| ãƒ–ãƒ­ãƒƒã‚¯ | `block` | "auto-merge blocked" |

### systemMessageå‡ºåŠ›ä¾‹

å„ãƒ•ãƒƒã‚¯ã®systemMessageå‡ºåŠ›ä¾‹ã€‚æ–°è¦ãƒ•ãƒƒã‚¯é–‹ç™ºæ™‚ã®å‚è€ƒã«ã€‚

**task_start_checklist.py**:
```
ğŸ“‹ **ã‚¿ã‚¹ã‚¯é–‹å§‹å‰ã®ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

ä»¥ä¸‹ã®ç‚¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹ã—ã¦ãã ã•ã„:

**è¦ä»¶ç¢ºèª**:
  [ ] è¦ä»¶ã¯æ˜ç¢ºã‹ï¼Ÿæ›–æ˜§ãªç‚¹ãŒã‚ã‚Œã°è³ªå•ã™ã‚‹
  [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’æ­£ã—ãç†è§£ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

**è¨­è¨ˆåˆ¤æ–­**:
  [ ] è¨­è¨ˆä¸Šã®é¸æŠè‚¢ãŒã‚ã‚‹å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã™ã‚‹
  [ ] æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»è¦ç´„ã‚’æŠŠæ¡ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

ğŸ’¡ ä¸æ˜ç‚¹ãŒã‚ã‚Œã°ã€å®Ÿè£…å‰ã«å¿…ãšè³ªå•ã—ã¦ãã ã•ã„ã€‚
```

**dependency_check_reminder.py**:
```
ğŸ“¦ **ä¾å­˜é–¢ä¿‚è¿½åŠ ã‚’æ¤œå‡º**

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `react-query` ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚

**æœ€æ–°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„:**

1. **Context7**: `react-query` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§
   - `mcp__context7__resolve-library-id` ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªIDã‚’å–å¾—
   - `mcp__context7__get-library-docs` ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—

2. **Webæ¤œç´¢**: æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»å¤‰æ›´å±¥æ­´ã‚’ç¢ºèª
   - ã€Œreact-query latest versionã€ã§æ¤œç´¢

ğŸ’¡ å¤ã„APIã‚„éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰ã®ä½¿ç”¨ã‚’é˜²ããŸã‚ã€æœ€æ–°æƒ…å ±ã®ç¢ºèªã‚’æ¨å¥¨ã—ã¾ã™ã€‚
```

**open_issue_reminder.py**:
```
ğŸš¨ **é«˜å„ªå…ˆåº¦Issueï¼ˆå„ªå…ˆå¯¾å¿œå¿…é ˆï¼‰**:
  â†’ #123: æœ¬ç•ªç’°å¢ƒã§ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•— [P1, bug]

ğŸ“‹ **æœªã‚¢ã‚µã‚¤ãƒ³ã®ã‚ªãƒ¼ãƒ—ãƒ³Issue** (å¯¾å¿œæ¤œè¨ã—ã¦ãã ã•ã„):
  - #456: ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ [enhancement]
  - #789: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ [P2]

è©³ç´°: `gh issue list --state open`
```

**å‡ºåŠ›è¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**:

| é …ç›® | æ¨å¥¨ |
|------|------|
| **ã‚¿ã‚¤ãƒˆãƒ«** | çµµæ–‡å­— + å¤ªå­—ã§ç›®ç«‹ãŸã›ã‚‹ |
| **æ§‹é€ ** | ç®‡æ¡æ›¸ã/ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼ |
| **é•·ã•** | 5-15è¡Œï¼ˆé•·ã™ãã‚‹ã¨èª­ã¾ã‚Œãªã„ï¼‰ |
| **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³** | å…·ä½“çš„ãªæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æç¤º |

## PreToolUse ãƒ•ãƒƒã‚¯ä¸€è¦§

### Edit/Write ãƒ–ãƒ­ãƒƒã‚¯

- **ãƒˆãƒªã‚¬ãƒ¼**: ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†å‰
- **å‹•ä½œ**: main/masterã§ã®ç·¨é›†ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã€worktreeå¤–ã‚’è­¦å‘Š

### ã‚ªãƒ¼ãƒ—ãƒ³Issueãƒªãƒã‚¤ãƒ³ãƒ‰ (`open_issue_reminder.py`)

- **ç›®çš„**: æœªã‚¢ã‚µã‚¤ãƒ³Issueè¡¨ç¤ºã€ç«¶åˆé˜²æ­¢
- **å‹•ä½œ**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ï¼ˆ1æ™‚é–“é–“éš”ï¼‰ã«æœ€åˆã®Bashã§ãƒˆãƒªã‚¬ãƒ¼

### ã‚¿ã‚¹ã‚¯é–‹å§‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ (`task_start_checklist.py`)

- **ç›®çš„**: ã‚¿ã‚¹ã‚¯é–‹å§‹æ™‚ã®è¦ä»¶ãƒ»è¨­è¨ˆç¢ºèªæ¼ã‚Œé˜²æ­¢
- **å‹•ä½œ**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ï¼ˆ1æ™‚é–“é–“éš”ï¼‰ã«æœ€åˆã®Edit/Write/Bashã§ãƒˆãƒªã‚¬ãƒ¼
- **è¡¨ç¤ºå†…å®¹**: è¦ä»¶ç¢ºèªã€è¨­è¨ˆåˆ¤æ–­ã€å½±éŸ¿ç¯„å›²ã€å‰ææ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- **ãƒ–ãƒ­ãƒƒã‚¯**: ã—ãªã„ï¼ˆsystemMessageã§ãƒªãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤ºã®ã¿ï¼‰

### ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ (`dependency_check_reminder.py`)

- **ç›®çš„**: ä¾å­˜é–¢ä¿‚è¿½åŠ æ™‚ã«Context7/Webæ¤œç´¢ã‚’ä¿ƒã™
- **å‹•ä½œ**: `pnpm add`, `npm install`, `pip install` ç­‰ã®ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºæ™‚ã«ãƒˆãƒªã‚¬ãƒ¼
- **è¡¨ç¤ºå†…å®¹**: Context7ã§ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèªã€Webæ¤œç´¢ã§ã®æœ€æ–°æƒ…å ±ç¢ºèªã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ãƒ–ãƒ­ãƒƒã‚¯**: ã—ãªã„ï¼ˆsystemMessageã§ãƒªãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤ºã®ã¿ï¼‰
- **é‡è¤‡é˜²æ­¢**: åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯1ã‚»ãƒƒã‚·ãƒ§ãƒ³1å›ã®ã¿è¡¨ç¤º

### Issueè‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³ (`issue_auto_assign.py`)

- **ç›®çš„**: è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Issueç«¶åˆé˜²æ­¢
- **å‹•ä½œ**: `git worktree add` ã§ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰Issueç•ªå·ã‚’æ¤œå‡ºã—è‡ªå‹•assign
- **ãƒ‘ã‚¿ãƒ¼ãƒ³**: `feature/issue-123-desc`, `fix/123-bug`, `#123-feature`

### PRã‚¹ã‚³ãƒ¼ãƒ—ãƒã‚§ãƒƒã‚¯ (`pr_scope_check.py`)

- **ç›®çš„**: 1 Issue = 1 PR ãƒ«ãƒ¼ãƒ«å¼·åˆ¶
- **å‹•ä½œ**: `gh pr create` ã§è¤‡æ•°Issueå‚ç…§ã‚’ãƒ–ãƒ­ãƒƒã‚¯

### Skillä½¿ç”¨ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ»å¼·åˆ¶ãƒ•ãƒƒã‚¯

worktreeä½œæˆãƒ»PRä½œæˆæ™‚ã®Skillå‚ç…§ã‚’ä¿ƒã™2ã¤ã®è£œå®Œçš„ãªãƒ•ãƒƒã‚¯ã€‚

#### `workflow_skill_reminder.py`ï¼ˆãƒªãƒã‚¤ãƒ³ãƒ‰å‹ï¼‰

- **ç›®çš„**: worktree/PRä½œæˆæ™‚ã«`development-workflow` Skillå‚ç…§ã‚’ãƒªãƒã‚¤ãƒ³ãƒ‰
- **ãƒˆãƒªã‚¬ãƒ¼**: `git worktree add`, `gh pr create` æ¤œå‡ºæ™‚
- **å‹•ä½œ**: **è­¦å‘Šã®ã¿**ï¼ˆsystemMessageã§ãƒªãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤ºã€ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ï¼‰
- **é–¢é€£Issue**: #2387

**å‡ºåŠ›ä¾‹**:
```
ğŸ“š workflow-skill-reminder: worktreeä½œæˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚

ã€development-workflow Skill å‚ç…§ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã€‘
worktreeä½œæˆæ™‚ã¯ `development-workflow` Skill ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ç¢ºèªã™ã¹ãå†…å®¹:**
â–¡ worktreeä½œæˆç›´å¾Œã®ãƒã‚§ãƒƒã‚¯ï¼ˆmainæœ€æ–°ã¨ã®å·®åˆ†ç¢ºèªï¼‰
â–¡ `--lock` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨ï¼ˆä»–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‰Šé™¤é˜²æ­¢ï¼‰
...
```

#### `skill_usage_reminder.py`ï¼ˆå¼·åˆ¶å‹ï¼‰

- **ç›®çš„**: Skillä½¿ç”¨ãªã—ã§ã®worktree/PRä½œæˆã‚’**ãƒ–ãƒ­ãƒƒã‚¯**
- **ãƒˆãƒªã‚¬ãƒ¼**: `git worktree add`, `gh pr create` æ¤œå‡ºæ™‚
- **å‹•ä½œ**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®transcriptã‚’ç¢ºèªã—ã€å¿…è¦ãªSkillãŒä½¿ç”¨ã•ã‚Œã¦ã„ãªã‘ã‚Œã°**ãƒ–ãƒ­ãƒƒã‚¯**
- **é–¢é€£Issue**: #2355

#### è£œå®Œé–¢ä¿‚

ä¸¡ãƒ•ãƒƒã‚¯ã¯ä»¥ä¸‹ã®è£œå®Œé–¢ä¿‚ã«ã‚ã‚‹:

| ãƒ•ãƒƒã‚¯ | ãƒã‚§ãƒƒã‚¯å†…å®¹ | å‹•ä½œ |
|--------|------------|------|
| `workflow_skill_reminder.py` | ãƒªãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤º | ã€ŒSkillã‚’å‚ç…§ã™ã¹ãã€ã¨ãƒªãƒã‚¤ãƒ³ãƒ‰ |
| `skill_usage_reminder.py` | Skillæœªä½¿ç”¨æ™‚ã«ãƒ–ãƒ­ãƒƒã‚¯ | Skillæœªä½¿ç”¨ãªã‚‰**ãƒ–ãƒ­ãƒƒã‚¯** |

**ãƒ•ãƒ­ãƒ¼**:

1. `git worktree add` ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€åŒã˜ PreToolUse ãƒ•ã‚§ãƒ¼ã‚ºã§2ã¤ã®ãƒ•ãƒƒã‚¯ãŒèµ·å‹•ã™ã‚‹
2. `workflow_skill_reminder.py`: å¸¸ã« `"approve"` ã‚’è¿”ã—ã¤ã¤ã€`systemMessage` ã§ã€Œdevelopment-workflow Skillã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€ã¨ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’è¡¨ç¤º
3. `skill_usage_reminder.py`: transcript ã‚’ç¢ºèªã—ã€æŒ‡å®šã•ã‚ŒãŸ Skill ãŒæœªå‚ç…§ã§ã‚ã‚Œã° `"block"` ã‚’è¿”ã—ã€å‚ç…§æ¸ˆã¿ã§ã‚ã‚Œã° `"approve"` ã‚’è¿”ã™

ä¸¡ãƒ•ãƒƒã‚¯ã¯åŒã˜ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã—ã¦**ä¸¦è¡Œã—ã¦ç‹¬ç«‹ã«å®Ÿè¡Œã•ã‚Œ**ã€`workflow_skill_reminder.py` ã®ãƒªãƒã‚¤ãƒ³ãƒ‰ã¨ `skill_usage_reminder.py` ã®ãƒ–ãƒ­ãƒƒã‚¯å¯å¦åˆ¤å®šã®çµæœãŒçµ„ã¿åˆã‚ã•ã‚Œã¦ Claude ã«æ¸¡ã•ã‚Œã‚‹ã€‚

**è¨­è¨ˆæ„å›³**: ãƒªãƒã‚¤ãƒ³ãƒ‰ã§æ°—ã¥ã‹ã›ã€ç„¡è¦–ã—ãŸå ´åˆã¯ãƒ–ãƒ­ãƒƒã‚¯ã§å¼·åˆ¶ã€‚2æ®µéšã®é˜²å¾¡ã§ã€Œæ‰‹é †ãŒèº«ã«ã¤ã„ã¦ã„ã‚‹ã€ã¨ã„ã†èª¤ã£ãŸåˆ¤æ–­ã‚’é˜²æ­¢ã€‚

### ãƒãƒ¼ã‚¸å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ (`merge_check.py`)

4ã¤ã®ãƒã‚§ãƒƒã‚¯:

1. `gh pr merge --auto` ã‚’ãƒ–ãƒ­ãƒƒã‚¯
2. `requested_reviewers` ã«Copilot/CodexãŒã„ãŸã‚‰ãƒ–ãƒ­ãƒƒã‚¯
3. Issueå‚ç…§ãªã—ã§å´ä¸‹ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯
4. ã‚³ãƒ¡ãƒ³ãƒˆãªã—Resolveã‚’ãƒ–ãƒ­ãƒƒã‚¯

**å´ä¸‹æ¤œå‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**: ã€Œç¯„å›²å¤–ã€ã€Œè»½å¾®ã€ã€Œout of scopeã€ã€Œdeferã€

### CIå¾…æ©Ÿãƒã‚§ãƒƒã‚¯ (`ci_wait_check.py`)

- **ç›®çš„**: CIç›£è¦–ã‚’ `ci_monitor.py` ã«ä¸€å…ƒåŒ–
- **ãƒ–ãƒ­ãƒƒã‚¯**: `gh pr checks --watch`, `gh pr view --json mergeStateStatus` ç­‰

### Codex CLIãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯

- **logger**: `codex review` å®Ÿè¡Œæ™‚ã«ãƒ–ãƒ©ãƒ³ãƒãƒ»ã‚³ãƒŸãƒƒãƒˆã‚’è¨˜éŒ²
- **check**: `gh pr create` / `git push` æ™‚ã«ç¾åœ¨ã‚³ãƒŸãƒƒãƒˆãŒãƒ¬ãƒ“ãƒ¥ãƒ¼æ¸ˆã¿ã‹ç¢ºèª

### Pythonã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ (`python_lint_check.py`)

- **ç›®çš„**: CIå‰ã«Pythonã‚¹ã‚¿ã‚¤ãƒ«é•åã‚’æ¤œçŸ¥
- **å‹•ä½œ**: `git commit` ã§ã‚¹ãƒ†ãƒ¼ã‚¸ã•ã‚ŒãŸ `.py` ã‚’ `uvx ruff` ã§ãƒã‚§ãƒƒã‚¯

### ãƒ•ãƒƒã‚¯è¨­è¨ˆãƒã‚§ãƒƒã‚¯ (`hooks_design_check.py`)

- **ç›®çš„**: ãƒ•ãƒƒã‚¯é–“ã®è²¬å‹™é‡è¤‡é˜²æ­¢ã€å“è³ªãƒã‚§ãƒƒã‚¯
- **å‹•ä½œ**: æ–°è¦ãƒ•ãƒƒã‚¯è¿½åŠ æ™‚ã«SRPãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’è­¦å‘Šè¡¨ç¤ºã€`log_hook_execution()` æœªä½¿ç”¨ã‚’ãƒ–ãƒ­ãƒƒã‚¯

### UIç¢ºèªãƒã‚§ãƒƒã‚¯ (`ui_check_reminder.py`)

- **ç›®çš„**: UIå¤‰æ›´å¾Œã®ç›®è¦–ç¢ºèªæ¼ã‚Œé˜²æ­¢
- **å¯¾è±¡**: `locales/*.json`, `components/**/*.tsx`, `routes/**/*.tsx`, `index.css`
- **ç¢ºèªè¨˜éŒ²**: `python3 .claude/scripts/confirm_ui_check.py`

### Markdownã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ (`markdown_size_check.py`)

- **ç›®çš„**: Markdownãƒ•ã‚¡ã‚¤ãƒ«è‚¥å¤§åŒ–é˜²æ­¢
- **ä¸Šé™**: 40KBï¼ˆClaude Codeãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿é–¾å€¤ï¼‰

### Worktreeå‰Šé™¤å‰ãƒã‚§ãƒƒã‚¯ (`worktree_removal_check.py`)

- **ç›®çš„**: worktreeå‰Šé™¤å‰ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä½œæ¥­ã‚’æ¤œå‡ºã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç«¶åˆãƒ»ç ´å£Šã‚’é˜²æ­¢
- **ãƒˆãƒªã‚¬ãƒ¼**: `git worktree remove` ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºæ™‚

**2æ®µéšãƒã‚§ãƒƒã‚¯**:

| ãƒã‚§ãƒƒã‚¯ | å¯¾è±¡ | `--force` ã§ãƒã‚¤ãƒ‘ã‚¹ |
|----------|------|----------------------|
| **cwdãƒã‚§ãƒƒã‚¯** | ç¾åœ¨ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒworktreeå†…ã«ã‚ã‚‹ã‹ | **ä¸å¯**ï¼ˆå¸¸ã«ãƒ–ãƒ­ãƒƒã‚¯ï¼‰ |
| **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä½œæ¥­ãƒã‚§ãƒƒã‚¯** | æœ€æ–°ã‚³ãƒŸãƒƒãƒˆãƒ»æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãƒ»stash | å¯èƒ½ |

**cwdãƒã‚§ãƒƒã‚¯ã®é‡è¦æ€§**:

cwdãŒworktreeå†…ã«ã‚ã‚‹çŠ¶æ…‹ã§å‰Šé™¤ã™ã‚‹ã¨ã€ä»¥é™ã®å…¨Bashã‚³ãƒãƒ³ãƒ‰ãŒ `ENOENT` ã‚¨ãƒ©ãƒ¼ã§å¤±æ•—ã™ã‚‹ã€‚
ã‚»ãƒƒã‚·ãƒ§ãƒ³å…¨ä½“ãŒå£Šã‚Œã‚‹ãŸã‚ã€`--force` ã§ã‚‚çµ¶å¯¾ã«ãƒã‚¤ãƒ‘ã‚¹ã§ããªã„ã€‚

**è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ**:

| è¦³ç‚¹ | åˆ¤æ–­ | ç†ç”± |
|------|------|------|
| ä¸¦è¡Œæ€§ | å•é¡Œãªã— | å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ã¦cwdã‚’ãƒã‚§ãƒƒã‚¯ |
| ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ | å¯¾å¿œæ¸ˆã¿ | symlinkâ†’`resolve()`ã€permission deniedâ†’fail-close |
| ä¾å­˜é–¢ä¿‚ | å•é¡Œãªã— | cwdãƒã‚§ãƒƒã‚¯ã¯gitã‚³ãƒãƒ³ãƒ‰ä¸ä½¿ç”¨ï¼ˆç´”ç²‹ãªãƒ‘ã‚¹æ¯”è¼ƒï¼‰ |
| çŠ¶æ…‹ç®¡ç† | é©åˆ‡ | `OSError`ã§fail-closeï¼ˆãƒ–ãƒ­ãƒƒã‚¯å´ã«å€’ã™ï¼‰ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | å¯¾å¿œæ¸ˆã¿ | `resolve()`ã§ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­– |
| æ‹¡å¼µæ€§ | è‰¯å¥½ | å„ãƒã‚§ãƒƒã‚¯ãŒç‹¬ç«‹é–¢æ•°ã¨ã—ã¦å®Ÿè£… |

**Fail-Closeè¨­è¨ˆ**:

```python
# check_cwd_inside_worktree() ã®ä¾‹
try:
    cwd = Path.cwd().resolve()
    # ... ãƒ‘ã‚¹æ¯”è¼ƒ ...
except OSError:
    # cwdãŒå–å¾—ã§ããªã„å ´åˆã¯å®‰å…¨å´ã«å€’ã™
    return True  # ãƒ–ãƒ­ãƒƒã‚¯
```

ä¸ç¢ºå®ŸãªçŠ¶æ³ï¼ˆOSErrorç­‰ï¼‰ã§ã¯å¸¸ã«ã€Œãƒ–ãƒ­ãƒƒã‚¯ã€ã‚’é¸æŠã€‚èª¤ãƒ–ãƒ­ãƒƒã‚¯ã¯å›å¾©å¯èƒ½ã ãŒã€èª¤è¨±å¯ã«ã‚ˆã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ç ´å£Šã¯å›å¾©ä¸å¯èƒ½ãªãŸã‚ã€‚

## PostToolUse ãƒ•ãƒƒã‚¯ä¸€è¦§

### Issue AIãƒ¬ãƒ“ãƒ¥ãƒ¼ (`issue_ai_review.py`)

- **ç›®çš„**: Issueä½œæˆå¾Œã«è‡ªå‹•ã§AIãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆGemini/Codexï¼‰ã‚’å®Ÿè¡Œ
- **ãƒˆãƒªã‚¬ãƒ¼**: `gh issue create` æˆåŠŸå¾Œ
- **å‹•ä½œ**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§Gemini/Codexãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè¡Œã—ã€çµæœã‚’Issueã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æŠ•ç¨¿
- **ãƒ–ãƒ­ãƒƒã‚¯**: ã—ãªã„ï¼ˆPostToolUseã§éãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å®Ÿè¡Œï¼‰

### Worktreeè‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (`worktree_auto_setup.py`)

- **ç›®çš„**: worktreeä½œæˆå¾Œã®ä¾å­˜é–¢ä¿‚è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **ãƒˆãƒªã‚¬ãƒ¼**: `git worktree add` æˆåŠŸå¾Œ
- **å‹•ä½œ**: `setup-worktree.sh` ã‚’è‡ªå‹•å®Ÿè¡Œï¼ˆpnpm installç­‰ï¼‰
- **ãƒ–ãƒ­ãƒƒã‚¯**: ã—ãªã„ï¼ˆPostToolUseã§éãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å®Ÿè¡Œï¼‰

### ãƒ–ãƒ­ãƒƒã‚¯æ”¹å–„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ (`block_improvement_reminder.py`)

- **ç›®çš„**: åŒä¸€ãƒ•ãƒƒã‚¯ãŒé€£ç¶šãƒ–ãƒ­ãƒƒã‚¯ã—ãŸéš›ã«ãƒ•ãƒƒã‚¯æ”¹å–„ã‚’ä¿ƒã™
- **ãƒˆãƒªã‚¬ãƒ¼**: Bashãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå¾Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ–ãƒ­ãƒƒã‚¯å±¥æ­´ã‚’ç¢ºèª
- **å‹•ä½œ**: åŒä¸€ãƒ•ãƒƒã‚¯ãŒ3å›é€£ç¶šã§ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ãŸã‚‰ã€æ”¹å–„ç­–ã‚’systemMessageã§è¡¨ç¤º
- **ãƒ–ãƒ­ãƒƒã‚¯**: ã—ãªã„ï¼ˆsystemMessageã§ãƒªãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤ºã®ã¿ï¼‰
- **é‡è¤‡é˜²æ­¢**: åŒã˜ãƒ•ãƒƒã‚¯ã«ã¯1ã‚»ãƒƒã‚·ãƒ§ãƒ³1å›ã®ã¿è¡¨ç¤º
- **é–¢é€£Issue**: #2432

**æ¤œè¨ã™ã¹ãæ”¹å–„ç­–ã®ä¾‹**:
1. SKIPç’°å¢ƒå¤‰æ•°ã®ã‚µãƒãƒ¼ãƒˆè¿½åŠ 
2. æ‹’å¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ”¹å–„ï¼ˆå…·ä½“çš„ãªè§£æ±ºç­–ã‚’æç¤ºï¼‰
3. èª¤æ¤œçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¿®æ­£

**å‡ºåŠ›ä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ãƒ•ãƒƒã‚¯æ”¹å–„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼: merge-check
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ `merge-check` ãŒ3å›é€£ç¶šã§ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚

**æ¤œè¨ã™ã¹ãæ”¹å–„ç­–:**

1. **SKIPç’°å¢ƒå¤‰æ•°ã®ã‚µãƒãƒ¼ãƒˆè¿½åŠ **
   - `SKIP_MERGE_CHECK=1` ã§ãƒã‚¤ãƒ‘ã‚¹å¯èƒ½ã«

2. **æ‹’å¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ”¹å–„**
   - å…·ä½“çš„ãªè§£æ±ºç­–ã‚’æç¤º
   - ä½•ã‚’ã™ã¹ãã‹æ˜ç¢ºã«èª¬æ˜

3. **èª¤æ¤œçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¿®æ­£**
   - æ­£å½“ãªã‚±ãƒ¼ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ãªã„ã‹ç¢ºèª
   - æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã®ç²¾åº¦ã‚’æ”¹å–„

è©³ç´°ã¯ `hooks-reference` Skill ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
```

## Stop ãƒ•ãƒƒã‚¯

### cwd-check

- **ç›®çš„**: ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¶ˆå¤±æ¤œçŸ¥
- **å‹•ä½œ**: ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«cwdå­˜åœ¨ç¢ºèª

### git-status-check

- **ç›®çš„**: æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´æ¤œçŸ¥
- **å‹•ä½œ**: mainã«æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãŒã‚ã‚Œã°è­¦å‘Š

### reflection-prompt

äº”çœãƒ™ãƒ¼ã‚¹ã®è‡ªå·±è©•ä¾¡ï¼ˆ`prompt`å‹ï¼‰:

- **è©•ä¾¡åŸºæº–**: è¦ä»¶ç†è§£ã€å®Ÿè£…å“è³ªã€æ¤œè¨¼ã€å¯¾å¿œã€åŠ¹ç‡ + ä»•çµ„ã¿åŒ–
- **å‹•ä½œ**:
  - é‡å¤§ãªæœªå®Œäº†ã‚¿ã‚¹ã‚¯ â†’ `block`
  - æ•™è¨“ãŒè¦‹ã¤ã‹ã£ãŸãŒä»•çµ„ã¿åŒ–ã•ã‚Œã¦ã„ãªã„ â†’ `block`
  - ã‚¿ã‚¹ã‚¯å®Œäº† â†’ `approve`

## Session IDå–å¾—ã®ä»•çµ„ã¿

ãƒ•ãƒƒã‚¯ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä½¿ç”¨ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºæœ‰ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã€‚

### å–å¾—å„ªå…ˆé †ä½

Issue #777ã§Claude CodeãŒç›´æ¥session_idã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã€ã‚·ãƒ³ãƒ—ãƒ«ãª2æ®µéš:

| å„ªå…ˆåº¦ | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|--------|--------|------|
| 1 | hook/statusline input JSON `.session_id` | Claude CodeãŒæä¾›ï¼ˆæœ€ã‚‚ä¿¡é ¼æ€§ãŒé«˜ã„ï¼‰ |
| 2 | fallback | Python: `ppid-{PPID}` / Bash: ç©ºæ–‡å­—åˆ— |

**å»ƒæ­¢æ¸ˆã¿**: ç’°å¢ƒå¤‰æ•°ï¼ˆ`CLAUDE_SESSION_ID`, `CLAUDE_CONVERSATION_ID`ï¼‰ã€marker file

### å®Ÿè£…

**Pythonï¼ˆæ­£å¼å®Ÿè£…ï¼‰**: `common.py` ã® `get_claude_session_id()`

```python
from common import get_claude_session_id

session_id = get_claude_session_id()
```

**Bash**: `statusline.sh` ã® `get_session_id()`
ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã€Pythonå®Ÿè£…ã¨åŒæ§˜ã®æ–¹é‡ã§bashã«å®Ÿè£…ã€‚ãŸã ã—fallbackæ™‚ã®æŒ™å‹•ã¯ç•°ãªã‚Šã€Pythonã¯ `ppid-{PPID}`ã€Bashã¯ç©ºæ–‡å­—åˆ—ã‚’è¿”ã™ï¼‰

### DEBUGãƒ­ã‚°

`CLAUDE_DEBUG=1` ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ã€å–å¾—å…ƒãŒstderrã«å‡ºåŠ›ã•ã‚Œã‚‹:

```
[session_id] source=hook_input, value=abc123...
```

### é–¢é€£Issue

- Issue #734: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã®state fileåˆ†é›¢
- Issue #756: hook inputã‹ã‚‰session_idå–å¾—
- Issue #777: Claude Codeã«ã‚ˆã‚‹session_idæä¾›
- Issue #779: å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã®çµ±ä¸€ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

## ãƒ—ãƒ­ã‚»ã‚¹é–“çŠ¶æ…‹å…±æœ‰

### é‡è¦ãªåˆ¶ç´„

ãƒ•ãƒƒã‚¯ã¯**åˆ¥ãƒ—ãƒ­ã‚»ã‚¹**ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ä»¥ä¸‹ã®åˆ¶ç´„ãŒã‚ã‚‹:

| æ–¹å¼ | å‹•ä½œ | ä½¿ç”¨å¯å¦ |
|-----|-----|---------|
| ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° | ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã§æ¶ˆå¤± | âŒ |
| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«è¾æ›¸ | ãƒ—ãƒ­ã‚»ã‚¹é–“ã§å…±æœ‰ä¸å¯ | âŒ |
| ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ | æ°¸ç¶šåŒ–ãƒ»å…±æœ‰å¯èƒ½ | âœ… |
| ç’°å¢ƒå¤‰æ•° | èª­ã¿å–ã‚Šå°‚ç”¨ | â–³ (èª­ã¿å–ã‚Šã®ã¿) |

**ã‚ˆãã‚ã‚‹é–“é•ã„**ï¼ˆIssue #1617ï¼‰:

```python
# âŒ å‹•ä½œã—ãªã„: ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã§æ¶ˆå¤±
_cache = {}

def get_cached_value(key):
    if key not in _cache:
        _cache[key] = expensive_operation()
    return _cache[key]
```

### å®Ÿè£…å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ•ãƒƒã‚¯/ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…å‰ã«ç¢ºèª:

- [ ] ãƒ—ãƒ­ã‚»ã‚¹é–“ã§çŠ¶æ…‹å…±æœ‰ãŒå¿…è¦ã‹ï¼Ÿ
- [ ] å¿…è¦ãªã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–ã‚’ä½¿ç”¨
- [ ] è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®åŒæ™‚æ›¸ãè¾¼ã¿ã¯ï¼Ÿ â†’ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯æ¤œè¨

### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³

**æ¨å¥¨**: JSON Lineså½¢å¼ï¼ˆ`.jsonl`ï¼‰ã§è¿½è¨˜

```python
from __future__ import annotations

import json
from pathlib import Path
from common import METRICS_LOG_DIR

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’äº‹å‰ã«ä½œæˆ
METRICS_LOG_DIR.mkdir(parents=True, exist_ok=True)
LOG_FILE = METRICS_LOG_DIR / "my-data.jsonl"

def append_event(event: dict) -> None:
    """ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½è¨˜ï¼ˆå¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã‚’ä½µç”¨ï¼‰"""
    # æ³¨æ„:
    #   - å°è¦æ¨¡ãªãƒ­ã‚°ã®è¿½è¨˜ã§ã‚ã‚Œã°ã€é€šå¸¸ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ›¸ãè¾¼ã¿ã‚¢ãƒˆãƒŸãƒƒã‚¯æ€§ã§
    #     ååˆ†ãªã“ã¨ãŒå¤šãã€å¿…ãšã—ã‚‚ãƒ­ãƒƒã‚¯ã‚’å°å…¥ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
    #   - è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰é«˜é »åº¦ã«åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã¸æ›¸ãè¾¼ã‚€å ´åˆã¯ã€fcntl ã‚„ filelock ãªã©ã«
    #     ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã€ã‚ã‚‹ã„ã¯å°‚ç”¨ã®ãƒ­ã‚°é›†ç´„ãƒ—ãƒ­ã‚»ã‚¹ã‚„å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®åˆ©ç”¨ã‚’
    #     æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
    with open(LOG_FILE, "a") as f:
        f.write(json.dumps(event) + "\n")

def read_events() -> list[dict]:
    """å…¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿"""
    if not LOG_FILE.exists():
        return []
    events = []
    # å¤§ããªãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã‚ˆãèª­ã¿è¾¼ã‚€ãŸã‚ã€è¡Œå˜ä½ã§å‡¦ç†ã™ã‚‹
    with open(LOG_FILE, "r") as f:
        for line in f:
            if line.strip():
                events.append(json.loads(line))
    return events
```

**æ—¢å­˜ã®å®Ÿè£…ä¾‹**:
- `.claude/logs/metrics/block-patterns.jsonl` - ãƒ–ãƒ­ãƒƒã‚¯â†’æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³
- `.claude/logs/execution/hook-execution.log` - ãƒ•ãƒƒã‚¯å®Ÿè¡Œãƒ­ã‚°

### é–¢é€£Issue

- Issue #1617: ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ç®¡ç†ã®å•é¡Œ
- Issue #1634: ãƒ—ãƒ­ã‚»ã‚¹é–“çŠ¶æ…‹å…±æœ‰ã®æ•™è¨“

## ãƒ•ãƒƒã‚¯è¨­è¨ˆåŸå‰‡

1. **å˜ä¸€è²¬ä»»**: 1ãƒ•ãƒƒã‚¯ = 1è²¬å‹™
2. **ç–çµåˆ**: ãƒ•ãƒƒã‚¯é–“ã®ä¾å­˜æœ€å°åŒ–
3. **ãƒ‘ã‚¹è§£æ±º**: `$CLAUDE_PROJECT_DIR` ã‚’ä½¿ç”¨
4. **SKIPç’°å¢ƒå¤‰æ•°**: å…¨ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ•ãƒƒã‚¯ã¯ `SKIP_*` ç’°å¢ƒå¤‰æ•°ã§ãƒã‚¤ãƒ‘ã‚¹å¯èƒ½ã«ã™ã‚‹

**SKIPç’°å¢ƒå¤‰æ•°ã®å‘½åè¦å‰‡**:

| ãƒ•ãƒƒã‚¯ | ç’°å¢ƒå¤‰æ•° |
|--------|----------|
| worktree-removal-check | `SKIP_WORKTREE_CHECK` |
| issue-incomplete-close-check | `SKIP_INCOMPLETE_CHECK` |
| issue-review-response-check | `SKIP_REVIEW_RESPONSE` |
| planning-enforcement | `SKIP_PLAN` |
| codex-review-check | `SKIP_CODEX_REVIEW` |

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```python
from common import extract_inline_skip_env, is_skip_env_enabled

SKIP_HOOK_NAME_ENV = "SKIP_HOOK_NAME"

# main()é–¢æ•°å†…ã§ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸç’°å¢ƒå¤‰æ•°ã¨ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆï¼‰
# 1. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸç’°å¢ƒå¤‰æ•°ã‚’ãƒã‚§ãƒƒã‚¯
if is_skip_env_enabled(os.environ.get(SKIP_HOOK_NAME_ENV)):
    log_hook_execution("hook-name", "skip", "SKIP_HOOK_NAME=1: ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—")
    print(json.dumps({"decision": "approve"}))
    return

# 2. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç’°å¢ƒå¤‰æ•°ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆä¾‹: SKIP_HOOK_NAME=1 gh issue closeï¼‰
inline_value = extract_inline_skip_env(command, SKIP_HOOK_NAME_ENV)
if is_skip_env_enabled(inline_value):
    log_hook_execution("hook-name", "skip", "SKIP_HOOK_NAME=1: ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰")
    print(json.dumps({"decision": "approve"}))
    return
```

**ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
- âŒ æ—¢å­˜ãƒ•ãƒƒã‚¯ã«ã€Œã¤ã„ã§ã«ã€åˆ¥æ©Ÿèƒ½ã‚’è¿½åŠ 
- âŒ 1ãƒ•ãƒƒã‚¯ã§è¤‡æ•°ã®ç„¡é–¢ä¿‚ãªãƒã‚§ãƒƒã‚¯
- âŒ ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ•ãƒƒã‚¯ã§SKIPç’°å¢ƒå¤‰æ•°ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„
- âœ… æ–°è²¬å‹™ã¯æ–°ãƒ•ãƒƒã‚¯ã¨ã—ã¦å®Ÿè£…

### è­¦å‘Š vs ãƒ–ãƒ­ãƒƒã‚¯ã®åˆ¤æ–­åŸºæº–

ãƒ•ãƒƒã‚¯è¨­è¨ˆæ™‚ã«ã€Œè­¦å‘Šã§è¨±å¯ã€ã‹ã€Œãƒ–ãƒ­ãƒƒã‚¯ã§æ‹’å¦ã€ã‹ã‚’åˆ¤æ–­ã™ã‚‹åŸºæº–ã€‚

| æ¡ä»¶ | é¸æŠ | ç†ç”± |
|------|------|------|
| **å‰¯ä½œç”¨ã®ã‚ã‚‹æ“ä½œã‚’é˜²ããŸã„** | ãƒ–ãƒ­ãƒƒã‚¯ | è­¦å‘Šå¾Œã‚‚ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã€å‰¯ä½œç”¨ã¯ç™ºç”Ÿã—ã¦ã—ã¾ã† |
| **æ“ä½œå¤±æ•—ã§ãƒ•ãƒ­ãƒ¼å•é¡ŒãŒç™ºç”Ÿ** | ãƒ–ãƒ­ãƒƒã‚¯ | ä¾‹: exit code 1ã§PostToolUseãƒ•ãƒƒã‚¯ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ |
| **æƒ…å ±æä¾›ã®ã¿ã§æ“ä½œã¯è¨±å¯** | è­¦å‘Š | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ¤æ–­ã‚’å§”ã­ã‚‹å ´åˆ |
| **è»½å¾®ãªå•é¡Œã®é€šçŸ¥** | è­¦å‘Š | æ“ä½œè‡ªä½“ã¯å•é¡Œãªãå®Œäº†ã™ã‚‹å ´åˆ |

**å®Ÿä¾‹ï¼ˆIssue #2286, #2293ï¼‰**:

worktreeå†…ã‹ã‚‰ `gh pr merge --delete-branch` ã‚’å®Ÿè¡Œã™ã‚‹ã¨:
1. ãƒãƒ¼ã‚¸ã¯æˆåŠŸã™ã‚‹ï¼ˆå‰¯ä½œç”¨ç™ºç”Ÿï¼‰
2. ãƒ–ãƒ©ãƒ³ãƒå‰Šé™¤ã¯å¤±æ•—ã™ã‚‹ï¼ˆä½¿ç”¨ä¸­ã®ãŸã‚ï¼‰
3. exit code 1ãŒè¿”ã‚‹
4. PostToolUseãƒ•ãƒƒã‚¯ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹

å½“åˆã¯ã€Œè­¦å‘Šã€ã§å®Ÿè£…ã—ãŸãŒã€ã“ã‚Œã§ã¯å•é¡ŒãŒè§£æ±ºã—ãªã„ï¼š
- è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‚ã€ã‚³ãƒãƒ³ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œã‚‹
- å‰¯ä½œç”¨ï¼ˆãƒãƒ¼ã‚¸ï¼‰ã¯æ—¢ã«ç™ºç”Ÿæ¸ˆã¿
- PostToolUseãƒ•ãƒƒã‚¯ï¼ˆæŒ¯ã‚Šè¿”ã‚Šç­‰ï¼‰ãŒç™ºç«ã—ãªã„

**åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ**:

- **å‰¯ä½œç”¨ã®ã‚ã‚‹æ“ä½œã‚’é˜²ããŸã„ã‹ï¼Ÿ**
  - **ã¯ã„**: `ãƒ–ãƒ­ãƒƒã‚¯`
  - **ã„ã„ãˆ**:
    - **æ“ä½œå¤±æ•—æ™‚ã«ãƒ•ãƒ­ãƒ¼å•é¡ŒãŒèµ·ãã‚‹ã‹ï¼Ÿ**
      - **ã¯ã„**: `ãƒ–ãƒ­ãƒƒã‚¯`
      - **ã„ã„ãˆ**: `è­¦å‘Š`ï¼ˆã¾ãŸã¯é€šçŸ¥ãªã—ï¼‰

## ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒ•ãƒƒã‚¯å†…ã§å¤–éƒ¨ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹éš›ã®æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚

### shell=True vs shell=False ã®ä½¿ã„åˆ†ã‘

| çŠ¶æ³ | shell | ç†ç”± |
|------|-------|------|
| ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆ`2>&1`ï¼‰ã‚’å«ã‚€ | `True` | ã‚·ã‚§ãƒ«ãŒãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è§£é‡ˆ |
| ãƒ‘ã‚¤ãƒ—ï¼ˆ`\|`ï¼‰ã‚’å«ã‚€ | `True` | ã‚·ã‚§ãƒ«ãŒãƒ‘ã‚¤ãƒ—ã‚’è§£é‡ˆ |
| ç’°å¢ƒå¤‰æ•°å±•é–‹ï¼ˆ`$VAR`ï¼‰ãŒå¿…è¦ | `True` | ã‚·ã‚§ãƒ«ãŒå±•é–‹ |
| ä¸Šè¨˜ä»¥å¤– | `False` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨æ˜ç¢ºã•ã®ãŸã‚ |

### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³

**âœ… shell=Falseï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰**:
```python
# ãƒªã‚¹ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ã‚’æ¸¡ã™ï¼ˆæ¨å¥¨ï¼‰
result = subprocess.run(
    ["gh", "pr", "list", "--json", "number,title"],
    capture_output=True,
    text=True,
    timeout=30
)
```

**âœ… shell=Trueï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ»ãƒ‘ã‚¤ãƒ—ãŒå¿…è¦ãªå ´åˆï¼‰**:
```python
# æ–‡å­—åˆ—ã§ã‚³ãƒãƒ³ãƒ‰ã‚’æ¸¡ã™
result = subprocess.run(
    "gh pr list --search 'author:@me' 2>&1",
    shell=True,
    capture_output=True,
    text=True,
    timeout=30
)
```

### ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

**âŒ shell=Falseã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’å«ã‚€**:
```python
# æ‚ªã„ä¾‹: 2>&1ãŒghã®å¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹
result = subprocess.run(
    "gh pr list 2>&1".split(),  # split()ã§ãƒªã‚¹ãƒˆã«å¤‰æ›
    capture_output=True,
    text=True
)
# ã‚¨ãƒ©ãƒ¼: "2>&1" ãŒ gh ã®ã‚³ãƒãƒ³ãƒ‰å¼•æ•°ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹
```

**âŒ shell=Falseã§æ–‡å­—åˆ—ã‚’æ¸¡ã™**:
```python
# æ‚ªã„ä¾‹: shell=Falseã§æ–‡å­—åˆ—ã¯éæ¨å¥¨
result = subprocess.run(
    "gh pr list",  # æ–‡å­—åˆ—
    shell=False,   # shell=False
    ...
)
# ã‚¨ãƒ©ãƒ¼: FileNotFoundError: [Errno 2] No such file or directory: 'gh pr list'
```

### common.pyã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

ãƒ•ãƒƒã‚¯å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¯ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãŒã‚ã‚Šã¾ã™:

```python
from common import run_command

# åŸºæœ¬çš„ãªä½¿ç”¨æ³•ï¼ˆshell=Falseã€ãƒªã‚¹ãƒˆã§æ¸¡ã™ï¼‰
result = run_command(["gh", "pr", "list", "--json", "number"])

# ã‚·ã‚§ãƒ«æ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆ
result = run_command("gh pr list 2>&1 | grep error", shell=True)
```

### é–¢é€£Issue

- Issue #1106: locked-worktree-guardãŒã‚·ã‚§ãƒ«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’èª¤èªè­˜

## ãƒ•ãƒƒã‚¯å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°ã—ã„ãƒ•ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹ã€‚

### æ­£è¦è¡¨ç¾è¨­è¨ˆ

ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºã®æ­£è¦è¡¨ç¾ã‚’è¨­è¨ˆã™ã‚‹éš›ã®è€ƒæ…®äº‹é …:

- [ ] **ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹**: `SKIP_PLAN=1 git worktree add` ã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç’°å¢ƒå¤‰æ•°
- [ ] **ãƒ‘ã‚¤ãƒ—é€£çµ**: `cmd1 | cmd2` ãƒ‘ã‚¿ãƒ¼ãƒ³
- [ ] **ã‚·ã‚§ãƒ«é€£çµ**: `&&`, `;`, `||` ã«ã‚ˆã‚‹ã‚³ãƒãƒ³ãƒ‰é€£çµ
- [ ] **å¼•ç”¨ç¬¦å†…ã®ã‚³ãƒãƒ³ãƒ‰**: `echo "git commit"` ã®ã‚ˆã†ãªæ–‡å­—åˆ—å†…ã®ã‚³ãƒãƒ³ãƒ‰ï¼ˆèª¤æ¤œçŸ¥é˜²æ­¢ï¼‰
  - `lib/strings.py` ã® `strip_quoted_strings()` ã‚’ä½¿ç”¨ã—ã¦å¼•ç”¨ç¬¦å†…ã‚’é™¤å»ã—ã¦ã‹ã‚‰æ¤œæŸ»
- [ ] **ã‚µãƒ–ã‚·ã‚§ãƒ«**: `$(cmd)` ã‚„ `` `cmd` `` å†…ã®ã‚³ãƒãƒ³ãƒ‰

**å‚è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```python
# ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã‚·ã‚§ãƒ«é€£çµã‚’è€ƒæ…®ã—ãŸä¾‹
# (?:^|&&|\|\||;|\s+) ã§ã‚³ãƒãƒ³ãƒ‰é–‹å§‹ä½ç½®ã‚’ç‰¹å®šï¼ˆ\s+ ã§è¤‡æ•°ç©ºç™½ã«å¯¾å¿œï¼‰
pattern = r"(?:^|&&|\|\||;|\s+)(?:\w+=\S+\s+)*git\s+worktree\s+add"
```

### å…¥åŠ›å‡¦ç†

- [ ] **ç©ºå…¥åŠ›**: `tool_input` ãŒç©ºã®å ´åˆã®å‡¦ç†
- [ ] **ä¸æ­£å½¢å¼**: JSONæ§‹é€ ãŒæœŸå¾…ã¨ç•°ãªã‚‹å ´åˆ
- [ ] **å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¬ è½**: `tool_input.command` ç­‰ãŒå­˜åœ¨ã—ãªã„å ´åˆ
- [ ] **Fail-Closeè¨­è¨ˆ**: ä¸ç¢ºå®ŸãªçŠ¶æ³ã§ã¯ãƒ–ãƒ­ãƒƒã‚¯å´ã«å€’ã™
- [ ] **hook_cwdå–å¾—**: cwdã«ä¾å­˜ã™ã‚‹ãƒ•ãƒƒã‚¯ã¯ `input_data.get("cwd")` ã‚’ä½¿ç”¨ï¼ˆIssue #1172ï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ•ãƒƒã‚¯å®Ÿè£…æ™‚ã«ç¢ºèªã™ã¹ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é …ç›®ã€‚ç‰¹ã«å¤–éƒ¨ç”±æ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯å¿…é ˆã€‚

| ãƒã‚§ãƒƒã‚¯é …ç›® | ç¢ºèªå†…å®¹ | å¯¾ç­–ä¾‹ |
|-------------|----------|--------|
| **Path Traversal** | session_idç­‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ä½¿ç”¨ã—ã¦ã„ãªã„ã‹ | `is_valid_session_id()` ã§UUIDå½¢å¼ã‚’æ¤œè¨¼ |
| **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹æ§‹ç¯‰** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”±æ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ã‚¹ã«å«ã‚ã‚‹å ´åˆ | è¨±å¯ãƒªã‚¹ãƒˆæ–¹å¼ã€æ­£è¦è¡¨ç¾ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ |
| **ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³** | subprocessç­‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ä½¿ç”¨ | `shell=False`ã€å¼•æ•°ã¯ãƒªã‚¹ãƒˆå½¢å¼ |
| **ç§˜å¯†æƒ…å ±ã®éœ²å‡º** | ãƒ­ã‚°ã‚„å‡ºåŠ›ã«ç§˜å¯†æƒ…å ±ãŒå«ã¾ã‚Œãªã„ã‹ | API key, token, passwordã‚’ãƒã‚¹ã‚¯ |
| **ãƒ‘ã‚¹æ­£è¦åŒ–** | symlinkçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ | `Path.resolve()` ã§æ­£è¦åŒ– |

**Path Traversalå¯¾ç­–ã®å®Ÿè£…ä¾‹**:

```python
from lib.session import is_valid_session_id

def get_state_file(session_id: str) -> Path | None:
    """Get state file path with security validation.

    Args:
        session_id: The session ID (should be UUID format).

    Returns:
        Path to state file, or None if session_id is invalid.
    """
    # Security: Validate session_id to prevent path traversal attacks
    # e.g., "../../../etc/passwd" would be rejected
    if not is_valid_session_id(session_id):
        return None
    return STATE_DIR / f"state-{session_id}.json"
```

**ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**:

```python
# âŒ æ‚ªã„ä¾‹: æ¤œè¨¼ãªã—ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ä½¿ç”¨
def get_state_file(session_id: str) -> Path:
    # session_id = "../../../etc/passwd" ã§ä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    return STATE_DIR / f"state-{session_id}.json"

# âœ… è‰¯ã„ä¾‹: æ¤œè¨¼ã—ã¦ã‹ã‚‰ä½¿ç”¨
def get_state_file(session_id: str) -> Path | None:
    if not is_valid_session_id(session_id):
        return None  # Invalid session_id
    return STATE_DIR / f"state-{session_id}.json"
```

**é–¢é€£Issue**: #2696, PR #2693

**hook_cwdãƒ‘ã‚¿ãƒ¼ãƒ³**:
```python
input_data = parse_hook_input()
hook_cwd = input_data.get("cwd")  # Claude CodeãŒæä¾›ã™ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å®Ÿcwd
# hook_cwd ã‚’ base_cwd ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ¸¡ã™ï¼ˆç’°å¢ƒå¤‰æ•°ã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹ï¼‰
cwd = get_effective_cwd(command, base_cwd=hook_cwd)
```

### ãƒ†ã‚¹ãƒˆ

- [ ] **æ­£å¸¸ç³»**: æœŸå¾…ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’æ­£ã—ãæ¤œå‡º
- [ ] **ç•°å¸¸ç³»**: ä¸æ­£å…¥åŠ›ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„
- [ ] **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹**: ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã€ãƒ‘ã‚¤ãƒ—é€£çµç­‰
- [ ] **èª¤æ¤œçŸ¥é˜²æ­¢**: é¡ä¼¼ã‚³ãƒãƒ³ãƒ‰ã‚„å¼•ç”¨ç¬¦å†…ã‚’èª¤æ¤œå‡ºã—ãªã„
- [ ] **ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã®ç¢ºèª**: `run_hook`ï¼ˆsubprocessï¼‰ã‹direct callã‹äº‹å‰ç¢ºèª

**ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã®é¸æŠ**:

| æ–¹å¼ | ãƒ¢ãƒƒã‚¯å¯å¦ | ç”¨é€” |
|------|-----------|------|
| `run_hook()`ï¼ˆsubprocessï¼‰ | âŒ åŠ¹ã‹ãªã„ | E2Eãƒ†ã‚¹ãƒˆã€å®Ÿéš›ã®å‹•ä½œç¢ºèª |
| `hook_module.main()` ç›´æ¥å‘¼ã³å‡ºã— | âœ… åŠ¹ã | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª |

```python
# ãƒ¢ãƒƒã‚¯ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆã¯ç›´æ¥å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨
from unittest.mock import patch

def mock_func(*args, **kwargs):
    raise FileNotFoundError("simulated error")

with patch.object(hook_module, "get_effective_cwd", side_effect=mock_func):
    hook_module.main()  # ä¾‹å¤–ç™ºç”Ÿæ™‚ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆ
```

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­è¨ˆ

systemMessageå‡ºåŠ›ã‚’å«ã‚€ãƒ•ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:

- [ ] **å‡ºåŠ›ç›®çš„ã®æ˜ç¢ºåŒ–**: ä½•ã‚’ä¼ãˆãŸã„ã‹1æ–‡ã§èª¬æ˜ã§ãã‚‹ã‹
- [ ] **å‡ºåŠ›æ§‹é€ ã®è¨­è¨ˆ**: çµµæ–‡å­—ã‚¿ã‚¤ãƒˆãƒ« + ç®‡æ¡æ›¸ã/ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼
- [ ] **å‡ºåŠ›é•·ã®ç¢ºèª**: 5-15è¡Œã‚’ç›®å®‰ï¼ˆé•·ã™ãã‚‹ã¨èª­ã¾ã‚Œãªã„ï¼‰
- [ ] **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æç¤º**: æ¬¡ã«ä½•ã‚’ã™ã¹ãã‹å…·ä½“çš„ã«ç¤ºã™
- [ ] **hooks-referenceã¸ã®è¿½è¨˜**: å‡ºåŠ›ä¾‹ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¿½åŠ 

**å‡ºåŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:
```python
def get_message() -> str:
    """Generate the systemMessage content."""
    lines = [
        "ğŸ“‹ **[ã‚¿ã‚¤ãƒˆãƒ«]**",
        "",
        "[èª¬æ˜æ–‡]",
        "",
        "**[ã‚»ã‚¯ã‚·ãƒ§ãƒ³1]**:",
        "  - [é …ç›®1]",
        "  - [é …ç›®2]",
        "",
        "ğŸ’¡ [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³/ãƒ’ãƒ³ãƒˆ]",
    ]
    return "\n".join(lines)
```

**ç²¾åº¦å‘ä¸Šã®ãƒã‚¤ãƒ³ãƒˆ**:
- ç ”ç©¶ã«ã‚ˆã‚‹ã¨ã€å‡ºåŠ›ä¾‹ã‚’å«ã‚ã‚‹ã¨ç²¾åº¦ãŒå‘ä¸Šã™ã‚‹å ´åˆãŒã‚ã‚‹
- æ›–æ˜§ãªæŒ‡ç¤ºã‚ˆã‚Šå…·ä½“çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡å®šãŒåŠ¹æœçš„
- ç®‡æ¡æ›¸ã/ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼ã¯è§£é‡ˆã®ã°ã‚‰ã¤ãã‚’æ¸›ã‚‰ã™

### Skillæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ï¼ˆIssue #1196ï¼‰

ãƒ•ãƒƒã‚¯è¨­è¨ˆæ™‚ã«é–¢é€£Skillã®ãƒ«ãƒ¼ãƒ«ã¨ã®æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹ã€‚ã“ã‚Œã‚’æ€ ã‚‹ã¨ã€Skillã«è¨˜è¼‰ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ãŒãƒ•ãƒƒã‚¯ã§å¼·åˆ¶ã•ã‚Œãšã€ãƒ«ãƒ¼ãƒ«é•åãŒç™ºç”Ÿã™ã‚‹ã€‚

**å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®**:

- [ ] **é–¢é€£Skillç‰¹å®š**: ã“ã®ãƒ•ãƒƒã‚¯ãŒé–¢é€£ã™ã‚‹Skillã‚’ç‰¹å®šã—ãŸã‹ï¼Ÿ
  - ä¾‹: `bug_issue_creation_guard.py` â†’ `code-review` Skill
  - ä¾‹: `merge_check.py` â†’ `code-review` Skill
  - ä¾‹: `worktree_removal_check.py` â†’ `development-workflow` Skill
- [ ] **ãƒ«ãƒ¼ãƒ«ç¶²ç¾…**: é–¢é€£Skillã«è¨˜è¼‰ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã‚’å…¨ã¦ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
  - ä¾‹: `code-review` Skillã«ã€Œãƒ†ã‚¹ãƒˆä¸è¶³ã¯åŒã˜PRã§å¯¾å¿œã€ã¨ã‚ã‚Œã°ã€ã€Œãƒ†ã‚¹ãƒˆã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚æ¤œå‡ºå¿…é ˆ
- [ ] **ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª**: ãƒ•ãƒƒã‚¯ã®æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ãŒSkillã®è¨˜è¿°ã¨ä¸€è‡´ã™ã‚‹ã‹ï¼Ÿ
  - ä¾‹: Skillã«ã€Œãƒã‚°ã€ãƒ†ã‚¹ãƒˆä¸è¶³ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€ã¨ã‚ã‚Œã°ã€å…¨ã¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å«ã‚ã‚‹

**ç¢ºèªæ‰‹é †**:

1. ãƒ•ãƒƒã‚¯ã®ç›®çš„ã‚’æ˜ç¢ºåŒ–ï¼ˆä½•ã‚’é˜²æ­¢/æ¤œå‡ºã™ã‚‹ã‹ï¼‰
2. é–¢é€£ã™ã‚‹Skillã‚’ `.claude/skills/` ã‹ã‚‰ç‰¹å®š
3. Skillã«è¨˜è¼‰ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«/æ¡ä»¶ã‚’æŠ½å‡º
4. ãƒ•ãƒƒã‚¯ã®ãƒ‘ã‚¿ãƒ¼ãƒ³/ãƒ­ã‚¸ãƒƒã‚¯ãŒå…¨ãƒ«ãƒ¼ãƒ«ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹ç¢ºèª
5. ä¸è¶³ãŒã‚ã‚Œã°ãƒ•ãƒƒã‚¯ã‚’æ‹¡å¼µ

**å¤±æ•—äº‹ä¾‹**:

| å•é¡Œ | åŸå›  | å¯¾ç­– |
|------|------|------|
| ãƒ†ã‚¹ãƒˆä¸è¶³IssueãŒãƒ•ãƒƒã‚¯ã‚’ã™ã‚ŠæŠœã‘ | `code-review` Skillã®ã€Œãƒ†ã‚¹ãƒˆä¸è¶³ã€ãƒ«ãƒ¼ãƒ«ã‚’æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã«å«ã‚ã¦ã„ãªã‹ã£ãŸ | ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã€Œãƒ†ã‚¹ãƒˆã€ã‚’è¿½åŠ  |
| ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹IssueãŒãƒ•ãƒƒã‚¯ã‚’ã™ã‚ŠæŠœã‘ | `code-review` Skillã®ã€Œã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€ãƒ«ãƒ¼ãƒ«ã‚’æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã«å«ã‚ã¦ã„ãªã‹ã£ãŸ | ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã€Œã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€ã‚’è¿½åŠ  |
| ã‚³ãƒ¼ãƒ‰å“è³ªIssueãŒãƒ•ãƒƒã‚¯ã‚’ã™ã‚ŠæŠœã‘ | Skillãƒ«ãƒ¼ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ãªã—ã§ãƒ•ãƒƒã‚¯ã‚’è¨­è¨ˆã—ãŸ | Skillãƒ«ãƒ¼ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚’å°å…¥ |

**docstringãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:

```python
"""
Hook to [ç›®çš„].

Related Skills:
- code-review: [é–¢é€£ãƒ«ãƒ¼ãƒ«]
- development-workflow: [é–¢é€£ãƒ«ãƒ¼ãƒ«]

Detection patterns based on Skill rules:
- Pattern A: [Skillãƒ«ãƒ¼ãƒ«1]
- Pattern B: [Skillãƒ«ãƒ¼ãƒ«2]
"""
```

### é–¢é€£Issue

- Issue #1085: æ­£è¦è¡¨ç¾ã§ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è€ƒæ…®ã—ã¦ã„ãªã‹ã£ãŸäº‹ä¾‹
- Issue #1172: hook_cwdã‚’ä½¿ç”¨ã—ã¦ã„ãªã‹ã£ãŸãŸã‚cwdæ¤œå‡ºãŒå¤±æ•—
- Issue #1196: ãƒ•ãƒƒã‚¯è¨­è¨ˆæ™‚ã®Skillãƒ«ãƒ¼ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

## ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ•ãƒƒã‚¯ä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚„æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¤œå‡ºã™ã‚‹ãƒ•ãƒƒã‚¯ï¼ˆä¾‹: `defer_keyword_check.py`ï¼‰ã‚’ä½œæˆãƒ»å¤‰æ›´ã™ã‚‹éš›ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€‚

### å®Ÿãƒ‡ãƒ¼ã‚¿åˆ†æã®é‡è¦æ€§

ä»®èª¬ãƒ™ãƒ¼ã‚¹ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸å®šã™ã‚‹ã¨:
- **èª¤æ¤œçŸ¥ãŒå¤šã„**: å®Ÿéš›ã«ã¯å•é¡Œãªã„ã‚±ãƒ¼ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯
- **æ¼ã‚ŒãŒå¤šã„**: æœ¬å½“ã«æ¤œå‡ºã™ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹é€ƒã™
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è² è·**: å¾Œã‹ã‚‰ä¿®æ­£ãŒå¿…è¦ã«ãªã‚‹

### å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ•ãƒƒã‚¯ã®ä½œæˆãƒ»å¤‰æ›´æ™‚ã¯ä»¥ä¸‹ã‚’ç¢ºèª:

- [ ] **å®Ÿãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’ç‰¹å®šã—ãŸã‹**
  - GitHub PR comments: `gh api repos/{owner}/{repo}/pulls/{pr}/comments`
  - Issue comments: `gh api repos/{owner}/{repo}/issues/{issue}/comments`
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ­ã‚°: `~/.claude/logs/*.jsonl`

- [ ] **å®Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡ºã—ãŸã‹**
  - ä»®èª¬ãƒ™ãƒ¼ã‚¹ã§ã¯ãªãå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ
  - é »åº¦ãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºèª
  - æœ€ä½10ä»¶ä»¥ä¸Šã®å®Ÿä¾‹ã‚’åé›†

- [ ] **ä½œæˆã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã‹**
  - æ¤œå‡ºç‡ï¼ˆå®Ÿéš›ã«æ¤œå‡ºã™ã¹ãã‚‚ã®ã‚’æ¤œå‡ºã§ãã¦ã„ã‚‹ã‹ï¼‰
  - èª¤æ¤œçŸ¥ç‡ï¼ˆæ¤œå‡ºã™ã¹ãã§ãªã„ã‚‚ã®ã‚’æ¤œå‡ºã—ã¦ã„ãªã„ã‹ï¼‰
  - ç›®æ¨™: æ¤œå‡ºç‡ > 90%ã€èª¤æ¤œçŸ¥ç‡ < 10%

### åˆ†æãƒ„ãƒ¼ãƒ«

`.claude/scripts/analyze_pattern_data.py` ã‚’ä½¿ç”¨:

```bash
# ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œç´¢ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒãƒƒãƒã‚’ç¢ºèªï¼‰
python3 .claude/scripts/analyze_pattern_data.py search \
  --pattern "å¾Œã§|å°†æ¥|ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—" \
  --show-matches

# é »åº¦åˆ†æï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡ºç¾é »åº¦ã‚’ç¢ºèªï¼‰
python3 .claude/scripts/analyze_pattern_data.py analyze \
  --pattern "ã‚¹ã‚³ãƒ¼ãƒ—å¤–" \
  --days 30

# ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚¹ãƒˆæ¤œè¨¼ï¼ˆè¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç²¾åº¦ã‚’ä¸€æ‹¬ãƒã‚§ãƒƒã‚¯ï¼‰
python3 .claude/scripts/analyze_pattern_data.py validate \
  --patterns-file my-patterns.txt
```

### å®Ÿè£…æ™‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚¹ãƒˆå¤‰æ•°ã®å‘½å**:
   ```python
   # æ˜ç¢ºãªå‘½åã§ç›®çš„ã‚’ç¤ºã™
   DEFER_KEYWORDS = [...]  # ã€Œå¾Œã§ã€ç³»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
   SCOPE_OUT_PATTERNS = [...]  # ã‚¹ã‚³ãƒ¼ãƒ—å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³
   ```

2. **å®Ÿãƒ‡ãƒ¼ã‚¿åˆ†æã®è¨¼è·¡ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã«æ®‹ã™**:
   ```python
   # å®Ÿãƒ‡ãƒ¼ã‚¿åˆ†æ: PR comments from 2025-12-30
   # æ¤œå‡ºå¯¾è±¡: Issueå‚ç…§ãªã—ã§ä½¿ã‚ã‚Œã‚‹ã¨å•é¡Œã«ãªã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
   # åˆ†æçµæœ: 30ä»¶ä¸­28ä»¶æ¤œå‡ºã€èª¤æ¤œçŸ¥2ä»¶
   DEFER_KEYWORDS = [...]
   ```

3. **é™¤å¤–ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®**:
   ```python
   # èª¤æ¤œçŸ¥é˜²æ­¢: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ã€ãƒ«ãƒ¼ãƒ«èª¬æ˜
   EXCLUDE_CONTEXTS = [
       r"```",  # ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯
       r"AGENTS\.md",  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§
   ]
   ```

### è‡ªå‹•æ¤œå‡º

`hook_change_detector.py` ãŒãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ•ãƒƒã‚¯ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã€å®Ÿãƒ‡ãƒ¼ã‚¿åˆ†æãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ãƒªãƒã‚¤ãƒ³ãƒ‰ã—ã¾ã™ã€‚

æ¤œå‡ºæ¡ä»¶:
- `*_KEYWORDS`, `*_PATTERNS`, `*_REGEX` å¤‰æ•°ã‚’å«ã‚€
- æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚¹ãƒˆã‚’å«ã‚€
- `re.compile()` ã‚’å«ã‚€

### é–¢é€£Issue

- Issue #1910: AskUserQuestionæ¤œå‡ºãƒ•ãƒƒã‚¯
- Issue #1911: ã€Œå¾Œã§ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºãƒ•ãƒƒã‚¯
- Issue #1912: ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ•ãƒƒã‚¯ä½œæˆæ™‚ã®å®Ÿãƒ‡ãƒ¼ã‚¿åˆ†æå¼·åˆ¶

## ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°ã—ã„ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ•ãƒƒã‚¯ã«è¿½åŠ ã™ã‚‹éš›ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€‚å¼•ç”¨ç¬¦å†…ã§ã®èª¤æ¤œçŸ¥å•é¡Œã‚’è¸ã¾ãˆãŸé˜²æ­¢ç­–ã€‚

### èª¤æ¤œçŸ¥é˜²æ­¢

- [ ] **å¼•ç”¨ç¬¦å†…ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**: `--body "..."` ã‚„ `--title "..."` å†…ã§ã®è¨€åŠã‚’é™¤å¤–
  - å¯¾ç­–: å¼•ç”¨ç¬¦å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é™¤å»ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ä½¿ç”¨ï¼ˆä¸‹è¨˜å®Ÿè£…ä¾‹å‚ç…§ï¼‰
  - âŒ æ‚ªã„ä¾‹: `if "gh run watch" in command:`
  - âœ… è‰¯ã„ä¾‹: `if "gh run watch" in strip_quoted_content(command):`

- [ ] **ã‚³ãƒ¡ãƒ³ãƒˆå†…**: `# command ã¯ä½¿ã‚ãªã„` ã®ã‚ˆã†ãªæ–‡è„ˆ
  - å¯¾ç­–: è¡Œé ­ãŒ `#` ã®å ´åˆã¯ç„¡è¦–ã™ã‚‹å‡¦ç†ã‚’æ¤œè¨

- [ ] **å¤‰æ•°å±•é–‹**: `$command` ãŒå¯¾è±¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚€å ´åˆ
  - å¯¾ç­–: `\b` ã§å˜èªå¢ƒç•Œã‚’æ˜ç¢ºã«ã™ã‚‹

- [ ] **ãƒ‘ã‚¤ãƒ—/ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**: `echo "..." | grep ...`
  - å¯¾ç­–: `strip_quoted_content()` ã§ã‚«ãƒãƒ¼

### ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­è¨ˆ

- [ ] æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¼ã‚ŒãŒãªã„ã‹
- [ ] å¤§æ–‡å­—å°æ–‡å­—ã®åŒºåˆ¥ãŒå¿…è¦ã‹ç¢ºèª
- [ ] è¤‡æ•°è¡Œã‚³ãƒãƒ³ãƒ‰å¯¾å¿œãŒå¿…è¦ã‹

### ãƒ†ã‚¹ãƒˆ

- [ ] **æ­£å¸¸ç³»**: ãƒ–ãƒ­ãƒƒã‚¯ã™ã¹ãã‚³ãƒãƒ³ãƒ‰ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹
- [ ] **èª¤æ¤œçŸ¥ãƒ†ã‚¹ãƒˆ**: å¼•ç”¨ç¬¦å†…ã§ã®è¨€åŠãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œãªã„
  ```python
  def test_approves_quoted_mention(self):
      """å¼•ç”¨ç¬¦å†…ã§ã®ãƒ‘ã‚¿ãƒ¼ãƒ³è¨€åŠã¯æ‰¿èªã•ã‚Œã‚‹."""
      command = 'gh pr comment --body "ä½¿ç”¨ç¦æ­¢: gh run watch"'
      result = should_block(command)
      assert result is False
  ```
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ å…ˆ: `.claude/hooks/tests/test_<hookå>.py`

### å®Ÿè£…ä¾‹

```python
import re

# NOTE: ã“ã®é–¢æ•°ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”¨ã®ç°¡ç•¥åŒ–ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚
# å®Ÿéš›ã®ãƒ•ãƒƒã‚¯å®Ÿè£…ã§ã¯ã€.claude/hooks/ci_wait_check.py å†…ã® strip_quoted_content ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
# ãã¡ã‚‰ã¯æ–‡å­—å˜ä½ã®ãƒ‘ãƒ¼ã‚¹ã«ã‚ˆã‚Šã€ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸå¼•ç”¨ç¬¦ã‚„æœªé–‰ã˜å¼•ç”¨ç¬¦ãªã©ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
def strip_quoted_content(text: str) -> str:
    """å¼•ç”¨ç¬¦å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç°¡æ˜“çš„ã«é™¤å»ã™ã‚‹.

    ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ/ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã¾ã‚ŒãŸå†…å®¹ã‚’ç©ºæ–‡å­—ã«ç½®ãæ›ãˆã‚‹ã€‚
    ä¾‹: 'gh pr comment --body "ä½¿ç”¨ç¦æ­¢: gh run watch"' -> 'gh pr comment --body ""'

    æ³¨æ„: ã“ã®å®Ÿè£…ã¯æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ç°¡ç•¥ç‰ˆã§ã‚ã‚Šã€ä»¥ä¸‹ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“:
        - æ–‡å­—åˆ—å¤–ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸå¼•ç”¨ç¬¦ï¼ˆä¾‹: \"foo\"ï¼‰
        - é–‰ã˜ã‚‰ã‚Œã¦ã„ãªã„å¼•ç”¨ç¬¦
    å®Ÿé‹ç”¨æ™‚ã¯ .claude/hooks/ci_wait_check.py ã®å®Ÿè£…ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
    """
    return re.sub(r'(["\'])(?:\\.|(?!\1).)*\1', r'\1\1', text)

def should_block(command: str) -> bool:
    """Check if command should be blocked."""
    # å¼•ç”¨ç¬¦å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é™¤å»ã—ã¦ã‹ã‚‰ãƒã‚§ãƒƒã‚¯
    clean_command = strip_quoted_content(command)

    # ãƒ–ãƒ­ãƒƒã‚¯å¯¾è±¡ãƒ‘ã‚¿ãƒ¼ãƒ³
    blocked_patterns = [
        r"\bgh\s+run\s+watch\b",
        r"\bgh\s+pr\s+checks\s+--watch\b",
    ]

    for pattern in blocked_patterns:
        if re.search(pattern, clean_command):
            return True
    return False
```

### é–¢é€£Issue

- Issue #1621: ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®è¿½åŠ 

## git rev-listå·®åˆ†ãƒã‚§ãƒƒã‚¯ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

`git rev-list` ã§ãƒ–ãƒ©ãƒ³ãƒé–“ã®å·®åˆ†ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®3ã‚±ãƒ¼ã‚¹ã‚’å¿…ãšãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

### å¿…é ˆãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| ã‚±ãƒ¼ã‚¹ | çŠ¶æ…‹ | æœŸå¾…å‹•ä½œ |
|--------|------|----------|
| **ahead** | ãƒ­ãƒ¼ã‚«ãƒ«ãŒãƒªãƒ¢ãƒ¼ãƒˆã‚ˆã‚Šé€²ã‚“ã§ã„ã‚‹ | é€šå¸¸ã¯è¨±å¯ |
| **behind** | ãƒ­ãƒ¼ã‚«ãƒ«ãŒãƒªãƒ¢ãƒ¼ãƒˆã‚ˆã‚Šé…ã‚Œã¦ã„ã‚‹ | ãƒ–ãƒ­ãƒƒã‚¯ã¾ãŸã¯è­¦å‘Š |
| **same** | åŒä¸€ã‚³ãƒŸãƒƒãƒˆ | è¨±å¯ |

### ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

âŒ **ãƒãƒƒã‚·ãƒ¥ä¸ä¸€è‡´ã§ãƒ–ãƒ­ãƒƒã‚¯**:
```python
# æ‚ªã„ä¾‹: aheadã§ã‚‚èª¤ã£ã¦ãƒ–ãƒ­ãƒƒã‚¯
if local_hash != remote_hash:
    return block()
```

âœ… **behind_countã§ãƒ–ãƒ­ãƒƒã‚¯**:
```python
# è‰¯ã„ä¾‹: behindã®å ´åˆã®ã¿ãƒ–ãƒ­ãƒƒã‚¯
behind_count = get_behind_count()  # git rev-list main..origin/main
if behind_count > 0:
    return block()
```

### ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä¾‹

```python
def test_approves_when_local_is_ahead(self):
    """ãƒ­ãƒ¼ã‚«ãƒ«ãŒé€²ã‚“ã§ã„ã‚‹å ´åˆã¯è¨±å¯"""
    with patch.object(hook, "get_behind_count", return_value=0):
        # behind=0 means local is same or ahead
        result = hook.main()
        self.assertEqual(result["decision"], "approve")

def test_blocks_when_local_is_behind(self):
    """ãƒ­ãƒ¼ã‚«ãƒ«ãŒé…ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ–ãƒ­ãƒƒã‚¯"""
    with patch.object(hook, "get_behind_count", return_value=3):
        result = hook.main()
        self.assertEqual(result["decision"], "block")

def test_approves_when_same(self):
    """åŒä¸€ã‚³ãƒŸãƒƒãƒˆã®å ´åˆã¯è¨±å¯ï¼ˆbehind_count=0ã§åˆ¤å®šï¼‰"""
    # Note: behind_countãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã§ã¯ã€aheadã¨sameã¯åŒã˜æ¡ä»¶ï¼ˆbehind_count=0ï¼‰
    with patch.object(hook, "get_behind_count", return_value=0):
        result = hook.main()
        self.assertEqual(result["decision"], "approve")
```

### é–¢é€£Issue
- Issue #755: worktree-main-freshness-checkã§ã®ç™ºè¦‹
- Issue #760: æœ¬ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³è¿½åŠ 

## ãƒ•ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°

ãƒ•ãƒƒã‚¯ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®ä¿®æ­£ã¯åæ˜ ã•ã‚Œãªã„ã€‚

| ã‚¿ã‚¤ãƒŸãƒ³ã‚° | å‹•ä½œ |
|----------|------|
| **ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚** | ãƒ•ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ |
| **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­** | ãƒ•ãƒƒã‚¯ã‚’ä¿®æ­£ãƒ»ãƒãƒ¼ã‚¸ã—ã¦ã‚‚**ç¾ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¯åæ˜ ã•ã‚Œãªã„** |
| **æ¬¡ã‚»ãƒƒã‚·ãƒ§ãƒ³** | ä¿®æ­£æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ãŒé©ç”¨ã•ã‚Œã‚‹ |

### å½±éŸ¿

- ãƒ•ãƒƒã‚¯ã®ä¿®æ­£å¾Œã‚‚ã€ç¾ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯æ—§ã‚³ãƒ¼ãƒ‰ãŒå‹•ä½œã—ç¶šã‘ã‚‹
- ä¿®æ­£ã‚’æ¤œè¨¼ã™ã‚‹å ´åˆã€æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- èª¤æ¤œçŸ¥ãŒç™ºç”Ÿã—ã¦ã‚‚ã€ç¾ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã€Œãªãœã¾ã å‹•ãã®ã‹ã€ã¨æ··ä¹±ã—ã‚„ã™ã„

### å¯¾å‡¦æ³•

- **ä¿®æ­£æ¤œè¨¼**: æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å‹•ä½œç¢ºèª
- **ç¾ã‚»ãƒƒã‚·ãƒ§ãƒ³**: èª¤æ¤œçŸ¥ã¯ç„¡è¦–ã—ã¦ä½œæ¥­ç¶šè¡Œï¼ˆä¿®æ­£æ¸ˆã¿ãªã‚‰å•é¡Œãªã—ï¼‰

### é–¢é€£Issue

- Issue #2120: lesson-issue-checkã®èª¤æ¤œçŸ¥ä¿®æ­£ï¼ˆã“ã®å•é¡Œã‚’ç™ºè¦‹ã—ãŸãã£ã‹ã‘ï¼‰
- Issue #2124: æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ 

## CWDå•é¡Œã®å¯¾å‡¦

`cd` ã§ãƒ•ãƒƒã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªããªã‚‹å•é¡Œ:

1. **ãƒ•ãƒƒã‚¯è¨­å®š**: `$CLAUDE_PROJECT_DIR` ã‚’ä½¿ç”¨ï¼ˆè¨­å®šæ¸ˆã¿ï¼‰
2. **`cd` ã‚’é¿ã‘ã‚‹**: `-C` / `--dir` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
   - âœ… `pnpm add xxx -C frontend`
   - âŒ `cd frontend && pnpm add xxx`
3. **å•é¡Œç™ºç”Ÿæ™‚**: ã‚»ãƒƒã‚·ãƒ§ãƒ³å†èµ·å‹•ãŒå¿…è¦

## Blockè©•ä¾¡ãƒ»æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«

ãƒ•ãƒƒã‚¯ã«ã‚ˆã‚‹ãƒ–ãƒ­ãƒƒã‚¯ãŒå¦¥å½“ã ã£ãŸã‹è©•ä¾¡ã—ã€èª¤æ¤œçŸ¥ã®å ´åˆã¯ãƒ•ãƒƒã‚¯ã‚’æ”¹å–„ã™ã‚‹ã‚µã‚¤ã‚¯ãƒ«ã€‚

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
[Blockç™ºç”Ÿ] â†’ [ãƒ­ã‚°è¨˜éŒ²] â†’ [è©•ä¾¡] â†’ [åˆ†æ] â†’ [æ”¹å–„]
```

### 1. Blockãƒ­ã‚°ã®ç¢ºèª

```bash
# æœ€è¿‘ã®ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§
python3 .claude/scripts/block_evaluator.py list

# ç‰¹å®šã®blockã‚’è©³ç´°è¡¨ç¤º
python3 .claude/scripts/block_evaluator.py evaluate <block_id>
```

### 2. Blockå¦¥å½“æ€§ã®è©•ä¾¡

è©•ä¾¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
- `valid` - ãƒ–ãƒ­ãƒƒã‚¯ã¯æ­£ã—ã‹ã£ãŸï¼ˆæœ¬æ¥æ­¢ã‚ã‚‹ã¹ãæ“ä½œï¼‰
- `false_positive` - èª¤æ¤œçŸ¥ï¼ˆæ­¢ã‚ã‚‹ã¹ãã§ã¯ãªã‹ã£ãŸï¼‰
- `unclear` - åˆ¤æ–­ã§ããªã„

```bash
# å¯¾è©±çš„ã«è©•ä¾¡
python3 .claude/scripts/block_evaluator.py evaluate <block_id>

# ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§è©•ä¾¡
python3 .claude/scripts/block_evaluator.py evaluate <block_id> \
  -e false_positive \
  -r "ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã«ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸ" \
  -i "ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ã™ã¹ã"
```

### 3. è©•ä¾¡ã‚µãƒãƒªãƒ¼ã®ç¢ºèª

```bash
python3 .claude/scripts/block_evaluator.py summary
```

å‡ºåŠ›ä¾‹:
```
Hook                           Valid   False+  Unclear   FP Rate
----------------------------------------------------------------------
ci-wait-check                      5        3        0     37.5%
codex-review-check                10        1        0      9.1%
```

### 4. èª¤æ¤œçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æ

```bash
python3 .claude/scripts/analyze_false_positives.py
# ç‰¹å®šã®ãƒ•ãƒƒã‚¯ã®ã¿åˆ†æ
python3 .claude/scripts/analyze_false_positives.py --hook ci-wait-check
```

### 5. ãƒ•ãƒƒã‚¯æ”¹å–„

åˆ†æçµæœã«åŸºã¥ã„ã¦ãƒ•ãƒƒã‚¯ã‚’æ”¹å–„:

1. æ”¹å–„ç”¨worktreeä½œæˆ
2. ãƒ•ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ä¿®æ­£
3. ãƒ†ã‚¹ãƒˆè¿½åŠ 
4. PRä½œæˆãƒ»ãƒãƒ¼ã‚¸

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|------|
| `.claude/logs/hook-execution.log` | å…¨ãƒ•ãƒƒã‚¯å®Ÿè¡Œãƒ­ã‚° |
| `.claude/logs/block-evaluations.log` | Blockè©•ä¾¡è¨˜éŒ² |

### è©•ä¾¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°

- **æ¨å¥¨**: ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«æœªè©•ä¾¡ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç¢ºèª
- **å¿…é ˆ**: ã€Œèª¤æ¤œçŸ¥ã§ã¯ï¼Ÿã€ã¨æ„Ÿã˜ãŸæ™‚ã«å³è©•ä¾¡

## AIãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

Copilot/Codexãƒ¬ãƒ“ãƒ¥ãƒ¼ã§é »ç¹ã«æŒ‡æ‘˜ã•ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€äº‹å‰æ¤œå‡ºã®ä»•çµ„ã¿ã€‚

### ã‚ˆãã‚ã‚‹æŒ‡æ‘˜ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | äº‹å‰æ¤œå‡º | å¯¾å‡¦æ³• |
|----------|----------|--------|
| **docstringä¸è¶³** | ruff D101-D103 | pyproject.tomlã§æœ‰åŠ¹åŒ–æ¸ˆã¿ |
| **ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´æ™‚ã®ãƒ†ã‚¹ãƒˆæœªæ›´æ–°** | signature_change_check.py | pre-pushã§è­¦å‘Š |
| **ç½²åãªã—ã®ã‚¹ãƒ¬ãƒƒãƒ‰è§£æ±º** | resolve-thread-guard | ç½²åãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¿…é ˆ |

### docstringãƒ«ãƒ¼ãƒ«ï¼ˆD101-D103ï¼‰

pyproject.tomlã§ä»¥ä¸‹ã®ruffãƒ«ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–:

```toml
[tool.ruff.lint]
select = [
    # ... æ—¢å­˜ãƒ«ãƒ¼ãƒ« ...
    "D101",   # Missing docstring in public class
    "D102",   # Missing docstring in public method
    "D103",   # Missing docstring in public function
]

[tool.ruff.lint.pydocstyle]
convention = "google"
```

**ãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèª**:
```bash
uvx ruff check .claude/hooks/ .claude/scripts/ --select D101,D102,D103
```

### ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´ãƒã‚§ãƒƒã‚¯

`signature_change_check.py` (pre-push hook):

- é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ï¼ˆå¼•æ•°ãƒ»æˆ»ã‚Šå€¤ï¼‰ã®å¤‰æ›´ã‚’æ¤œå‡º
- å¯¾å¿œãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„å ´åˆã«è­¦å‘Š
- è­¦å‘Šã®ã¿ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ï¼‰

**Known Limitations**:
- å˜ä¸€è¡Œã®é–¢æ•°å®šç¾©ã®ã¿æ¤œå‡ºï¼ˆè¤‡æ•°è¡Œã¯æœªå¯¾å¿œï¼‰
- é–¢æ•°åã®å¤‰æ›´ã¯æ¤œå‡ºå¯¾è±¡å¤–

### ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰è§£æ±ºã®ç½²å

`resolve-thread-guard` ã§å¿…é ˆåŒ–ã•ã‚Œã¦ã„ã‚‹ç½²åãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ä¾‹ |
|----------|-----|
| ç¯„å›²å¤– | `[å¯¾è±¡å¤–] æœ¬PRã®ç¯„å›²å¤–ã®ãŸã‚å¯¾å¿œã—ãªã„` |
| è»½å¾® | `[è»½å¾®] ã‚¿ã‚¤ãƒä¿®æ­£ã®ãŸã‚ä»Šå›ã¯è¦‹é€ã‚Š` |
| å¯¾å¿œæ¸ˆã¿ | `[å¯¾å¿œæ¸ˆã¿] ã‚³ãƒŸãƒƒãƒˆ abc1234 ã§ä¿®æ­£` |
| åˆ¥Issue | `[åˆ¥Issue] #123 ã§å¯¾å¿œäºˆå®š` |

**ç½²åãªã—ã§Resolveã™ã‚‹ã¨ `merge_check.py` ã§ãƒ–ãƒ­ãƒƒã‚¯**ã•ã‚Œã‚‹ã€‚

### é–¢é€£Issue

- Issue #1107: Copilotãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ©ãƒ¼æ™‚ã®å¯¾å¿œæ‰‹é †
- Issue #1108: é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´æ™‚ã®ãƒ†ã‚¹ãƒˆæ›´æ–°ãƒã‚§ãƒƒã‚¯
- Issue #1113: Copilotãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®äº‹å‰æ¤œå‡º

## ãƒ•ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

æ–°è¦ãƒ•ãƒƒã‚¯ä½œæˆæ™‚ã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚å†ä½œæ¥­ã‚’é˜²ããŸã‚ã€ãƒ†ã‚¹ãƒˆã‹ã‚‰å…ˆã«æ›¸ãï¼ˆTDDï¼‰ã€‚

### 1. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ˆã«ä½œæˆ

```python
# .claude/hooks/tests/test_my_hook.py
"""Tests for my_hook.py"""
import json
from unittest.mock import patch

import pytest


class TestMyHook:
    """Test cases for my-hook."""

    def test_approves_when_not_target_command(self):
        """å¯¾è±¡å¤–ã‚³ãƒãƒ³ãƒ‰ã¯è¨±å¯ã•ã‚Œã‚‹."""
        # Given
        hook_input = {"tool_name": "Bash", "tool_input": {"command": "ls -la"}}

        # When
        with patch("sys.stdin") as mock_stdin:
            mock_stdin.read.return_value = json.dumps(hook_input)
            # ãƒ•ãƒƒã‚¯ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å®Ÿè¡Œ
            # ...

        # Then: å‡ºåŠ›ãªã—ï¼ˆå¯¾è±¡å¤–ï¼‰

    def test_blocks_when_target_command(self):
        """å¯¾è±¡ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹."""
        # Given
        hook_input = {"tool_name": "Bash", "tool_input": {"command": "target command"}}

        # When / Then
        # ...

    def test_approves_when_skip_env_set(self):
        """SKIP_MY_HOOK=1 ã§ã‚¹ã‚­ãƒƒãƒ—."""
        # Given
        hook_input = {"tool_name": "Bash", "tool_input": {"command": "SKIP_MY_HOOK=1 target command"}}

        # When / Then
        # ...

    def test_handles_empty_input(self):
        """ç©ºå…¥åŠ›ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„."""
        # Given
        hook_input = {}

        # When / Then: ä¾‹å¤–ãªãå‡¦ç†

    def test_handles_invalid_json(self):
        """ä¸æ­£JSONã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„."""
        # ...
```

### 2. ãƒ•ãƒƒã‚¯æœ¬ä½“ã‚’å®Ÿè£…

```python
#!/usr/bin/env python3
"""My hook description.

What it does:
- Check A
- Block B
"""

import json
import os
import sys

from common import (
    extract_inline_skip_env,
    is_skip_env_enabled,
    log_hook_execution,
    make_block_result,
)

SKIP_ENV = "SKIP_MY_HOOK"


def should_block(command: str) -> tuple[bool, str]:
    """Check if command should be blocked.

    Args:
        command: The command string to check.

    Returns:
        Tuple of (should_block, reason).
    """
    # å¯¾è±¡ã‚³ãƒãƒ³ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
    if "target pattern" in command:
        return True, "ã“ã®æ“ä½œã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚"
    return False, ""


def main() -> None:
    """Entry point for the hook."""
    try:
        data = json.load(sys.stdin)
    except json.JSONDecodeError:
        # Fail-open: JSONã‚¨ãƒ©ãƒ¼ã¯è¨±å¯
        return

    tool_name = data.get("tool_name", "")
    if tool_name != "Bash":
        return  # å¯¾è±¡å¤–

    command = data.get("tool_input", {}).get("command", "")
    if not command:
        return  # ç©ºã‚³ãƒãƒ³ãƒ‰ã¯å¯¾è±¡å¤–

    # SKIPç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
    if is_skip_env_enabled(os.environ.get(SKIP_ENV)):
        log_hook_execution("my-hook", "skip", f"{SKIP_ENV}=1")
        print(json.dumps({"decision": "approve"}))
        return

    inline_value = extract_inline_skip_env(command, SKIP_ENV)
    if is_skip_env_enabled(inline_value):
        log_hook_execution("my-hook", "skip", f"{SKIP_ENV}=1 (inline)")
        print(json.dumps({"decision": "approve"}))
        return

    # ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    should_block_result, reason = should_block(command)
    if should_block_result:
        result = make_block_result("my-hook", reason)
        log_hook_execution("my-hook", "block", reason, {"command": command})
        print(json.dumps(result))
        return

    # å¯¾è±¡å¤–ã¾ãŸã¯OK: å‡ºåŠ›ãªã—


if __name__ == "__main__":
    main()
```

### 3. settings.jsonã«ç™»éŒ²

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 $CLAUDE_PROJECT_DIR/.claude/hooks/my_hook.py"
          }
        ]
      }
    ]
  }
}
```

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ãï¼ˆTDDï¼‰
- [ ] æœ€ä½3ã¤ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆæ­£å¸¸ãƒ»å¢ƒç•Œãƒ»ã‚¨ãƒ©ãƒ¼ï¼‰
- [ ] SKIPç’°å¢ƒå¤‰æ•°ã®ã‚µãƒãƒ¼ãƒˆ
- [ ] Fail-openè¨­è¨ˆï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯è¨±å¯ï¼‰
- [ ] `log_hook_execution()` ã§ãƒ­ã‚°è¨˜éŒ²
- [ ] docstringè¿½åŠ ï¼ˆD101-D103å¯¾å¿œï¼‰

## ãƒ•ãƒƒã‚¯çµ±è¨ˆ

| ã‚¤ãƒ™ãƒ³ãƒˆ | ãƒ•ãƒƒã‚¯æ•° |
| -------- | -------- |
| SessionStart | 5 |
| PreToolUse (Navigation) | 1 |
| PreToolUse (Edit/Write) | 3 |
| PreToolUse (Bash) | 34 |
| PostToolUse (Bash) | 17 |
| PostToolUse (Edit) | 2 |
| PostToolUse (Read/Glob/Grep) | 2 |
| PostToolUse (WebSearch/WebFetch) | 1 |
| Stop | 13 |
| **åˆè¨ˆ** | **78** |

> **æ³¨**: ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ•ãƒƒã‚¯æ•°ã¯75ç¨®é¡ã€‚ä¸€éƒ¨ã®ãƒ•ãƒƒã‚¯ï¼ˆtask-start-checklistç­‰ï¼‰ã¯è¤‡æ•°ã®ãƒˆãƒªã‚¬ãƒ¼ã§ç™ºå‹•ã™ã‚‹ãŸã‚ã€ç™ºå‹•ãƒã‚¤ãƒ³ãƒˆæ•°ï¼ˆ78ï¼‰ã¨ã¯ç•°ãªã‚‹ã€‚
