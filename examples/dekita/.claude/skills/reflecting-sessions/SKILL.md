---
name: reflecting-sessions
description: Reflects on session behavior using the Five Reflections (Gosei) framework, performs self-evaluation, and creates Issues for improvements. Supports log analysis and root cause analysis. Use when session ends, /reflecting-sessions is invoked, or periodic self-assessment is needed.
---

# 振り返り実行ガイド

セッション終了時の振り返り手順。五省で自己評価し、改善点をIssue化する。

ultrathink

## 目次

| ファイル | 内容 |
|----------|------|
| [session-analysis.md](session-analysis.md) | 行動振り返り、ログ調査 |
| [gosei-evaluation.md](gosei-evaluation.md) | PR/Issue評価、五省、テンプレート |
| [improvement-actions.md](improvement-actions.md) | 自律完遂度、改善点、Issue判定・作成 |

## 0. 必須チェック（最初に実行）

**重要**: 以下を**必ず**実行してから振り返りを開始。形式的な振り返りを防ぐため、各項目で具体的な記述を要求します。

| チェック項目 | 実行内容（記述必須） |
|-------------|---------------------|
| **前提バイアス回避** | 「問題があったはず」という前提で始める。「問題なし」で始めない |
| **調査の網羅性** | 関連する全ディレクトリを調査したか？漏れた箇所があれば記述 |
| **3回自問** | 「他にないか？」を3回自問し、検討した観点を記述 |

```markdown
1. 「何か問題があったはず」という前提で始める
2. 最低3回「他にないか？」と自問する
3. チェックマークではなく具体的な行動と改善点を記述
4. 反省点はドキュメント化 **または** 仕組み化
```

---

## 10. 最終確認（全観点サマリー）

### 観点チェック完了確認

| セクション | 主な確認項目 | 完了 |
|-----------|-------------|------|
| 2. ログ調査 | セッション事実、異常パターン、Skill使用 | [ ] |
| 3. PR/Issue評価 | 実装後の動作確認 | [ ] |
| 3.6 動作確認Issue検証 | observation issueの自動検証 | [ ] |
| 4. 開発フロー | 五省による自己評価 | [ ] |
| 5. 自律完遂度 | 中断イベントの評価 | [ ] |
| 6. 改善点 | 根本原因、見落とし、Issue化 | [ ] |
| 7. Issue判定記録 | create/skip判定を記録 | [ ] |
| 8. セッション内Issue完遂 | 作成したIssueが全て完遂されているか | [ ] |
| 9. Issue作成 | 全改善点のIssue化 | [ ] |

### 振り返り全体の評価

1. **網羅性**: 全セクションを実施し、スキップしたものはないか
2. **深さ**: 表面的な確認で終わらず、本質的な問題を掘り下げたか
3. **行動**: 発見した問題に対して具体的なアクション（Issue作成等）を実行したか

---

## 11. 振り返り完了後のアクション（必須）

**重要**: 振り返り完了後、テキストのみで終わらない。必ずツール呼び出しを行う。

### なぜ必要か

Claude Codeのエージェントループは `while(tool_call)` 構造。テキストのみの応答でループが停止し、ユーザー入力待ちになる。振り返り完了後に「タスクは完了しています」と書いて終わると、ユーザーが何も入力しなければ長時間待機状態になる。

### 完了後の必須アクション

振り返り完了後は、以下のいずれかを**必ず**実行:

| 状況 | アクション |
|------|----------|
| 次のタスクがある | worktree削除 → main更新 → 次のタスク開始 |
| 次のタスクがない | worktree削除 → main更新 → `AskUserQuestion` で「何をしますか？」と質問 |

### 例

```typescript
// ❌ 悪い例: テキストのみで終了
「現時点で気づいている反省点は全て対応しました。」

// ✅ 良い例: ツール呼び出しで継続
「現時点で気づいている反省点は全て対応しました。」
→ worktree削除コマンド実行
→ main更新
→ AskUserQuestion(「何をしますか？」)
```

---

## 振り返りのアンチパターン

以下は避けるべきパターン:

| パターン | 説明 |
|---------|------|
| **チェックリスト症候群** | チェックマークを並べて「問題なし」とする |
| **完了急ぎ症候群** | 「完了しました」を急いで振り返りを省略 |
| **前提バイアス** | 「問題がなかった」前提で始める |
| **「完璧です」と言う** | 完璧な状態は存在しない |

**正しい表現**: 「現時点で気づいている反省点は全て対応しました」

---

## 仕組み化の例

| 問題                     | 仕組み化                        |
| ------------------------ | ------------------------------- |
| mainで編集してしまう     | Edit/Writeブロックフック        |
| レビューコメント見落とし | マージ安全性チェックフック      |
| コミット前の検証漏れ     | python-lint-check, ui-check-reminder |
| ドキュメント肥大化       | markdown-size-checkフック       |
