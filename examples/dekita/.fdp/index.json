{
  "version": "3.0",
  "generated_at": "2026-01-25T10:18:13.256645+00:00",
  "project": "dekita",
  "hooks": [
    {
      "name": "ai_review_checker",
      "path": ".claude/hooks/ai_review_checker.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "merge-check用のAIレビュー状態確認ユーティリティ。",
      "keywords": ["checker", "codex", "copilot", "merge", "review"],
      "why": "AIレビュー（Copilot/Codex）がレビュー中やエラー状態のままマージすると、\nレビューなしでコードがマージされる。マージ前にAIレビュー状態を確認する。",
      "what": "- AIレビュアーがレビュー中かを確認\n- AIレビューエラーの検出\n- Copilotレビューの再リクエスト\n- 連続エラー時の警告付きマージ許可\n- Qodoコンプライアンス違反の検出",
      "remarks": "- フックではなくユーティリティモジュール\n- merge-check.pyから呼び出される\n- 連続エラー時は警告付きでマージ許可（緩和処理）",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "fix_verification_checker",
      "path": ".claude/hooks/fix_verification_checker.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "修正主張と検証チェックの関数群（merge-check用モジュール）。",
      "keywords": ["checker", "claude", "code", "fix", "fixed", "merge", "verification"],
      "why": "Claude Codeが「Fixed:」「修正済み」と主張しても、実際にコードが\n修正されているとは限らない。検証パターンの存在を確認することで、\n未検証の修正主張がマージされることを防ぐ。",
      "what": "- 修正主張キーワード検出（Fixed:, Added, 修正済み等）\n- 検証パターン検出（Verified:, 検証済み等）\n- 数値主張の検証（AIレビュアーの数値誤りを検出）\n- 具体的な修正箇所参照（ファイル:行番号）の検出",
      "remarks": "- review_checker.pyは却下・応答チェック担当\n- ai_review_checker.pyはAIレビュアーステータスチェック担当\n- 本モジュールは修正主張と検証に特化",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "flow_constants",
      "path": ".claude/hooks/flow_constants.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "Flow関連の共通定数モジュール。",
      "keywords": ["constants", "flow"],
      "why": "フロー関連の定数が複数ファイルで重複定義されていると、\n変更時の不整合が発生する。共通定数を一箇所にまとめる。",
      "what": "- OPTIONAL_PHASES: スキップ可能なフェーズ\n- PHASE_DEPENDENCIES: フェーズ間の依存関係\n- REQUIRED_PHASE_TRANSITIONS: 必須フェーズ遷移\n- BLOCKING_PHASE_TRANSITIONS: ブロック対象の遷移",
      "remarks": "- 定数定義のみ（フックではない）\n- flow-state-updater.py、flow-verifier.pyから共有",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "flow_definitions",
      "path": ".claude/hooks/flow_definitions.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "Flowの定義モジュール - 全フロー設定の単一真実源。",
      "keywords": ["definitions", "flow", "ide", "json", "python"],
      "why": "JSONでのフロー定義では動的パターンマッチングや型安全性が得られない。\nPython化することでIDEサポート、テスト容易性、ロジックとの統合を実現。",
      "what": "- FlowDefinitionクラスによる動的パターンマッチング\n- 13フェーズ開発ワークフローのフェーズ定義\n- ワークフロー検証用の期待フック動作定義\n- TaskType列挙によるセッション成果ベース評価",
      "remarks": "- flow-definitions.jsonを置き換え\n- get_flow_definition()、get_phase()、get_expected_hooks_for_phase()が主要API",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "issue_checker",
      "path": ".claude/hooks/issue_checker.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "merge-checkフックのIssue・受け入れ基準チェック機能。",
      "keywords": ["checker", "close", "issue", "merge"],
      "why": "未完了の受け入れ基準を持つIssueがCloseされると、品質管理が形骸化する。\nPRからIssue参照を抽出し、受け入れ基準の完了状態を確認する。",
      "what": "- PRボディからIssue参照を抽出（Closes #xxx等）\n- 受け入れ基準の完了チェック\n- レビューコメントからのバグIssue検出",
      "remarks": "- review_checker.py: レビュースレッド確認\n- ai_review_checker.py: AIレビュアーステータス\n- 本モジュールはIssueと受け入れ基準に特化",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "review_checker",
      "path": ".claude/hooks/review_checker.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "merge-checkフックのレビューコメント・スレッド検証機能。",
      "keywords": ["checker", "dismissal", "merge", "review"],
      "why": "PRマージ前にレビューコメントへの対応を検証することで、\n未解決のスレッドや不適切なdismissalを防ぐ。",
      "what": "- Dismissal検証（Issue参照必須）\n- 応答検証（Claude Code応答必須）\n- 未解決スレッド検出\n- セキュリティ指摘のIssue化強制",
      "remarks": "- fix_verification_checker.py: 修正主張の検証\n- ai_review_checker.py: AIレビュアーステータス確認\n- DISMISSAL_KEYWORDS/ACTION_KEYWORDS/DISMISSAL_EXCLUSIONSは意図的に冗長\n  （substring matchingでも網羅性・可読性のため明示的に記載）",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "shell_tokenizer",
      "path": ".claude/hooks/shell_tokenizer.py",
      "type": "hook",
      "language": "python",
      "hook_type": "unknown",
      "summary": "locked-worktree-guard用の低レベルシェルトークン化ユーティリティ。",
      "keywords": ["guard", "locked", "shell", "tokenizer", "worktree"],
      "why": "シェルコマンドを正確に解析するには、シェル演算子やリダイレクト、\n引用符を適切に処理する必要がある。低レベルのトークン化を一箇所に\nまとめることで、コマンド解析の信頼性を向上させる。",
      "what": "- シェル演算子の正規化（&&, ||, ;, |）\n- シェルリダイレクト検出\n- cdターゲット抽出\n- rmコマンドパス抽出\n- gitグローバルフラグからのベースディレクトリ抽出",
      "remarks": "- command_parser.py: 高レベルのコマンド固有解析を担当\n- 本モジュールは汎用的なシェルトークン化に特化\n- 引用符内の演算子処理は妥協（検出のみで実行はしないため許容）",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "abstract_issue_suggester",
      "path": ".claude/hooks/handlers/abstract_issue_suggester.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "具体的Issue作成時に抽象的対策Issueを自動提案する",
      "keywords": ["abstract", "issue", "suggester"],
      "why": "",
      "what": "",
      "remarks": "",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "acceptance_criteria_reminder",
      "path": ".claude/hooks/handlers/acceptance_criteria_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PR作成時に対象Issueの受け入れ条件未完了を警告する。",
      "keywords": ["acceptance", "criteria", "issue", "merge", "reminder"],
      "why": "受け入れ条件が未完了のままPRを作成すると、マージ時にmerge-checkで\nブロックされる。PR作成時に警告することで、事前に気づいて対処できる。",
      "what": "- gh pr createコマンドを検出\n- ブランチ名からIssue番号を抽出\n- 対象Issueの受け入れ条件（チェックボックス）を確認\n- 未完了項目がある場合に警告（ブロックはしない）",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで通知）\n- merge-checkはマージ時、本フックはPR作成時に警告\n- 取り消し線（~~）付きの項目はスキップ",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "active_worktree_check",
      "path": ".claude/hooks/handlers/active_worktree_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時に作業中（未マージ）のworktree一覧を表示する。",
      "keywords": ["active", "issue", "worktree"],
      "why": "複数セッション間で同じIssueへの重複着手を防止するため、\n既存の作業状況を把握する必要がある。",
      "what": "- 作業中のworktree（PRがOPEN/未作成）を検出\n- ブランチ名、PR状態、最終コミット情報を表示\n- 情報提供のみ（ブロックしない）",
      "remarks": "- 情報提供型フック（ブロックしない、systemMessageで通知）\n- worktree-session-guardはブロック、本フックは情報提供\n- session-worktree-statusは現在のworktree、本フックは全worktree\n- Python版: active_worktree_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "ai_review_followup_check",
      "path": ".claude/hooks/handlers/ai_review_followup_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "AIレビュー未対応コメント検知・Issue自動作成フック",
      "keywords": ["coderabbit", "copilot", "followup", "gemini", "issue", "review"],
      "why": "AIレビュー（CodeRabbit, Copilot, Gemini等）の指摘が対応されずにマージされると、\n潜在的な問題が見落とされる。マージ前に検知してIssue化することで追跡可能にする。",
      "what": "- gh pr merge コマンドを検出（PreToolUse:Bash）\n- PRのAIレビューコメントを取得\n- 未対応のactionableコメントを検出\n- 検出時は自動でIssueを作成し、マージを許可",
      "remarks": "- 非ブロック型（Issue作成後にマージを許可）\n- 対象AIレビュアー: coderabbitai[bot], copilot-pull-request-reviewer[bot], github-actions[bot] (Gemini/Codex)\n- 除外: LGTM系、resolvedスレッド",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "api_operation_logger",
      "path": ".claude/hooks/handlers/api_operation_logger.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "外部APIコマンド（gh, git, npm）の実行詳細をログ記録する。",
      "keywords": ["api", "git", "logger", "npm", "operation"],
      "why": "API操作の実行時間やエラー率を分析することで、ワークフローの\nボトルネックや障害パターンを特定できる。",
      "what": "- コマンドタイプと操作種別を記録\n- 実行時間（ms）を計測\n- 終了コードと成功/失敗を記録\n- レート制限エラーを検出・フラグ付け\n\nState:\n- writes: .claude/logs/execution/api-operations-{session}.jsonl",
      "remarks": "- ログ記録型フック（ブロックしない、記録のみ）\n- api-operation-timerと連携（開始時刻を記録）\n- gh/git/npmコマンドを対象",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "api_operation_timer",
      "path": ".claude/hooks/handlers/api_operation_timer.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "外部APIコマンドの開始時刻を記録する（api-operation-loggerと連携）。",
      "keywords": ["api", "logger", "operation", "posttooluse", "timer"],
      "why": "APIコマンドの実行時間を計測するため、開始時刻を記録しておく必要がある。\nPostToolUseフックで終了時刻と比較して実行時間を算出する。",
      "what": "- gh, git, npmコマンドを検出\n- 開始時刻を一時ファイルに記録\n- 古いタイミングファイルをクリーンアップ\n\nWhen:\n- PreToolUse（Bashコマンド実行前）\n\nState:\n- writes: /tmp/claude-hooks/api-timing/{session}-{tool_use_id}.json",
      "remarks": "- 記録型フック（ブロックしない、開始時刻の記録のみ）\n- api-operation-loggerと連携（本フックがPre、loggerがPost）\n- 1時間以上経過した古いファイルは自動クリーンアップ\n- Python版: api_operation_timer.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "askuser_suggestion",
      "path": ".claude/hooks/handlers/askuser_suggestion.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "選択肢をテキストで列挙するパターンを検出し、AskUserQuestionツールの使用を提案する。",
      "keywords": ["askuser", "askuserquestion", "suggestion"],
      "why": "テキストでの選択肢列挙はユーザーの入力負担が大きく、選択ミスのリスクがある。\nAskUserQuestionツールを使うことでUXが向上する。",
      "what": "- トランスクリプトから選択肢パターン（A案/B案、1./2.等）を検出\n- AskUserQuestion使用回数と比較\n- 過少な場合に警告を表示（ブロックしない）",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで通知）\n- コードブロック内のパターンは除外\n- セッション終了時（Stop）に発火\n- Python版: askuser_suggestion.py",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "bash_failure_tracker",
      "path": ".claude/hooks/handlers/bash_failure_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "連続Bash失敗を検知し、シェル破損時に引き継ぎプロンプト生成を提案する。",
      "keywords": ["bash", "failure", "tracker", "worktree"],
      "why": "worktreeの自己削除等でカレントディレクトリが消えると、シェルが破損状態になり\n全てのコマンドが失敗し続ける。この状態を早期検知して回復策を提示する。",
      "what": "- Bash失敗を連続カウント\n- シェル破損パターン（\"No such file or directory\"等）を検出\n- 閾値（3回連続）超過で警告と回復オプションを提示\n\nState:\n- writes: /tmp/claude-hooks/bash-failures.json",
      "remarks": "- 警告型フック（ブロックしない、回復策を提示）\n- PostToolUse:Bashで発火\n- シェル破損パターンはre.IGNORECASEでマッチング",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "block_improvement_reminder",
      "path": ".claude/hooks/handlers/block_improvement_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "同一フックの連続ブロックを検知し、フック改善を提案する。",
      "keywords": ["block", "improvement", "reminder", "skip"],
      "why": "同じフックが3回以上連続でブロックする場合、フック自体に改善の余地がある\n可能性が高い。SKIP環境変数やメッセージ改善を提案する。",
      "what": "- セッション内の連続ブロックをフック別にカウント\n- 閾値（3回連続）超過で改善リマインダーを表示\n- セッション内で同一フックへのリマインダーは1回のみ\n\nState:\n- reads: .claude/logs/execution/hook-execution-{session}.jsonl\n- writes: .claude/logs/session/block-reminder-{session}-{hook}.marker",
      "remarks": "- 警告型フック（ブロックしない、改善提案を表示）\n- PreToolUseで発火（次のツール実行前にチェック）\n- マーカーファイルで同一フックへの重複リマインダーを防止",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "block_response_tracker",
      "path": ".claude/hooks/handlers/block_response_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ブロック後にテキストのみ応答（ツール呼び出しなし）を検知し警告する。",
      "keywords": ["agents", "block", "response", "tracker"],
      "why": "AGENTS.mdでは「ブロックは代替アクションを実行せよ」と定めている。\nブロック後にツール呼び出しがない場合、エージェントループが停止している。",
      "what": "- セッション終了時にブロックパターンを分析\n- ブロック後にツール呼び出しがないケースを検出\n- 警告メッセージを表示（ブロックしない）\n\nState:\n- reads: .claude/logs/metrics/block-patterns-{session}.jsonl\n- reads: .claude/logs/execution/hook-execution-{session}.jsonl",
      "remarks": "- 分析型フック（ブロックしない、パターン分析のみ）\n- セッション終了時（Stop）に発火\n- SessionStartなど非ツールフックは除外",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "branch_check",
      "path": ".claude/hooks/handlers/branch_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にメインリポジトリのブランチ状態を確認する。",
      "keywords": ["branch", "main", "worktree"],
      "why": "メインリポジトリがmain以外のブランチの状態でセッションを開始すると、\nworktreeワークフローを無視した作業につながる可能性がある。",
      "what": "- 現在のディレクトリがworktree内かどうか確認\n- worktree内でなければ、現在のブランチを確認\n- mainでない場合はセッション開始をブロック\n- mainブランチに戻す手順を提示",
      "remarks": "- ブロック型フック（mainでない場合はブロック）\n- worktree内の場合はスキップ（worktreeでは任意ブランチを許可）\n- SessionStartで発火",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "branch_rename_guard",
      "path": ".claude/hooks/handlers/branch_rename_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "git branch -m/-Mコマンド（ブランチリネーム）をブロックする。",
      "keywords": ["branch", "git", "guard", "main", "master", "rename"],
      "why": "ブランチリネームはmain/masterのgit設定破損、リモートとの不整合、\n他のセッションやCIとの競合を引き起こす可能性がある。",
      "what": "- git branch -m/-M/--moveコマンドを検出\n- 検出時にブロック\n- 意図的なリネーム用のスキップ方法を提示",
      "remarks": "- ブロック型フック（ブランチリネームはブロック）\n- SKIP_BRANCH_RENAME=1で意図的なリネームを許可\n- PreToolUse:Bashで発火",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "bug_issue_creation_guard",
      "path": ".claude/hooks/handlers/bug_issue_creation_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRスコープの問題に対する別Issue作成をブロックする。",
      "keywords": ["bug", "creation", "guard", "issue"],
      "why": "PRで導入した問題（バグ、テスト不足、エッジケース等）は同じPRで修正すべき。\n別Issueを作成すると問題が残ったままマージされるリスクがある。",
      "what": "- gh issue createコマンドを検出\n- タイトルからPRスコープのパターン（fix:, test:, バグ等）を検出\n- 現在のブランチにオープンPRがある場合はブロック\n- PR内での修正を案内",
      "remarks": "- ブロック型フック（PRスコープの問題Issue作成はブロック）\n- オープンPRがない場合はスキップ\n- PreToolUse:Bashで発火",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "bypass_analysis",
      "path": ".claude/hooks/handlers/bypass_analysis.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に回避パターンを分析し、警告を表示する。",
      "keywords": ["analysis", "bypass"],
      "why": "回避パターンが検出されても、振り返りで分析されなければ対策が講じられない。\nセッション終了時に自動的に分析結果を表示することで、対策を促す。",
      "what": "- Stopフックで発火\n- セッションの回避パターンログを読み込み\n- 回避パターンがあれば警告を表示\n- 繰り返しパターンを強調\n\nState:\n- reads: .claude/logs/metrics/bypass-patterns-{session}.jsonl",
      "remarks": "- 非ブロック型（警告のみ、セッション終了をブロックしない）\n- 回避パターンがなければ何も表示しない",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "bypass_detector",
      "path": ".claude/hooks/handlers/bypass_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "回避行動を検知してセッションログに記録する。",
      "keywords": ["bypass", "detector"],
      "why": "フックのブロックやルールを回避する行動は、同じパターンが繰り返される原因となる。\n回避行動を検知して記録することで、振り返り時に分析・対策を行える。",
      "what": "- PostToolUse:Bashで発火\n- 連続失敗→成功パターンを検出（オプション変更での回避）\n- 類似コマンドでのツール切り替えを検出\n- 回避パターンをセッションログに記録\n\nState:\n- reads/writes: /tmp/claude-hooks/bypass-tracker-{session}.json\n- writes: .claude/logs/metrics/bypass-patterns-{session}.jsonl",
      "remarks": "- 非ブロック型（記録のみ、振り返りで分析）\n- 正当な回避（フック指示に従った代替アクション）は除外",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "checkout_block",
      "path": ".claude/hooks/handlers/checkout_block.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "mainリポジトリでのブランチ操作をブロックする。",
      "keywords": ["block", "checkout", "main", "worktree"],
      "why": "mainリポジトリで直接ブランチ操作を行うと、worktreeワークフローをバイパスし、\n他のセッションとの競合やクリーンな環境維持が困難になる。",
      "what": "- git checkout/switchでmain/master/develop以外へのcheckoutをブロック\n- git branchで新規ブランチ作成をブロック\n- worktree作成手順を提示",
      "remarks": "- ブロック型フック（worktreeワークフロー強制）\n- worktree内では発火しない（cwdが.worktrees/内ならスキップ）\n- PreToolUse:Bashで発火",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "ci_monitor_session_id_check",
      "path": ".claude/hooks/handlers/ci_monitor_session_id_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ci_monitor（TypeScript版）のsession-idオプション指定を検出する。",
      "keywords": ["claude", "code", "monitor", "ppid", "session", "typescript"],
      "why": "session-idが指定されないと、ci_monitorはppidベースのセッション特定に\nフォールバックし、ログがClaude Codeセッションと正しく紐付かなくなる。",
      "what": "- ci_monitor_ts/main.ts呼び出しを検出\n- --session-idオプションの有無を確認\n- 未指定の場合は警告メッセージを表示",
      "remarks": "- 警告型フック（ブロックしない、警告のみ）\n- PreToolUse:Bashで発火\n- AGENTS.mdにsession-id指定が必須と記載されている",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "ci_recovery_tracker",
      "path": ".claude/hooks/handlers/ci_recovery_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "CI失敗から復旧までの時間を追跡する。",
      "keywords": ["recovery", "tracker"],
      "why": "CI失敗の復旧時間を計測することで、チームの対応速度を可視化し、\n改善の指標として活用できる。",
      "what": "- CI失敗時にタイムスタンプを記録\n- CI成功時に復旧時間を計算してログ記録\n- 復旧時間をsystemMessageで表示\n\nState:\n- writes: {TMPDIR}/claude-hooks/ci-recovery.json\n- writes: .claude/logs/metrics/ci-recovery-metrics.log",
      "remarks": "- 記録型フック（ブロックしない、メトリクス記録）\n- PostToolUse:Bashで発火（gh pr checks結果を分析）\n- ブランチ別に失敗タイムスタンプを保持",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "ci_wait_check",
      "path": ".claude/hooks/handlers/ci_wait_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ci_monitor（TypeScript版）を使用すべきコマンドをブロックする。",
      "keywords": ["behind", "checks", "monitor", "typescript", "wait", "watch"],
      "why": "gh pr checks --watch や手動ポーリングは冗長なログでコンテキストを消費し、\nBEHIND検知や自動リベースなどの機能がない。ci_monitorを使用すべき。",
      "what": "- gh pr checks --watchをブロック\n- gh run watchをブロック（冗長ログ）\n- 手動PR状態チェック（gh api /pulls/xxx）をブロック\n- 手動ポーリング（sleep && gh ...）をブロック\n- ci_monitor（TypeScript版）の使用を案内",
      "remarks": "- ブロック型フック（非推奨コマンドはブロック）\n- PreToolUse:Bashで発火\n- コメント/メッセージ内のパターンは除外（引用符内は検査しない）\n\nLimitations (Issue #3118):\n- `bash -c \"sleep 5m && gh...\"` のようなラップコマンドは検出しない\n- 設計判断: 誤検知防止を優先（echo/grep内のパターン誤検知を避ける）\n- bash -cで意図的にラップするケースは稀なため許容",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "closes_keyword_check",
      "path": ".claude/hooks/handlers/closes_keyword_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr create時にClosesキーワードの有無をチェックし、追加を提案する。",
      "keywords": ["closes", "create", "issue", "keyword"],
      "why": "PRボディにClosesキーワードがないと、マージ時にIssueが自動クローズされず\n手動でのクローズ忘れにつながる。",
      "what": "- ブランチ名からIssue番号を抽出\n- PRボディにCloses/Fixes/Resolvesキーワードがあるか確認\n- ない場合は追加を提案（ブロックしない）",
      "remarks": "- 提案型フック（ブロックしない、systemMessageで提案）\n- PreToolUse:Bashで発火（gh pr createコマンド）\n- --body-file/-Fオプション使用時はスキップ（ファイル内容は検査不可）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "closes_scope_check",
      "path": ".claude/hooks/handlers/closes_scope_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PR作成時に未完了タスクのあるIssueをCloseしようとしていないかチェックする。",
      "keywords": ["close", "closes", "issue", "scope"],
      "why": "受け入れ条件が未完了のIssueをPRでCloseすると、タスクが未完のままクローズされる。\nPR作成時に検出することで、マージ前に対処できる。",
      "what": "- gh pr createコマンドを検出\n- PRボディからCloses/Fixes #xxxを抽出\n- 対象Issueの受け入れ条件（チェックボックス）を確認\n- 未完了項目がありIssue参照がない場合はブロック",
      "remarks": "- ブロック型フック（未完了タスクClose時はブロック）\n- PreToolUse:Bashで発火（gh pr createコマンド）\n- 取り消し線付き項目は完了扱い（Issue #823）\n- 未完了項目に別Issue参照があれば許可（段階的実装パターン）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "closes_validation",
      "path": ".claude/hooks/handlers/closes_validation.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "コミットメッセージのCloses/Fixesキーワードの整合性をチェックする。",
      "keywords": ["close", "closes", "fixes", "issue", "validation"],
      "why": "大規模Issueを小さな変更でCloseしようとすると、タスクの一部のみが完了した状態で\nIssueがクローズされる。コミット時にサイズ乖離を警告する。",
      "what": "- git commitコマンドを検出\n- コミットメッセージからCloses/Fixes #xxxを抽出\n- Issue情報（タイトル、ラベル、本文）を取得して表示\n- コミットサイズとIssueサイズの乖離を警告（ブロックはしない）",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで警告）\n- PreToolUse:Bashで発火（git commitコマンド）\n- -a/-amフラグ対応（HEADとの差分を確認）\n- Issue本文/ラベル/タイトルからサイズを推定",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "code_simplifier_check",
      "path": ".claude/hooks/handlers/code_simplifier_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "simplifying-code Skill実行をPR作成前に強制する",
      "keywords": ["code", "simplifier", "simplifying", "skill"],
      "why": "AI生成コードは無駄に複雑になりがちで、レビューで指摘されてから修正すると\n手戻りが発生する。PR作成前にsimplifying-codeを実行することで、\nコードの複雑さを事前に検知・修正できる。",
      "what": "- gh pr createコマンドを検出\n- 現在のブランチでsimplifying-codeが実行済みか確認\n- 未実行の場合はSkill実行を促すメッセージを表示\n- コードファイルがない変更は自動スキップ（ホワイトリスト方式）\n\nState:\n- reads: .claude/logs/markers/code-simplifier-{branch}.done",
      "remarks": "- ブロック型フック（未実行時はブロック）\n- PreToolUse:Bashで発火（gh pr createコマンド）\n- main/masterブランチはスキップ\n- コードファイルがない変更はスキップ（simplifying-codeはコード向け）\n- SKIP_CODE_SIMPLIFIER=1でバイパス可能\n- code_simplifier_logger.tsと連携（マーカーファイル読み込み）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "code_simplifier_logger",
      "path": ".claude/hooks/handlers/code_simplifier_logger.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "code-simplifier実行をログ記録する",
      "keywords": ["code", "logger", "simplifier"],
      "why": "code_simplifier_check.tsがPR作成前にcode-simplifier実行済みかを確認するため、\n実行時にブランチ・コミット情報を記録しておく必要がある。",
      "what": "- Skillツールで /simplifying-code の実行を検出\n- ブランチ名、コミットハッシュを記録\n- main/masterブランチでは記録しない\n\nState:\n- writes: .claude/logs/markers/code-simplifier-{branch}.done",
      "remarks": "- 記録型フック（ブロックしない、マーカーファイル書き込み）\n- PostToolUse:.*で発火（全ツール対象、フック内でフィルタリング）\n- code_simplifier_check.tsと連携（マーカーファイル参照元）",
      "trigger": "PostToolUse",
      "matcher": ".*"
    },
    {
      "name": "coderabbit_review_check",
      "path": ".claude/hooks/handlers/coderabbit_review_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "CodeRabbitのactionable commentsをマージ前にチェックする。",
      "keywords": ["actionable", "coderabbit", "comments", "diff", "outside", "range", "review"],
      "why": "CodeRabbitが「Actionable comments」や「Outside diff range comments」として\n改善提案を出しても、マージ前に気づく仕組みがなく見落とされていた。",
      "what": "- gh pr mergeコマンドを検出\n- CodeRabbitのレビューコメントをGitHub APIで取得\n- 「Actionable comments posted: N」(N>0)を検出\n- 「Outside diff range comments (N)」(N>0)を検出\n- 検出時はブロックし、対応を促す",
      "remarks": "- ブロック型フック（未対応のactionable comments時はブロック）\n- PreToolUse:Bashで発火（gh pr mergeコマンド）\n- SKIP_CODERABBIT_REVIEW=1でバイパス可能",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "codex_review_check",
      "path": ".claude/hooks/handlers/codex_review_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Codex CLIレビュー実行をPR作成・push前に強制する。",
      "keywords": ["cli", "codex", "push", "review"],
      "why": "コードレビューなしでPRを作成・pushすると、品質問題がCIやAIレビューで\n初めて発覚し、手戻りが発生する。事前のローカルレビューで品質を担保する。",
      "what": "- gh pr create / git pushコマンドを検出\n- 現在のブランチ・コミットでcodex reviewが実行済みか確認\n- 未実行またはコミット変更後は再レビューを要求\n- リベース後も差分が同一ならスキップ\n\nState:\n- reads: .claude/logs/markers/codex-review-{branch}.done",
      "remarks": "- ブロック型フック（レビュー未実行時はブロック）\n- PreToolUse:Bashで発火（gh pr create/git pushコマンド）\n- main/masterブランチはスキップ\n- SKIP_CODEX_REVIEW=1でバイパス可能\n- codex-review-logger.tsと連携（マーカーファイル読み込み）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "codex_review_logger",
      "path": ".claude/hooks/handlers/codex_review_logger.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Codex CLIレビュー実行をログ記録する（codex-review-checkと連携）。",
      "keywords": ["cli", "codex", "logger", "push", "review"],
      "why": "codex-review-checkがPR作成/push前にレビュー実行済みかを確認するため、\nレビュー実行時にブランチ・コミット情報を記録しておく必要がある。",
      "what": "- codex reviewコマンドを検出\n- ブランチ名、コミットハッシュ、diffハッシュを記録\n- main/masterブランチでは記録しない\n\nState:\n- writes: .claude/logs/markers/codex-review-{branch}.done",
      "remarks": "- 記録型フック（ブロックしない、マーカーファイル書き込み）\n- PreToolUse:Bashで発火（codex reviewコマンド）\n- codex-review-check.pyと連携（マーカーファイル参照元）\n- diffハッシュ記録によりリベース後のスキップ判定が可能",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "codex_review_output_logger",
      "path": ".claude/hooks/handlers/codex_review_output_logger.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Codex CLIレビュー出力をパースしてレビューコメントを記録する。",
      "keywords": ["cli", "codex", "logger", "output", "review"],
      "why": "Codex CLIレビューの結果を分析することで、レビュー品質の追跡や\nよくある指摘パターンの特定ができる。",
      "what": "- codex review出力からレビューコメントを抽出\n- 個別コメントをreview-quality.jsonlに記録\n- 実行メタデータをcodex-reviews.jsonlに記録\n- コメント数ゼロならpass、あればfailとして記録\n\nState:\n- writes: .claude/logs/metrics/review-quality-{session}.jsonl\n- writes: .claude/logs/metrics/codex-reviews-{session}.jsonl\n- writes: .claude/logs/markers/codex-rate-limit-{branch}.marker (when rate limited)",
      "remarks": "- 記録型フック（ブロックしない、メトリクス記録）\n- PostToolUse:Bashで発火（codex reviewコマンド）\n- JSON出力/行単位出力の両方をパース対応\n- exit_code != 0の場合もerrorとして記録\n- レート制限検出時はマーカーファイルを作成（codex_review_checkと連携）",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "commit_amend_block",
      "path": ".claude/hooks/handlers/commit_amend_block.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "mainリポジトリでのgit commit --amendをブロックする。",
      "keywords": ["amend", "block", "commit", "git", "main", "worktree"],
      "why": "mainブランチの履歴を変更すると、他のworktreeやリモートと不整合が発生する。\n誤操作を防ぐため、mainリポジトリでの--amendは禁止する。",
      "what": "- git commit --amendコマンドを検出\n- worktree内での実行は許可\n- mainリポジトリでの実行はブロック\n- workteeへの移動手順を提示",
      "remarks": "- ブロック型フック（mainリポジトリでの--amendはブロック）\n- PreToolUse:Bashで発火（git commitコマンド）\n- checkout-block.pyと同様のworktree判定ロジック",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "commit_marker_update",
      "path": ".claude/hooks/handlers/commit_marker_update.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "git commit後にCodexレビューマーカーを更新する。",
      "keywords": ["codex", "commit", "git", "marker", "review", "update"],
      "why": "レビュー済みブランチで追加コミットをした場合、マーカーを更新しないと\ncodex-review-checkが「レビュー後にコミットあり」と誤検知する。\nコミット後にマーカーを更新することで、不要な再レビューを防ぐ。",
      "what": "- git commitコマンドを検出\n- 既存マーカーファイルがあれば新しいコミット情報で更新\n- main/masterブランチでは更新しない\n- HEADが変わっていない場合はスキップ\n\nState:\n- reads: .claude/logs/markers/codex-review-{branch}.done\n- writes: .claude/logs/markers/codex-review-{branch}.done",
      "remarks": "- 記録型フック（ブロックしない、マーカー更新）\n- PostToolUse:Bashで発火（git commitコマンド）\n- 既存マーカーがない場合は何もしない（新規作成しない）",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "commit_message_template",
      "path": ".claude/hooks/handlers/commit_message_template.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "git commit時にコミットメッセージテンプレートを挿入する。",
      "keywords": ["commit", "git", "message", "refs", "template", "what", "why"],
      "why": "「なぜ」の背景情報が欠けたコミットメッセージが多い。テンプレートで\nWhy/What/Refsの構造を提示することで、背景を書く習慣を促す。",
      "what": "- git commit（-mオプションなし）時にテンプレートを挿入\n- 既にユーザーコンテンツがある場合はスキップ\n- merge/squash/amend等ではスキップ",
      "remarks": "- lefthook経由でprepare-commit-msgとして実行\n- Claude Codeフックではなく、Gitフック\n- -m/-F/--amend等オプション時は発火しない\n- commit-message-why-check.tsとセットで使用\n- Python版: commit_message_template.py からの移行",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "commit_message_why_check",
      "path": ".claude/hooks/handlers/commit_message_why_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "コミットメッセージに「なぜ」の背景が含まれているかをチェックする。",
      "keywords": ["blame", "commit", "git", "message", "why"],
      "why": "コードの差分は「何を」変更したかを示すが、「なぜ」その変更が必要だったかは\n時間とともに失われる。git blameで追跡できるよう背景の記録を強制する。",
      "what": "- コミットメッセージから「なぜ」を示すキーワードを検索\n- Issue参照があればコンテキストありと判定\n- 不足の場合はコミットをブロック",
      "remarks": "- lefthook経由でcommit-msgとして実行\n- Claude Codeフックではなく、Gitフック\n- merge/revert/WIP/fixup等は自動スキップ\n- commit-message-template.pyとセットで使用",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "continuation_session_metrics",
      "path": ".claude/hooks/handlers/continuation_session_metrics.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "継続セッションを検出し、前セッションのメトリクス記録と開発フローリマインダーを表示する。",
      "keywords": ["context", "continuation", "hook", "metrics", "resumption", "session", "stop"],
      "why": "コンテキスト継続（context resumption）時はStop hookが発火しないため、\n前セッションのメトリクスが失われる。また開発フローの意識がリセットされ\n手順スキップによる連続ブロックが発生する。",
      "what": "- handoff-state.jsonの更新時刻で継続セッションを判定\n- 未記録の前セッションメトリクスを収集・記録\n- 開発フローチェックリストを表示\n\nState:\n- reads: .claude/state/handoff-state.json\n- reads: .claude/logs/metrics/session-metrics.log\n- reads: .claude/logs/execution/hook-execution-{session}.jsonl\n- writes: .claude/logs/metrics/session-metrics.log",
      "remarks": "- 情報注入型フック（ブロックしない、systemMessageで情報表示）\n- SessionStartで発火\n- collect_session_metrics.pyスクリプトを呼び出してメトリクス収集\n- 継続判定の時間窓は5分（CONTINUATION_WINDOW_MINUTES）\n- 1回の継続で最大3セッション分のメトリクスを収集\n- Python版: continuation_session_metrics.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "copilot_review_retry_suggestion",
      "path": ".claude/hooks/handlers/copilot_review_retry_suggestion.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Copilot reviewの繰り返しエラー時にPR作り直しを提案する。",
      "keywords": ["copilot", "retry", "review", "suggestion"],
      "why": "Copilot reviewは特定の状況でエラーを返し続けることがあり、\nPRを作り直すことで解決する場合がある。無駄なリトライを防ぐ。",
      "what": "- Copilot reviewエラーを検出・カウント\n- 閾値を超えたらPR作り直しを提案\n- PR切り替え時にカウンタをリセット\n\nState:\n- writes: {TMPDIR}/claude-hooks/copilot-review-errors-{session}.json",
      "remarks": "- 提案型フック（ブロックしない、systemMessageで提案）\n- PostToolUse:Bashで発火\n- エラー閾値は3回（ERROR_THRESHOLD）\n- PR切り替え時にカウンタ自動リセット\n- 成功時もカウンタリセット",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "cwd_check",
      "path": ".claude/hooks/handlers/cwd_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "カレントディレクトリの存在を確認し、削除されていればセッションをブロックする。",
      "keywords": ["cwd", "worktree"],
      "why": "worktree削除などでカレントディレクトリが消失すると、\n以降のファイル操作が予期せず失敗し、データ損失につながる可能性がある。",
      "what": "- カレントディレクトリの存在を確認\n- 存在しない場合はセッションをブロック\n- Claude Code再起動の案内を表示",
      "remarks": "- ブロック型フック（cwd消失時はブロック）\n- PreToolUseで発火（全ツール対象）\n- stop_hook_active時は無限ループ防止のためスキップ\n- worktree削除後のセッション継続防止が主な用途",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "date_context_injector",
      "path": ".claude/hooks/handlers/date_context_injector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時に現在日時とセッションIDをコンテキストに注入する",
      "keywords": ["claude", "code", "context", "date", "injector"],
      "why": "Claude Codeは明示的な日付コンテキストがない場合、知識カットオフ時点の\n日時にデフォルトしやすい。現在日時を注入することで正確な時間認識を保証する。",
      "what": "- 現在日時をISO8601形式で出力\n- セッションIDを出力",
      "remarks": "- TZ環境変数でタイムゾーン設定可能（デフォルト: Asia/Tokyo）\n- Python版: date_context_injector.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "defer_keyword_check",
      "path": ".claude/hooks/handlers/defer_keyword_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "「後で」キーワードを検出しIssue作成との照合を行う。",
      "keywords": ["defer", "issue", "keyword"],
      "why": "「後で対応」「スコープ外」等の発言がIssue参照なしだと、対応が忘れられる。\n発言だけで終わり、Issueが作成されないまま忘却されるケースを防止する。",
      "what": "- Stage 1: 正規表現で明確な「後で」系キーワードを検出\n- Stage 2: 婉曲表現をsystemMessage経由でLLMに評価依頼\n- Stage 3: 「後で」発言数とセッション内Issue作成数を照合\n- 発言数 > Issue作成数の場合はブロック",
      "remarks": "- ブロック型フック（未対応の「後で」発言がある場合）\n- Stopで発火（transcript分析）\n- 3段階検出: Stage1=正規表現、Stage2=LLM評価、Stage3=Issue作成照合\n- コードブロック内・ドキュメント参照は除外\n- Issue参照が近くにあれば違反としない",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "dependabot_skill_reminder",
      "path": ".claude/hooks/handlers/dependabot_skill_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Dependabot PR操作時にmanaging-developmentスキルの参照を促す。",
      "keywords": ["dependabot", "development", "managing", "reminder", "skill"],
      "why": "Dependabot PRのマージはリスク順序・E2Eテストなど特別な手順が必要。\nスキルを参照せずに操作すると、本番障害につながる可能性がある。",
      "what": "- gh pr merge/rebase/checkout等のDependabot PR操作を検出\n- managing-developmentスキルの参照を促す警告を表示\n- ブロックはせず、情報提供のみ",
      "remarks": "- 警告型フック（ブロックしない、stderrで警告）\n- PreToolUse:Bashで発火（gh prコマンド）\n- gh api呼び出しでDependabot PRを判定",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "dependency_check_reminder",
      "path": ".claude/hooks/handlers/dependency_check_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "依存関係追加時にContext7/Web検索での最新情報確認を促す。",
      "keywords": ["api", "context", "dependency", "reminder", "web"],
      "why": "古いAPIや非推奨メソッドの使用を防ぐため、パッケージ追加時に\n最新のドキュメントを確認する習慣を促進する。",
      "what": "- pnpm add, npm install, pip install等を検出\n- Context7やWeb検索での最新情報確認を促すメッセージを表示\n- セッション内で同じパッケージへの重複リマインドを防止\n\nState:\n- writes: $TMPDIR/claude-hooks/dependency-check-reminded-{session}.json",
      "remarks": "- 情報提供型フック（ブロックしない、systemMessageでリマインド）\n- PreToolUse:Bashで発火（pnpm/npm/pip/uv等）\n- セッション内で同じパッケージへの重複リマインド防止\n- requirements.txtインストール（-r）は除外\n- Python版: dependency_check_reminder.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "development_workflow_tracker",
      "path": ".claude/hooks/handlers/development_workflow_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "開発ワークフローの開始を追跡する。",
      "keywords": ["development", "issue", "tracker", "workflow", "worktree"],
      "why": "Issue単位の開発ワークフロー（worktree作成→実装→レビュー→マージ）を\n追跡することで、ステップのスキップを検出し、品質を担保できる。",
      "what": "- git worktree addコマンドを検出\n- Issue番号を抽出してワークフローを開始\n- worktree_createdステップを完了としてマーク\n\nState:\nwrites: .claude/logs/flow/flow-progress-{session_id}.jsonl",
      "remarks": "- ステップ完了の追跡はflow-progress-tracker.tsが担当\n- Python版からTypeScriptへ移行（Issue #3051）",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "doc_edit_check",
      "path": ".claude/hooks/handlers/doc_edit_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "仕様ドキュメント編集時に関連コード・Issueの確認を促す。",
      "keywords": ["doc", "edit", "issue"],
      "why": "ドキュメントを根拠なしに編集すると、誤記や実装との矛盾が生じる。\n「状態確認ファースト原則」をドキュメント編集にも適用する。",
      "what": "- .claude/skills/, AGENTS.md等の編集を検出\n- 関連コード・Issue確認を促すメッセージを表示\n- セッション内で同一ファイルへの重複警告を防止\n\nState:\n- writes: {TMPDIR}/claude-hooks/doc-edit-confirmed-{session}.json",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで警告）\n- PreToolUse:Edit/Writeで発火\n- セッション内で同一ファイルへの重複警告防止\n- .claude/skills/, AGENTS.md等を対象",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "doc_implementation_mismatch_detector",
      "path": ".claude/hooks/handlers/doc_implementation_mismatch_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ドキュメントと実装の乖離を検出してIssue作成を強制する",
      "keywords": ["agents", "detector", "doc", "implementation", "issue", "mismatch", "skills"],
      "why": "AGENTS.mdやSkillsで記載されているツール/プラグインが実際には動作しない場合、\nユーザーが混乱し、手動で回避するだけでは問題が残り続ける。\n乖離を検出して即座にIssue化することで、問題を追跡可能にする。",
      "what": "- PostToolUse:Skill/Task で発火\n- \"Unknown skill\" や \"Agent type not found\" エラーを検出\n- 該当名がAGENTS.mdに記載されているか確認\n- 記載されているのに動作しない場合、Issue作成を強制\n\nDetection patterns:\n- Skill: \"Unknown skill: XXX\" or \"Error: Unknown skill: XXX\"\n- Task: \"Agent type 'XXX' not found\"",
      "remarks": "- ブロック型（Issue作成を強制）\n- AGENTS.mdとの照合で誤検知を防止",
      "trigger": "PostToolUse",
      "matcher": "Skill"
    },
    {
      "name": "doc_reference_warning",
      "path": ".claude/hooks/handlers/doc_reference_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Bash失敗時にドキュメント参照の古さを検出して警告する。",
      "keywords": ["bash", "doc", "reference", "warning"],
      "why": "削除されたスクリプトがドキュメントに参照として残っていると、\nそのドキュメントを信じて実行したコマンドが失敗する。早期検知が必要。",
      "what": "- Bashコマンド失敗時にトランスクリプトを分析\n- 最近読み込んだ.mdファイルで失敗コマンドを検索\n- ドキュメントに記載されていた場合は古い可能性を警告",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで警告）\n- PostToolUse:Bashで発火（exit_code != 0時のみ）\n- \"No such file or directory\"エラー時のみ動作\n- .claude/scripts/, .claude/hooks/のパターンを検索",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "dogfooding_reminder",
      "path": ".claude/hooks/handlers/dogfooding_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "スクリプト作成・変更時に実データでのテストを促す（Dogfooding）。",
      "keywords": ["dogfooding", "reminder"],
      "why": "データ処理スクリプトをテストなしでコミットすると、実データで初めて\nバグが発覚する。自分で使って問題を体験してから完了とする習慣を促進。",
      "what": "- .claude/scripts/*.pyへのWrite/Editを検出\n- データ処理パターン（subprocess, json.loads等）を含む場合に警告\n- Dogfoodingチェックリストを表示\n\nState:\n- writes: .claude/logs/dogfooding/reminded-{session}.txt",
      "remarks": "- リマインド型フック（ブロックしない、systemMessageで提案）\n- PreToolUse:Write/Editで発火\n- .claude/scripts/*.pyが対象（tests/は除外）\n- データ処理パターン（subprocess, json.loads等）を含む場合のみ",
      "trigger": "PostToolUse",
      "matcher": "Write"
    },
    {
      "name": "duplicate_issue_check",
      "path": ".claude/hooks/handlers/duplicate_issue_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue作成前に類似Issueを検索して重複を警告する。",
      "keywords": ["duplicate", "issue"],
      "why": "同じ問題のIssueが重複作成されると、議論が分散し対応が遅れる。\n作成前に類似Issueを表示することで重複を防止する。",
      "what": "- gh issue createコマンドを検出\n- タイトルからキーワードを抽出して類似Issueを検索\n- 類似Issueがあれば警告メッセージを表示",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで警告）\n- PreToolUse:Bashで発火（gh issue createコマンド）\n- ストップワード除外でキーワード抽出精度を向上\n- 最大5件の類似Issueを表示",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "e2e_test_check",
      "path": ".claude/hooks/handlers/e2e_test_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "CI E2E失敗後のローカルテスト実行を強制する。",
      "keywords": ["e2e", "test"],
      "why": "CI E2Eテストが失敗した状態でプッシュを繰り返すと、CI負荷増加と\n開発効率低下を招く。ローカルでテストを通すことで、高品質な\nコードのみがプッシュされる。",
      "what": "- git pushコマンドを検出\n- E2Eテストファイル（tests/**\\/*.spec.ts）の変更を確認\n- CI失敗記録があり、ローカルテスト成功記録がない場合はブロック\n\nState:\nreads: .claude/state/markers/ci-e2e-failure-{branch}.log\nreads: .claude/state/markers/e2e-test-{branch}.done",
      "remarks": "- ローカルテスト結果は30分間有効\n- CI失敗記録は4時間で自動的に無効化される",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "e2e_test_recorder",
      "path": ".claude/hooks/handlers/e2e_test_recorder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "E2Eテスト実行結果を記録する。",
      "keywords": ["e2e", "recorder", "test"],
      "why": "e2e-test-check.pyがプッシュ前にローカルテスト実行を検証するため、\nテスト結果の記録が必要。結果を永続化することで、プッシュ時の\n判定が可能になる。",
      "what": "- npm run test:e2e等のコマンド完了を検出\n- 終了コードと出力からテスト結果（pass/fail）を判定\n- ブランチ・コミット情報とともに結果を記録\n\nState:\n- writes: .claude/state/markers/e2e-test-{branch}.done",
      "remarks": "- 記録型フック（ブロックしない、マーカーファイル書き込み）\n- PostToolUse:Bashで発火（npm/pnpm test:e2e、npx playwrightコマンド）\n- e2e-test-check.pyと連携（マーカーファイル参照元）\n- exit_codeまたは出力パターンでpass/failを判定",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "empty_return_check",
      "path": ".claude/hooks/handlers/empty_return_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "except内での空コレクション返却アンチパターンを検出する。",
      "keywords": ["empty", "except", "return"],
      "why": "例外発生時に空リストを返すと、「成功したが結果が空」と「失敗」の\n区別がつかなくなる。呼び出し側が失敗を「データなし」と誤解し、\n不正な処理を続行するバグの原因となる。",
      "what": "- Python ファイルの Write/Edit を検出\n- 正規表現で except ブロック内の `return []` や `return {}` を検出\n- 検出時は None を返すことを推奨する警告を表示",
      "remarks": "- テストファイルは意図的なパターンの可能性があるため除外\n- ブロックはせず警告のみ（P2レベル）\n- Python版のAST解析より簡易だが、主要パターンは検出可能\n- Python版: empty_return_check.py",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "env_undefined_check",
      "path": ".claude/hooks/handlers/env_undefined_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Edit時に process.env への undefined 代入を検出して警告。",
      "keywords": [
        "deleteproperty",
        "edit",
        "env",
        "key",
        "node",
        "process",
        "reflect",
        "undefined"
      ],
      "why": "Node.js では process.env の値は常に文字列であり、undefined を代入すると\n文字列 \"undefined\" が設定される。環境変数を削除する意図なら\nReflect.deleteProperty(process.env, \"KEY\") を使用すべき。",
      "what": "- Edit/Write ツール実行を検出\n- new_string/content から process.env.X = undefined パターンを検索\n- 検出時は systemMessage で警告（Reflect.deleteProperty への変更を推奨）",
      "remarks": "- 非ブロック型（警告のみ）\n- PreToolUse:Edit, PreToolUse:Write フック\n- .ts, .tsx, .js, .jsx ファイルが対象",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "environment_integrity_check",
      "path": ".claude/hooks/handlers/environment_integrity_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "フック環境の整合性をチェックする。",
      "keywords": ["environment", "integrity", "json", "settings"],
      "why": "settings.jsonに登録されたフックファイルが存在しないと、\n他のフックが期待通りに動作しない。セッション開始時に\n不足を検出し、早期に問題を認識させる。",
      "what": "- settings.jsonから登録済みスクリプトパスを抽出\n- 各ファイルの存在を確認\n- 不足ファイルがあれば復旧手順を含む警告を表示",
      "remarks": "- ブロックはせず警告のみ（他の作業は継続可能）\n- SessionStartで発火",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "existing_impl_check",
      "path": ".claude/hooks/handlers/existing_impl_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成時に既存実装の存在を警告し、検証を促す。",
      "keywords": ["existing", "impl", "issue", "worktree"],
      "why": "「コードが存在する」≠「動作している」。Issueがオープンなのに\n関連コードが存在する場合、そのコードが正常に動作していない\n可能性が高い。検証せずに「実装済み」と判断すると時間を無駄にする。",
      "what": "- git worktree addコマンドからIssue番号を抽出\n- コメント・ファイル名からIssue番号やキーワードで関連コードを検索\n- 関連コードが見つかった場合は検証を促す警告を表示",
      "remarks": "- ブロックせず警告のみ\n- 検索結果は最大5件まで表示",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "exploration_tracker",
      "path": ".claude/hooks/handlers/exploration_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "探索深度（Read/Glob/Grep使用回数）を追跡する。",
      "keywords": [
        "exploration",
        "glob",
        "grep",
        "read",
        "requirement",
        "research",
        "tracker",
        "web"
      ],
      "why": "十分なコード探索が行われていれば、明示的なWeb検索がなくても\n十分な調査が行われたと見なせる。探索深度を記録することで、\nresearch-requirement-check.pyがバイパス判断に利用できる。",
      "what": "- Read/Glob/Grepツールの使用を検出\n- セッションごとにカウントを記録\n- 合計探索回数を更新\n\nState:\n- writes: .claude/state/session/exploration-depth-{session}.json",
      "remarks": "- 記録型フック（ブロックしない、カウント記録）\n- PostToolUse:Read/Glob/Grepで発火\n- research-requirement-check.pyが探索深度をバイパス判断に利用\n- セッションごとに独立したカウント管理",
      "trigger": "PostToolUse",
      "matcher": "Read|Glob|Grep"
    },
    {
      "name": "false_positive_detector",
      "path": ".claude/hooks/handlers/false_positive_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に誤検知パターンを検出して警告する。",
      "keywords": ["detector", "false", "issue", "positive"],
      "why": "同じフックが短時間に連続でブロックする場合、誤検知の可能性が高い。\nセッション終了時にパターンを分析し、Issue作成を促すことで\nフックの品質改善につなげる。",
      "what": "- セッションのブロックログを読み込み\n- 30秒以内に同じフックが2回以上ブロックした連続パターンを検出\n- 検出した場合は警告を表示し、Issue作成を促す\n\nState:\n- reads: .claude/logs/execution/hook-execution-{session}.jsonl",
      "remarks": "- Stop hookとして発動（セッション終了時）\n- ブロックはせず警告のみ",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "feedback_detector",
      "path": ".claude/hooks/handlers/feedback_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ユーザーフィードバック（問題指摘・懸念）を検出し、セッション状態に記録する。",
      "keywords": ["detector", "feedback"],
      "why": "ユーザーが動作確認や問題を指摘した場合、類似問題を将来検出できるよう\n振り返り観点の追加を促す。また、セッション状態に記録することで、\nセッション終了時に仕組み化の確認を可能にする。",
      "what": "- ユーザー入力から否定的フィードバックパターンを検出\n- 「動いてる？」「おかしい」「バグ」等のパターンをマッチ\n- 検出時はACTION_REQUIREDを出力し、/adding-perspectives実行を促す\n- セッション状態ファイルに `user_feedback_detected: true` を記録",
      "remarks": "- type: \"command\"を使用（type: \"prompt\"はクラッシュ問題があるため）\n- 1文字入力は誤検知防止のため除外\n- セッション状態はStop hookで仕組み化確認に使用される\n- Python版: feedback_detector.py",
      "trigger": "UserPromptSubmit",
      "matcher": null
    },
    {
      "name": "file_overwrite_warning",
      "path": ".claude/hooks/handlers/file_overwrite_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Bashでの既存ファイル上書き時に警告を表示する。",
      "keywords": ["bash", "cat", "echo", "file", "overwrite", "warning", "write"],
      "why": "`Write`ツールはファイル読み込み必須で保護されているが、\nBashの`cat >`や`echo >`には保護がない。意図せず既存ファイルを\n上書きして重要なコードを失うリスクがある。",
      "what": "- Bashコマンドからリダイレクト先（cat >, echo >, tee等）を抽出\n- 対象ファイルが既存かを確認\n- 既存ファイルへの上書きの場合は警告メッセージを表示",
      "remarks": "- teeの-a/--appendオプションは追記なので除外\n- ブロックはせず警告のみ\n- 新規ファイル作成は警告なし",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "file_size_warning",
      "path": ".claude/hooks/handlers/file_size_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "大きすぎるファイルの読み込み時にリファクタリングを促す警告を表示する。",
      "keywords": ["file", "size", "warning"],
      "why": "AIがファイルを読み込む際、大きすぎるファイルは認知負荷が高く、\n凝集度・結合度・責務の観点から分割を検討すべき場合がある。",
      "what": "- PreToolUse (Read) でファイル読み込み時に行数をチェック\n- 閾値超過時に警告メッセージを表示（ブロックはしない）\n- 言語別の閾値: TS/JS 400行、Python 500行、その他 500行",
      "remarks": "- 警告のみ（approve with systemMessage）でブロックしない\n- テストファイル、型定義、生成ファイル、設定ファイルは除外\n- AGENTS.md, CLAUDE.md等の意図的に長いドキュメントも除外",
      "trigger": "PostToolUse",
      "matcher": "Read|Glob|Grep"
    },
    {
      "name": "flow_effect_verifier",
      "path": ".claude/hooks/handlers/flow_effect_verifier.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "未完了フローがある場合にセッション終了をブロックする。",
      "keywords": ["effect", "flow", "verifier", "worktree"],
      "why": "開発ワークフロー（worktree作成→実装→レビュー→マージ）のステップを\nスキップすると品質問題が発生する。セッション終了時にチェックし、\n未完了フローがあればブロックして完了を促す。",
      "what": "- セッション内のアクティブなフローを取得\n- クローズ済みIssueや期限切れフローを除外\n- blocking_on_session_end=Trueのフローで未完了ステップがあればブロック\n- フロー進捗サマリーとワークフロー検証結果を表示\n\nState:\nreads: .claude/state/flow-progress.jsonl\nreads: .claude/state/flow/state-{session}.json",
      "remarks": "- 24時間以上経過したフローは自動的に期限切れ\n- クローズ済みIssueのフローはブロック対象外",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "flow_progress_tracker",
      "path": ".claude/hooks/handlers/flow_progress_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "フローステップの完了を追跡する。",
      "keywords": ["effect", "flow", "progress", "tracker", "verifier", "worktree"],
      "why": "開発ワークフローの各ステップ（worktree作成、コミット、PR作成等）が\n実際に実行されたことを記録する必要がある。コマンドパターンマッチで\n自動的にステップ完了を検出し、flow-effect-verifierが判断に使用する。",
      "what": "- Bashコマンドの実行を監視\n- flow_definitions.tsのパターンとマッチング（コンテキスト対応）\n- マッチした場合はステップを完了としてマーク\n- ステップ順序の妥当性を検証（警告のみ）\n\nState:\nwrites: .claude/logs/flow/flow-progress-{session_id}.jsonl",
      "remarks": "- 終了コードが0のコマンドのみ対象\n- 順序違反は警告するが、ステップは完了としてマーク（回復可能）",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "flow_state_updater",
      "path": ".claude/hooks/handlers/flow_state_updater.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "開発ワークフローのフェーズ遷移を追跡する。",
      "keywords": ["cleanup", "flow", "session", "start", "state", "updater"],
      "why": "ワークフロー（session_start→実装→PR→マージ→cleanup）のフェーズを\n追跡し、スキップや逸脱を検出する。データ分析でボトルネックの特定や\n改善ポイントの発見に活用する。",
      "what": "- 全ツール使用イベントでフェーズ遷移を判定\n- ループ（CI失敗→実装に戻る等）の検出と記録\n- 重大違反（merge後cleanup未実施など）をブロック\n- 軽微な違反は警告のみ\n\nState:\nwrites: .claude/state/flow/state-{session}.json\nwrites: .claude/state/flow/events-{session}.jsonl",
      "remarks": "- フェーズ遷移はPHASE_TRIGGERSのパターンマッチで検出\n- セッション固有のステートファイルで他セッションとの干渉を防止",
      "trigger": ["SessionStart", "PreToolUse", "PostToolUse", "Stop"],
      "matcher": [null, ".*", ".*", null]
    },
    {
      "name": "flow_verifier",
      "path": ".claude/hooks/handlers/flow_verifier.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ワークフロー追跡を検証し、レポートを生成する。",
      "keywords": ["flow", "verifier"],
      "why": "フェーズ追跡が正確に機能しているか検証し、ワークフロー設計の\n問題点を発見する。セッション終了時にサマリーを表示することで、\n改善ポイントを認識できる。",
      "what": "- Level 1: 追跡精度の検証（フェーズ遷移、ループ検出）\n- Level 2: フロー設計レビュー（効率性、順序、粒度、カバレッジ）\n- スキップされたフェーズの理由推定\n- 全セッション統計の集計\n\nState:\nreads: .claude/state/flow/state-{session}.json\nreads: .claude/state/flow/events-{session}.jsonl\nwrites: .claude/state/flow/verification-report.json",
      "remarks": "- Stop hookとして発動（セッション終了時）\n- ブロックせず検証レポートのみ表示",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "followup_issue_guard",
      "path": ".claude/hooks/handlers/followup_issue_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue参照なしの「フォローアップ」発言をブロックする。",
      "keywords": ["followup", "guard", "issue"],
      "why": "「後で対応します」とコメントしてもIssueを作らないと、フォローアップは\n忘れられて実行されない。コメント投稿前にIssue参照を強制することで、\n約束を形骸化させないようにする。",
      "what": "- gh pr/issue commentコマンドを検出\n- 「後で」「フォローアップ」「スコープ外」等のキーワードを検索\n- Issue参照（#1234等）がない場合はブロック\n- Issue参照がある場合は許可",
      "remarks": "- SKIP_FOLLOWUP_ISSUE_GUARD=1で無効化可能\n- 対象はコメントコマンドのみ（コミットメッセージは対象外）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "force_push_guard",
      "path": ".claude/hooks/handlers/force_push_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "危険な`git push --force`をブロックし、`--force-with-lease`を推奨する。",
      "keywords": ["force", "git", "guard", "lease", "push"],
      "why": "`git push --force`はリモートの状態を確認せずに上書きするため、\n他の変更を消失させる危険がある。`--force-with-lease`は安全に\nforce pushできるため、こちらを推奨する。",
      "what": "- git push --force または -f を検出\n- 検出時はブロックし、--force-with-leaseを推奨\n- --force-with-leaseは許可",
      "remarks": "- コマンドチェーン内の各サブコマンドを個別にチェック\n- クォート内の文字列は無視（echo \"git push --force\"等）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "fork_session_collaboration_advisor",
      "path": ".claude/hooks/handlers/fork_session_collaboration_advisor.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Fork-session開始時に独立したIssue候補を提案する。",
      "keywords": ["advisor", "collaboration", "fork", "issue", "session"],
      "why": "Fork-sessionが親セッションと競合するIssueに着手すると、\nコンフリクトや重複作業が発生する。独立したIssue候補を\n提案することで、効率的な並行作業を実現する。",
      "what": "- Fork-sessionかどうかを検出\n- 親/siblingセッションのworktreeを特定\n- 競合しない独立したIssue候補を提案",
      "remarks": "- 提案のみでブロックはしない\n- 通常セッションでは何も出力しない\n- session-worktree-statusは警告のみ、こちらは積極的な提案\n- Python版からTypeScriptへ移行（Issue #3051）",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "fork_session_id_updater",
      "path": ".claude/hooks/handlers/fork_session_id_updater.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "UserPromptSubmit時にsession_idをコンテキストに出力する",
      "keywords": ["fork", "session", "sessionstart", "updater", "userpromptsubmit"],
      "why": "Fork-session判定には、SessionStartとUserPromptSubmitのsession_idを\n比較する必要がある。この2つが異なる場合がfork-sessionである。",
      "what": "- UserPromptSubmit時にsession_idを取得\n- タイムスタンプ付きでadditionalContextに出力\n- Claudeがコンテキスト内の2つのIDを比較してfork判定",
      "remarks": "- ファイルベースのステートフルな設計は避ける\n- タイムスタンプで最新のsession_id情報を特定可能\n- SessionStartのSession ID = fork元（古いセッション）\n- USER_PROMPT_SESSION_IDの最新 = 現在のセッション\n- Python版: fork_session_id_updater.py",
      "trigger": "UserPromptSubmit",
      "matcher": null
    },
    {
      "name": "fork_session_pr_guard",
      "path": ".claude/hooks/handlers/fork_session_pr_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "blocking",
      "summary": "Fork-sessionが親セッションのPRに介入することを防止する。",
      "keywords": ["agents", "fork", "guard", "session"],
      "why": "Fork-sessionが親セッションのPRに対してコミット・プッシュ・レビュー対応を\n実行すると、コンフリクトや重複作業が発生する。AGENTS.mdのルールを\n強制的にブロックすることで、この問題を防ぐ。",
      "what": "- Fork-sessionかどうかを検出\n- PR関連コマンド（gh pr merge/review/comment, git push, git commit）を検出\n- 親セッションのworktree内からの操作、または親セッションのPRへの操作をブロック",
      "remarks": "- 親セッション判定は transcript_path から session ancestry を取得して行う\n- ブロッキングフック（介入を確実に防止）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "gemini_review_check",
      "path": ".claude/hooks/handlers/gemini_review_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Gemini CLIレビュー実行をPR作成・push前に強制する",
      "keywords": ["cli", "gemini", "push", "review"],
      "why": "コードレビューなしでPRを作成・pushすると、品質問題がCIやAIレビューで\n初めて発覚し、手戻りが発生する。事前のローカルレビューで品質を担保する。",
      "what": "- gh pr create / git pushコマンドを検出\n- 現在のブランチ・コミットでgemini /code-reviewが実行済みか確認\n- 未実行またはコミット変更後は再レビューを要求\n- リベース後も差分が同一ならスキップ\n\nState:\n- reads: .claude/logs/markers/gemini-review-{branch}.done",
      "remarks": "- ブロック型フック（レビュー未実行時はブロック）\n- PreToolUse:Bashで発火（gh pr create/git pushコマンド）\n- main/masterブランチはスキップ\n- SKIP_GEMINI_REVIEW=1でバイパス可能\n- gemini_review_logger.tsと連携（マーカーファイル読み込み）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "gemini_review_logger",
      "path": ".claude/hooks/handlers/gemini_review_logger.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Gemini CLIレビュー実行をログ記録する（gemini-review-checkと連携）",
      "keywords": ["cli", "gemini", "logger", "push", "review"],
      "why": "gemini-review-checkがPR作成/push前にレビュー実行済みかを確認するため、\nレビュー実行時にブランチ・コミット情報を記録しておく必要がある。",
      "what": "- gemini /code-reviewコマンドを検出\n- パイプ入力（| gemini -p / | gemini --prompt）を検出\n- ブランチ名、コミットハッシュ、diffハッシュを記録\n- main/masterブランチでは記録しない\n\nState:\n- writes: .claude/logs/markers/gemini-review-{branch}.done",
      "remarks": "- 記録型フック（ブロックしない、マーカーファイル書き込み）\n- PreToolUse:Bashで発火（gemini /code-reviewコマンド）\n- gemini_review_check.tsと連携（マーカーファイル参照元）\n- diffハッシュ記録によりリベース後のスキップ判定が可能",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "git_config_check",
      "path": ".claude/hooks/handlers/git_config_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にgit設定の整合性を確認し、問題があれば自動修正する。",
      "keywords": [
        "bare",
        "config",
        "core",
        "fatal",
        "git",
        "must",
        "operation",
        "run",
        "tree",
        "true",
        "work",
        "worktree"
      ],
      "why": "Worktree操作後にgit configのcore.bare=trueになることがあり、\ngitコマンドが`fatal: this operation must be run in a work tree`で\n失敗する。この既知の問題を自動検出・修正する。",
      "what": "- core.bareの値を確認\n- trueになっている場合は自動的にfalseに修正\n- 修正した場合は警告を出力",
      "remarks": "- ブロックはしない（自動修正のみ）\n- git設定のチェックは他のフックにない（重複なし）",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "git_operations_tracker",
      "path": ".claude/hooks/handlers/git_operations_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Git操作メトリクスを追跡してログに記録する。",
      "keywords": ["branch", "conflict", "git", "operations", "tracker", "update"],
      "why": "Update branch回数やConflict発生頻度を記録することで、\n開発フローのボトルネック分析や改善ポイントの特定に活用する。",
      "what": "- git pull/merge/rebase, gh pr merge/update-branchコマンドを検出\n- Conflict発生、Update branch、Rebase解決を記録\n- 終了コード、ブランチ名、コンフリクトファイル等をログ出力\n\nState:\n- writes: .claude/logs/execution/git-operations.log",
      "remarks": "- 情報収集のみでブロックしない\n- SRP: Git操作のメトリクス追跡のみを担当",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "git_status_check",
      "path": ".claude/hooks/handlers/git_status_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にGitの状態を確認し、未コミット変更を警告する。",
      "keywords": ["git", "main", "status"],
      "why": "mainブランチに未コミット変更がある状態でセッションを開始すると、\n意図しない変更の混入や競合が発生するリスクがある。",
      "what": "- Gitワーキングツリーの状態を確認\n- mainブランチに未コミット変更がある場合に警告\n- featureブランチの未コミット変更は情報として表示",
      "remarks": "- ブロックはしない（警告のみ）\n- stop_hook_active時はスキップ",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "hook_behavior_evaluator",
      "path": ".claude/hooks/handlers/hook_behavior_evaluator.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "フックの期待動作と実際の動作のギャップを自動検知する。",
      "keywords": ["behavior", "evaluator", "hook"],
      "why": "フックが正しく動作しているかを自動検証し、サイレント障害や\n異常な動作パターンを早期発見する。問題のあるフックを放置すると\nワークフロー全体の品質が低下する。",
      "what": "- サイレント障害検出（例外発生したフック）\n- ブロックループ検出（短時間に連続ブロック）\n- 未実行フック検出（登録されているが実行されていない）\n\nState:\nreads: .claude/logs/execution/hook-execution-*.jsonl\nreads: .claude/settings.json\nwrites: .claude/logs/metrics/behavior-anomalies-*.jsonl",
      "remarks": "- 情報提供のみでブロックしない（Stopフック）\n- hook_effectiveness_evaluatorは効率性評価、これは動作評価\n- settings.jsonから登録フック一覧を取得",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "hook_change_detector",
      "path": ".claude/hooks/handlers/hook_change_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Check if command contains git add or git commit.",
      "keywords": ["add", "change", "command", "commit", "contains", "detector", "git", "hook"],
      "why": "",
      "what": "",
      "remarks": "",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "hook_dev_warning",
      "path": ".claude/hooks/handlers/hook_dev_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree内でのフック開発時に変更が反映されない問題を警告する。",
      "keywords": ["claude", "dev", "dir", "hook", "main", "project", "warning", "worktree"],
      "why": "worktree内でフックを修正しても、CLAUDE_PROJECT_DIRがmainリポジトリを\n指すため、修正が反映されない。この問題を開発者に警告する。",
      "what": "- cwdがworktree内かどうかをチェック\n- worktree内で.claude/hooks/や.claude/scripts/に変更があれば警告\n- mainにマージするまで変更が反映されないことを通知",
      "remarks": "- ブロックせず警告のみ\n- CLAUDE_PROJECT_DIRがmainを指す問題に特化",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "hook_effectiveness_evaluator",
      "path": ".claude/hooks/handlers/hook_effectiveness_evaluator.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション中のフック実行を分析し、改善提案を出力する。",
      "keywords": ["effectiveness", "evaluator", "hook"],
      "why": "フックが適切に機能しているかをセッション終了時に評価し、\n過剰発動・無視された警告・繰り返しブロックを検出する。\nフックの品質改善サイクルを回すための情報を提供する。",
      "what": "- 過剰発動検出（発動多数でほぼapprove）\n- 無視された警告検出（警告出力されても対応なし）\n- 繰り返しブロック検出（同じ理由で複数回ブロック）\n- 改善提案を生成・出力\n\nState:\n- reads: .claude/logs/execution/hook-execution-*.jsonl",
      "remarks": "- 情報提供のみでブロックしない\n- hook-behavior-evaluatorは動作評価、これは効率性評価\n- 自己参照を除外して誤検知を防止",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "hook_return_format_check",
      "path": ".claude/hooks/handlers/hook_return_format_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "フック種類に応じた返却形式の誤用を検出する。",
      "keywords": ["format", "hook", "return", "stop"],
      "why": "フック種類によって期待される返却形式が異なる。誤った形式を使用すると\nフックが正しく動作しない。PR #1632でStop hookに誤った形式を適用した\n問題の再発を防止する。",
      "what": "- Stop hookでprint_continue_and_log_skip使用を検出\n- フック種類と期待される返却形式の対応をチェック\n- 不一致時に警告（ブロックしない）",
      "remarks": "- 非ブロック型（警告のみ）\n- Stop: print_approve_and_log_skip、PostToolUse: print_continue_and_log_skip\n- Python版: hook_return_format_check.py",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "hooks_design_check",
      "path": ".claude/hooks/handlers/hooks_design_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Get staged new hook files.",
      "keywords": ["design", "files", "get", "hook", "hooks", "new", "staged"],
      "why": "",
      "what": "",
      "remarks": "",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "immediate_action_check",
      "path": ".claude/hooks/handlers/immediate_action_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ後のreflect実行を強制する。",
      "keywords": ["action", "immediate", "reflect"],
      "why": "PRマージ後に/reflectを実行しないと、学習機会を逃し、同じ問題を繰り返す。\nトランスクリプトを解析してマージ後のreflect実行を検証する。",
      "what": "- トランスクリプトから成功したgh pr mergeコマンドを検出\n- 各マージ後にSkill(reflect)呼び出しがあるか確認\n- 対応するreflect呼び出しがないマージがあればブロック\n\nState:\n- reads: transcript file",
      "remarks": "- post-merge-reflection-enforcerはreflect指示、本フックは実行検証\n- [IMMEDIATE]タグはトランスクリプトに記録されないため直接マージ検出を使用",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "immediate_pending_check",
      "path": ".claude/hooks/handlers/immediate_pending_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "[IMMEDIATE]タグの実行漏れを早期検出する。",
      "keywords": ["claude", "hook", "immediate", "pending", "reflecting", "sessions", "stop"],
      "why": "PRマージ後に[IMMEDIATE: /reflecting-sessions]が表示されても、ユーザーが次の入力をした場合、\nClaudeが別のタスクに移って振り返りを忘れることがある。\nStop hookのみでは検出が遅く、セッション終了時まで気づかない。",
      "what": "- UserPromptSubmit時にpending状態ファイルを確認\n- 未実行の[IMMEDIATE]アクションがあれば即座にブロック\n- 実行済みなら状態ファイルを削除してフローを継続\n\nState:\n- reads: /tmp/claude-hooks/immediate-pending-{session_id}.json\n- deletes: same (on successful verification)",
      "remarks": "- post-merge-reflection-enforcer.pyがpending状態を書き込み\n- reflection-completion-check.pyはStop hookで最終チェック\n- 本フックはUserPromptSubmitで早期検出\n- lib/reflection.tsの共通関数を使用\n- Python版: immediate_pending_check.py",
      "trigger": "UserPromptSubmit",
      "matcher": null
    },
    {
      "name": "issue_ai_review",
      "path": ".claude/hooks/handlers/issue_ai_review.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue作成後にAIレビュー（Gemini/Codex）を実行し結果を通知する。",
      "keywords": ["claude", "codex", "gemini", "issue", "review"],
      "why": "Issue作成時点でAIレビューを実行することで、Issue内容の品質を\n即座に向上させる機会を提供する。レビュー結果をClaudeに通知し、\nIssue内容への反映を促す。",
      "what": "- gh issue createの成功を検出\n- Gemini/Codexによる同期レビューを実行\n- レビュー結果をIssueにコメント投稿\n- systemMessageでClaudeにレビュー結果を通知\n\nState:\n- writes: .claude/logs/flow/flow-progress-{session}.jsonl",
      "remarks": "- 同期実行（レビュー完了まで待機）\n- issue_ai_review.tsスクリプトを呼び出し（Bun経由）\n- PostToolUse:Bashで発火",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_auto_assign",
      "path": ".claude/hooks/handlers/issue_auto_assign.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成時にブランチ名からIssue番号を抽出し自動アサイン・競合チェック。",
      "keywords": ["assign", "auto", "issue", "worktree"],
      "why": "複数セッションが同じIssueに着手すると作業の重複・競合が発生する。\nworktree作成時点でIssueの状態を確認し、競合を事前に防止する。",
      "what": "- git worktree addコマンドからブランチ名/パスを解析\n- ブランチ名からIssue番号を抽出（issue-123, fix/123-desc等）\n- 以下をブロック: クローズ済み、重複worktree、リモートブランチ存在、\n  オープンPR存在、他者アサイン済み\n- 未アサインなら自動で@meにアサイン\n- 最近マージされたPRがあれば警告",
      "remarks": "- ブロック型フック（競合防止のため厳格）\n- 自分のみアサイン済みは許可（作業継続）\n- worktree-creation-markerはセッション追跡、本フックは競合防止\n- Python版: issue_auto_assign.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_body_requirements_check",
      "path": ".claude/hooks/handlers/issue_body_requirements_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue create時にIssue本文の必須項目をチェックする。",
      "keywords": [
        "body",
        "causes",
        "create",
        "creating",
        "creation",
        "delays",
        "during",
        "encourage",
        "enforce",
        "how",
        "implementation",
        "investigation",
        "issue",
        "issues",
        "proper",
        "required",
        "requirements",
        "sections",
        "time",
        "what",
        "why",
        "without"
      ],
      "why": "Creating issues without investigation causes delays during implementation.\nEnforce required sections (Why/What/How) to encourage proper investigation\nat issue creation time.",
      "what": "- Detect gh issue create commands\n- Extract body from --body option\n- Check for required sections (Why/What/How)\n- Block if missing",
      "remarks": "- trivial/documentationラベルでスキップ可能\n- issue-investigation-reminderを置き換えた後継フック\n- Python版: issue_body_requirements_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_branch_check",
      "path": ".claude/hooks/handlers/issue_branch_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成時にブランチ名にIssue番号を含むことを強制。",
      "keywords": ["branch", "issue", "worktree"],
      "why": "Issueを作成せずにworktreeを作成すると、作業の追跡が困難になる。\nブランチ名にIssue番号を含めることで、作業とIssueを紐付ける。",
      "what": "- `git worktree add` コマンドを検出\n- ブランチ名にIssue番号（issue-123, #123等）が含まれているか確認\n- 含まれていない場合はブロック",
      "remarks": "- ブロック型フック（Issue番号なしはブロック）\n- PreToolUse:Bashで発火",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_comments_check",
      "path": ".claude/hooks/handlers/issue_comments_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue viewコマンド実行時にコメントを自動表示する。",
      "keywords": ["comments", "issue", "view"],
      "why": "Issueコメントに重要な解決策や追加情報があっても見落とされ、\n無駄な時間を費やすことがある。コメントを自動表示して\n情報の見落としを防ぐ。",
      "what": "- gh issue view <number> コマンドを検出\n- --commentsフラグがない場合、自動でコメントを取得\n- systemMessageでコメント内容を表示",
      "remarks": "- 非ブロック型（情報提供のみ）\n- --comments付きのコマンドはそのまま通過\n- Python版: issue_comments_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_creation_detector",
      "path": ".claude/hooks/handlers/issue_creation_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue作成必要性のキーワードを検出し、即座にIssue作成を強制する",
      "keywords": ["creation", "detector", "issue"],
      "why": "作業途中で「Issue化すべき」と認識しても、後回しにして忘れるリスクがある。\nキーワード検出により、Issue作成を即座に強制する。",
      "what": "- トランスクリプトから直近のassistant発言を取得\n- 「Issue作成が必要」「Issue化すべき」等のキーワードを検出\n- 検出時に[IMMEDIATE: gh issue create]を出力してブロック",
      "remarks": "- UserPromptSubmitで実行（ユーザーの次の入力前にチェック）\n- 実際にIssue作成済みの場合は誤検知を避けるため除外",
      "trigger": "UserPromptSubmit",
      "matcher": null
    },
    {
      "name": "issue_creation_request_check",
      "path": ".claude/hooks/handlers/issue_creation_request_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue作成依頼時の即時作成を強制するStop hook。",
      "keywords": ["creation", "hook", "issue", "request", "stop"],
      "why": "ユーザーから「Issueを作成してください」と依頼されたが、別作業に気を取られて\nIssue作成を忘れるケースがあった。Issueは忘れると追跡不可能になるため、\n依頼後の作成を強制する。",
      "what": "- トランスクリプトからユーザーのIssue作成依頼を検出\n- 依頼後に`gh issue create`が実行され、成功したか確認\n- 未実行または失敗の場合はセッション終了をブロック\n\nState:\n- reads: transcript_path (from hook input)",
      "remarks": "- Stop hook（セッション終了時に実行）\n- 依頼パターン: 「Issueを作成」「Issue化して」「Issueにして」等\n- Issue作成後の依頼は無視（直近の依頼のみチェック）\n- JSONL形式とJSON配列形式の両方に対応\n- コマンド成功の判定: exit_code === 0 かつ Issue URLが出力に含まれる",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "issue_creation_tracker",
      "path": ".claude/hooks/handlers/issue_creation_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション内で作成されたIssue番号を記録し、実装を促す。",
      "keywords": ["creation", "issue", "tracker"],
      "why": "セッション内で作成したIssueは同セッションで実装まで完遂する\n必要がある。Issue作成を追跡し、優先度に応じた実装指示を\n出すことで、Issue作成で終わらず実装まで誘導する。",
      "what": "- gh issue createの成功を検出しIssue番号を抽出\n- セッションIDごとのファイルにIssue番号を記録\n- 優先度（P0/P1/P2）を解析し適切なメッセージを表示\n- P0は即時実装、P1/P2は現タスク完遂後の実装を指示\n\nState:\n- writes: .claude/logs/flow/session-created-issues-{session_id}.json\n- writes: .claude/logs/decisions/issue-decisions-{session_id}.jsonl",
      "remarks": "- 非ブロック型（PostToolUse）\n- related-task-checkがセッション終了時に未実装Issueをチェック",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_existence_check",
      "path": ".claude/hooks/handlers/issue_existence_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "実装開始前にIssue存在を確認し、Issue作成を優先させる",
      "keywords": ["agents", "existence", "issue"],
      "why": "AGENTS.mdには「問題発見→Issue作成→実装」の流れがルールとして記載されているが、\n強制機構がなかった。Issue作成を忘れて実装を始めてしまうケースを防ぐ。",
      "what": "- Edit/Writeツール使用時に発火\n- worktreeのブランチ名からIssue番号を抽出\n- gh issue viewでIssueの存在・状態を確認\n- Issueがない/クローズ済みの場合は警告",
      "remarks": "- 警告型フック（ブロックはしない）\n- PreToolUse:Edit|Writeで発火\n- mainブランチ、worktree外はスキップ\n- .claude/ 配下の編集はスキップ（フック開発時の無限ループ防止）\n- セッション内キャッシュ: Issue番号ごとに1回だけgh issue viewを実行",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "issue_first_check",
      "path": ".claude/hooks/handlers/issue_first_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "問題発見時にIssue作成を先に促すフック",
      "keywords": ["first", "issue"],
      "why": "PR #3542で発生した問題。問題を発見→修正作業を開始→Issue作成を後回し、\nという流れだと、途中で中断した場合に問題が忘れられる。",
      "what": "- Edit/Writeツール呼び出し時にpending-review-{branch}.jsonマーカーをチェック\n- MEDIUM以上の指摘がある場合、「まずIssueを作成してください」と警告\n- ブロックではなく警告（作業継続可能）\n\nState:\n- reads: .claude/logs/markers/pending-review-{branch}.json",
      "remarks": "- 警告型フック（ブロックしない）\n- PreToolUse:Edit, PreToolUse:Writeで発火\n- parallel_review.tsが作成するマーカーを参照\n- 新しいコミットでマーカーがstaleになると警告停止",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "issue_incomplete_close_check",
      "path": ".claude/hooks/handlers/issue_incomplete_close_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue close時に未完了チェックボックスを検出してブロック。",
      "keywords": ["close", "incomplete", "issue"],
      "why": "Issue本文にタスクリスト（チェックボックス）がある場合、\n未完了項目があるままクローズすると作業漏れが発生する。\n部分完了でのクローズを防止する。",
      "what": "- gh issue closeコマンドを検出\n- Issue本文からチェックボックスを解析\n- 未チェック項目があればブロック\n- スキップ環境変数（SKIP_INCOMPLETE_CHECK）で回避可能",
      "remarks": "- ブロック型フック\n- issue-review-response-checkはAIレビュー対応確認、本フックはタスク完了確認\n- Python版: issue_incomplete_close_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_investigation_tracker",
      "path": ".claude/hooks/handlers/issue_investigation_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue view実行時に別セッションの調査を検知し警告する。",
      "keywords": ["investigation", "issue", "tracker", "view", "worktree"],
      "why": "worktree/PR作成前の調査フェーズでも並行セッションの競合が発生する。\nIssue閲覧時点で調査開始を記録し、別セッションとの重複を早期検知する。",
      "what": "- gh issue viewコマンドを検出しIssue番号を抽出\n- Issueコメントから他セッションの調査開始マーカーを検索\n- 別セッションが1時間以内に調査中なら警告\n- 自身の調査開始をコメントとして記録（重複防止）\n\nState:\n- writes: GitHub Issueコメント（🔍 調査開始マーカー）",
      "remarks": "- 非ブロック型（警告のみ）\n- issue-auto-assignはworktree作成時の競合防止、本フックは調査フェーズの検知\n- Python版: issue_investigation_tracker.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_label_check",
      "path": ".claude/hooks/handlers/issue_label_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue create時に--labelオプションの指定を強制する。",
      "keywords": ["create", "issue", "label"],
      "why": "ラベルなしのIssueは分類・検索・優先度管理が困難になる。\nIssue作成時にラベルを強制することで、Issue管理の質を維持する。",
      "what": "- gh issue createコマンドを検出\n- --labelオプションの有無をチェック\n- ラベルがない場合、タイトル/ボディから適切なラベルを自動提案\n- ブロックし、推奨コマンドを表示",
      "remarks": "- ブロック型フック\n- issue-priority-label-checkは優先度ラベル専用、本フックはラベル有無の確認\n- Python版: issue_label_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_multi_problem_check",
      "path": ".claude/hooks/handlers/issue_multi_problem_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue作成時に複数問題を1Issueにまとめていないかチェックする。",
      "keywords": ["issue", "multi", "problem"],
      "why": "1つのIssueに複数の問題を含めると、議論が分散し解決が遅れる。\n1Issue1問題の原則を強制することで、追跡性と解決速度を向上させる。",
      "what": "- gh issue createコマンドからタイトルを抽出\n- 複数問題パターン（「AとBの実装」等）を検出\n- 検出時はブロックして分離を促す",
      "remarks": "- ブロック型フック（複数問題検出時はブロック）\n- PreToolUse:Bashで発火（gh issue createコマンド）\n- issue-scope-check.pyはIssue編集時のみ対象（責務分離）\n- 除外パターンで「検出と警告」等の関連動作は許可",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_priority_label_check",
      "path": ".claude/hooks/handlers/issue_priority_label_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue create時に優先度ラベル（P0-P3）の指定を強制する。",
      "keywords": ["cli", "create", "dropdown", "github", "issue", "label", "priority"],
      "why": "GitHubのIssueテンプレートでdropdownの優先度を必須にしても、\n選択した値はラベルとして自動付与されない。gh CLI経由での\n作成時はテンプレート自体が適用されない。優先度ラベルを\n強制することでIssueの優先順位管理を徹底する。",
      "what": "- gh issue createコマンドを検出\n- --labelオプションから優先度ラベル（P0-P3）を確認\n- 優先度ラベルがない場合はブロック",
      "remarks": "- issue-label-checkはラベル有無のみ確認、これは優先度ラベル専用\n- P0: Critical、P1: High、P2: Medium、P3: Low\n- Python版: issue_priority_label_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_reference_check",
      "path": ".claude/hooks/handlers/issue_reference_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "存在しないIssue参照をブロックする。",
      "keywords": ["issue", "reference"],
      "why": "存在しないIssue番号を参照すると、後から追跡できなくなり\n誤った情報がコメントに残る。参照前に存在確認を強制する。",
      "what": "- gh pr comment/gh issue comment等のコメント投稿を検出\n- コメント本文から#1234形式のIssue参照を抽出\n- gh issue viewで存在確認、不存在ならブロック",
      "remarks": "- ブロック型フック（存在しないIssue参照時はブロック）\n- PreToolUse:Bashで発火（gh pr/issue comment、gh api replies）\n- Closes/Fixes/Resolvesパターンは除外（Issue作成用途）\n- cross-repoコマンド（--repo）はスキップ（他リポジトリ検証困難）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_requirements_reminder",
      "path": ".claude/hooks/handlers/issue_requirements_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ前にIssue要件の未完了項目を警告する。",
      "keywords": ["compaction", "issue", "reminder", "requirements"],
      "why": "継続セッション（compaction後）でIssue要件を忘れてマージしてしまう問題を防ぐ。\nPR #3055でIssue #3051の要件を1つしか完了せずにマージした事例がある。",
      "what": "- gh pr mergeコマンドを検出\n- PRボディから`Closes #xxx`パターンでIssue番号を抽出\n- 各Issueの受け入れ条件（チェックボックス）を確認\n- 未完了項目がある場合に警告（ブロックはしない）",
      "remarks": "- 警告型フック（ブロックしない、stderrで通知）\n- merge-checkはマージ可否を判定、本フックはIssue要件を再確認\n- 取り消し線（~~）付きの項目はスキップ",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_review_response_check",
      "path": ".claude/hooks/handlers/issue_review_response_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh issue close時にAIレビューへの対応状況を確認してブロック。",
      "keywords": ["close", "issue", "response", "review"],
      "why": "Issue作成後のAIレビューで改善提案が出ても、対応せずにクローズすると\nIssue品質が低下する。レビュー対応を強制することでIssue品質を維持する。",
      "what": "- gh issue closeコマンドを検出\n- IssueにAIレビューコメント（🤖 AI Review）があるか確認\n- レビュー後にIssue本文が更新されていなければブロック\n- スキップ環境変数（SKIP_REVIEW_RESPONSE）で回避可能",
      "remarks": "- ブロック型フック\n- 過去に実行されたAIレビュー（🤖 AI Review）への対応確認\n- コメントでの対応理由説明も有効な対応として扱う\n- Python版: issue_review_response_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "issue_scope_check",
      "path": ".claude/hooks/handlers/issue_scope_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue編集時のスコープ確認を強制する。",
      "keywords": ["issue", "scope"],
      "why": "1つのIssueに異なるタスクを追加すると追跡性が低下する。\n1Issue1タスクの原則を強制することで、Issueの管理性を向上させる。",
      "what": "- gh issue edit --bodyコマンドを検出\n- チェックボックスのみの変更は許可（進捗更新のため）\n- 内容追加時はスコープ確認を強制しブロック\n- SKIP_ISSUE_SCOPE_CHECK環境変数でバイパス可能",
      "remarks": "- ブロック型フック（内容追加時はブロック）\n- PreToolUse:Bashで発火（gh issue editコマンド）\n- issue-multi-problem-check.pyはIssue作成時のみ対象（責務分離）\n- forkセッションではSKIP環境変数を許可しない\n- Python版: issue_scope_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "lesson_issue_check",
      "path": ".claude/hooks/handlers/lesson_issue_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "振り返り時に発見した教訓がIssue化されているか確認する。",
      "keywords": ["issue", "lesson"],
      "why": "振り返りで発見した教訓をIssue化しないと、問題が放置され\n同じ失敗を繰り返す。教訓のIssue化を強制することで改善を促進する。",
      "what": "- 振り返りキーワード（五省、振り返り等）の存在を確認\n- [lesson]タグまたは教訓キーワードを検出\n- Issue参照がない教訓を発見したらブロック",
      "remarks": "- ブロック型フック（[lesson]タグにIssue参照がない場合ブロック）\n- Stopで発火（transcript分析）\n- [lesson]タグ検出は高精度（ブロック）、キーワード検出は警告のみ\n- セッション継続/コードブロック/Read出力等は誤検知防止で除外\n- reflection-completion-checkは振り返り実施を確認（責務分離）",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "locked_worktree_guard",
      "path": ".claude/hooks/handlers/locked_worktree_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "他セッションが所有するPRとworktreeへの操作をブロックする。",
      "keywords": ["claude", "code", "guard", "locked", "worktree"],
      "why": "ロックされたworktreeは別のClaude Codeセッションが作業中であることを示す。\n競合するPR操作やworktree削除をブロックし、セッション間の干渉を防止する。",
      "what": "- gh pr merge/checkout/close等の変更操作を検出\n- git worktree removeコマンドを検出\n- rm コマンドによるworktree削除を検出\n- ロック中worktreeの所有PRへの操作をブロック\n- CWD内のworktree削除をブロック\n- 非ロック中でもアクティブな作業があれば警告",
      "remarks": "- 読み取り専用コマンド（gh pr view等）は許可\n- guard_rules.ts、command_parser.ts、worktree_manager.tsに分割\n- FORCE_RM_ORPHAN=1で孤立worktree削除チェックをスキップ可能",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "log_health_check",
      "path": ".claude/hooks/handlers/log_health_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時にログの健全性を自動検証する。",
      "keywords": ["health", "log"],
      "why": "ログ記録の問題（権限エラー、ディスク不足、セッションID不一致）を\n早期検出することで、メトリクス収集の信頼性を向上させる。",
      "what": "- ログディレクトリ/ファイルの書き込み権限を確認\n- ディスク容量の閾値チェック\n- ログファイルの鮮度（更新日時）チェック\n- メトリクスとログエントリ数の整合性検証\n\nState:\n- reads: .claude/logs/execution/hook-execution-{session}.jsonl\n- reads: .claude/logs/metrics/session-metrics.log",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで警告）\n- Stopで発火\n- session_metrics_collector.pyはメトリクス収集（責務分離）\n- 閾値: 最低100MB空き容量、10分以内の更新、5回以上のフック実行",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "main_sync_check",
      "path": ".claude/hooks/handlers/main_sync_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にローカルmainブランチの同期状態を確認する。",
      "keywords": ["main", "sync"],
      "why": "ローカルmainがリモートより遅れていると、新しいフック/修正が\n適用されず問題が発生する。同期状態を確認し早期に警告する。",
      "what": "- git fetchでリモート情報を更新\n- ローカルmainとorigin/mainのコミット差分を確認\n- 大きく遅れている場合は警告を出力\n- 不審なコミットパターン（同一メッセージ連続）を検出",
      "remarks": "- 警告型フック（ブロックしない、stderrで警告）\n- SessionStartで発火（セッション毎に1回）\n- 閾値: 5コミット以上遅れで警告、3回以上同一メッセージで不審判定\n- ネットワークエラー時はサイレント（フェッチ失敗は警告しない）",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "merge_check",
      "path": ".claude/hooks/handlers/merge_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "blocking",
      "summary": "マージ前の安全性チェックを強制する。",
      "keywords": ["admin", "auto", "codex", "copilot", "merge"],
      "why": "AIレビュー（Copilot/Codex）を確認せずにマージすると、品質問題を\n見逃す可能性がある。また、--auto/--adminオプションや、未解決の\nレビュースレッド、未完了の受け入れ基準があるままマージすると\n品質管理が形骸化する。",
      "what": "- gh pr merge --auto/--adminをブロック\n- REST APIマージをブロック（フックバイパス防止）\n- AIレビュー進行中/エラー状態でのマージをブロック\n- 未解決レビュースレッド、未検証の修正主張をブロック\n- 未完了の受け入れ基準を持つIssueのCloseをブロック\n- --dry-runモードでマージ前チェックが可能",
      "remarks": "- 複数のブロック理由を一度に収集・表示（Issue #874）\n- モジュール分割: ai_review_checker, issue_checker, review_checker等\n- TypeScript移行版",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "merge_commit_quality_check",
      "path": ".claude/hooks/handlers/merge_commit_quality_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr mergeでの--bodyオプション使用をブロックする。",
      "keywords": ["body", "commit", "merge", "quality"],
      "why": "--bodyオプションはPRの詳細な説明（背景、変更内容等）を短い要約で\n上書きしてしまい、コミット履歴から有用な情報が失われる。",
      "what": "- gh pr mergeコマンドを検出\n- --body/-bオプションが使用されていたらブロック\n- PRボディ更新後にマージする正しい方法を案内",
      "remarks": "- ブロック型フック（--body使用時はブロック）\n- PreToolUse:Bashで発火（gh pr mergeコマンド）\n- pr-body-quality-check.tsはPR作成時（責務分離）\n- 正しい方法: gh pr edit → gh pr merge --squash",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "merge_confirmation_warning",
      "path": ".claude/hooks/handlers/merge_confirmation_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "「マージしますか？」パターンを検出し、原則違反を警告する。",
      "keywords": ["agents", "confirmation", "merge", "warning"],
      "why": "AGENTS.mdの「マージまで完遂」原則では、マージ可能になったら\n確認なしに即座にマージすべき。確認パターンは原則違反である。",
      "what": "- Claudeの応答から「マージしますか？」等のパターンを検出\n- 検出したらセッション終了時に警告を表示\n- ルール説明やコードブロック内は誤検知防止で除外",
      "remarks": "- 警告型フック（ブロックしない、事後検出で警告）\n- Stopで発火（transcript分析）\n- AGENTS.md参照や❌例示は誤検知防止で除外\n- 次回からの改善を促すフィードバック",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "merged_worktree_check",
      "path": ".claude/hooks/handlers/merged_worktree_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にマージ済みPRのworktreeを検知して警告する。",
      "keywords": ["merged", "worktree"],
      "why": "PRがマージされた後もworktreeが残っているとディスクを圧迫し、\n混乱の原因になる。マージ済みworktreeを検知し削除を促す。",
      "what": "- .worktrees/ディレクトリ内のworktreeを列挙\n- 各worktreeのブランチに関連するPRがマージ済みか確認\n- マージ済みworktreeがあればsystemMessageで警告",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで情報提供）\n- PreToolUse:Bashで発火（セッション毎に1回）\n- orphan-worktree-check.pyはgit未登録worktreeを検出（責務分離）\n- gh pr viewでマージ済み判定（リモートブランチ削除後も動作）\n- Python版: merged_worktree_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "merit_demerit_check",
      "path": ".claude/hooks/handlers/merit_demerit_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "AskUserQuestionの選択肢にメリット/デメリット分析が含まれているか確認する。",
      "keywords": ["askuserquestion", "demerit", "merit"],
      "why": "選択肢を提示する際、メリット/デメリット/コストの説明がないと\nユーザーが適切な判断を下せない。十分な情報提供を強制する。",
      "what": "- AskUserQuestionツールの呼び出しを検出\n- 各選択肢のlabel/descriptionにメリット・デメリット・コストを確認\n- 3つのうち2つ以上がない場合はブロック",
      "remarks": "- ブロック型フック（説明不足時はブロック）\n- PreToolUse:AskUserQuestionで発火\n- [fact-check]/[事実確認]タグで事実確認質問はスキップ可能\n- 2選択肢未満の場合は判定せずスキップ",
      "trigger": "PreToolUse",
      "matcher": "AskUserQuestion"
    },
    {
      "name": "migration_bug_check",
      "path": ".claude/hooks/handlers/migration_bug_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "移行PRでの移行先バグ検出フック",
      "keywords": ["bug", "issue", "migration", "python", "typescript"],
      "why": "Issue #3549, PR #3542の教訓。移行PR（Python→TypeScript等）で移行先コードに\nバグがある場合、「既存コードの問題だから別Issue」としてマージすると、\nバグ込みで本番に入る。移行先のバグは同じPRで修正必須。",
      "what": "- gh pr merge コマンド実行前に発火\n- PRの差分からsettings.jsonの参照先変更を検出（.py → .ts への切り替え）\n- pending-review マーカーで移行先ファイルへの指摘を確認\n- P1以上の指摘があればブロック\n\nState:\n- reads: .claude/logs/markers/pending-review-{branch}.json\n- reads: .claude/settings.json (via git diff)",
      "remarks": "- PreToolUse:Bash で gh pr merge を検出\n- 移行パターン: .py → .ts/.mjs/.js への参照先変更\n- マージをブロック（警告ではなくブロック）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "multi_issue_guard",
      "path": ".claude/hooks/handlers/multi_issue_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "1つのworktree/PRで複数Issueを同時に対応しようとした場合に警告する。",
      "keywords": ["guard", "issue", "multi", "worktree"],
      "why": "1 worktree = 1 Issue、1 PR = 1 Issueの原則を維持することで、\n変更の追跡性とレビューの容易さを確保する。",
      "what": "- git worktree addのブランチ名/パスから複数Issue番号を検出\n- gh pr createのbodyから複数Closes/Fixes/Resolvesを検出\n- 複数Issueを検出したらsystemMessageで警告",
      "remarks": "- 警告型フック（ブロックしない、正当なケースがあるため）\n- PreToolUse:Bashで発火（git worktree add、gh pr create）\n- issue-auto-assignは単一Issue検出（責務分離）\n- 関連Issue同時修正や親子関係など正当なケースも存在",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "new_python_hook_check",
      "path": ".claude/hooks/handlers/new_python_hook_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "新規Pythonフック追加をブロックする",
      "keywords": ["bun", "hook", "new", "python", "typescript"],
      "why": "新規フックはTypeScript（Bun）で統一し、型安全性と高速起動を確保する。\n既存Pythonフックは保守的に維持するが、新規追加は禁止。",
      "what": "- .claude/hooks/ 以下の全ての新規 .py ファイル作成を検出\n- 除外: ts/, tests/, test/, lib/ ディレクトリ\n- 既存ファイルの編集は許可\n- 新規ファイル作成のみをブロック\n\nState:\n- reads: file system (existsSync)",
      "remarks": "- ブロック型フック（新規Pythonフック作成時にブロック）\n- PreToolUse:Writeで発火\n- 既存Pythonフックの編集は許可（レガシーコードの保守）",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "observation_auto_check",
      "path": ".claude/hooks/handlers/observation_auto_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "操作成功時に動作確認Issueのチェック項目を自動更新する。",
      "keywords": ["auto", "issue", "observation"],
      "why": "作業中に自然と実行される操作（ビルド、テスト等）で動作確認を\n自動検証することで、まとめテストの負担を軽減する。",
      "what": "- ツール実行成功を検出（Bash exit 0、Read成功等）\n- 対応する動作確認項目を特定\n- observation Issueのチェック項目を自動更新\n- 全Claude確認項目チェック時はIssueを自動クローズ\n\nState:\n- writes: GitHub Issue (observation label)",
      "remarks": "- 自動化型フック（ブロックしない、Issue自動更新）\n- PostToolUse:Bash/Readで発火\n- post-merge-observation-issue.pyがIssue作成（補完関係）\n- 人間確認項目（UI表示、モバイル等）は自動チェック対象外",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "observation_reminder",
      "path": ".claude/hooks/handlers/observation_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "マージ成功後に未確認の動作確認Issueをリマインドする。",
      "keywords": ["issue", "observation", "reminder"],
      "why": "マージ後に動作確認を忘れると本番で問題が発生する可能性がある。\nマージ成功のタイミングでリマインドし確認漏れを防止する。",
      "what": "- gh pr mergeの成功を検出\n- オープンな動作確認Issueを一覧表示\n- 確認手順と対応方法を案内",
      "remarks": "- リマインド型フック（ブロックしない、stderrで情報表示）\n- PostToolUse:Bashで発火（gh pr mergeコマンド成功時）\n- post-merge-observation-issue.pyがIssue作成（補完関係）\n- observation-session-reminder.tsはセッション開始時（責務分離）\n- Python版: observation_reminder.py",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "observation_session_reminder",
      "path": ".claude/hooks/handlers/observation_session_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時に未確認の動作確認Issueをリマインドする。",
      "keywords": ["issue", "observation", "reminder", "session"],
      "why": "セッション開始時に未確認の動作確認Issueを表示することで、\nCI待ちや関連作業中に自然と確認する機会を提供する。",
      "what": "- オープンな動作確認Issueを一覧取得\n- Issue番号と件数を簡潔に表示\n- 確認方法（gh issue close）を案内",
      "remarks": "- リマインド型フック（ブロックしない、stderrで情報表示）\n- SessionStartで発火\n- observation-reminder.pyはマージ後リマインド（責務分離）\n- 簡潔な表示でセッション開始時の負担を軽減",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "open_issue_reminder",
      "path": ".claude/hooks/handlers/open_issue_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にオープンIssueをリマインド表示する。",
      "keywords": ["issue", "open", "reminder"],
      "why": "オープンIssueを把握せずに作業を始めると、重複作業や優先度の\n低いタスクに時間を費やしてしまう。セッション開始時にリマインド\nすることで、優先度の高いIssueへの対応を促す。",
      "what": "- セッションの最初のBash実行時にオープンIssueを表示\n- 未アサインのIssueのみを表示\n- 高優先度（P1/P2）のIssueを先頭に表示\n- systemMessageで情報提供（ブロックしない）",
      "remarks": "- task-start-checklistは要件確認、本フックはIssue確認\n- ファイルロックで並行実行時の競合を防止\n- Python版: open_issue_reminder.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "open_pr_warning",
      "path": ".claude/hooks/handlers/open_pr_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にオープンPRと関連worktreeを表示し介入を防止する。",
      "keywords": ["issue", "open", "warning", "worktree"],
      "why": "別セッションが作業中のPR/Issueに介入するとコンフリクトや\n重複作業が発生する。オープンPRを表示し介入を防止する。",
      "what": "- オープンPRの一覧を取得\n- 各PRに関連するworktreeを特定\n- ロックされたworktree（PRなし）も検出\n- セッション開始時に警告メッセージを表示",
      "remarks": "- 警告型フック（ブロックしない、判断はエージェントに委ねる）\n- SessionStartで発火\n- session-handoff-readerは前回セッション引き継ぎ（補完関係）\n- active-worktree-checkはPreToolUseでの確認（タイミング違い）\n- Python版: open_pr_warning.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "orphan_worktree_check",
      "path": ".claude/hooks/handlers/orphan_worktree_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時に孤立したworktreeディレクトリを検知して警告する。",
      "keywords": ["git", "orphan", "worktree", "worktrees"],
      "why": ".worktrees/にディレクトリが残っているが.git/worktrees/に\nエントリがない状態は異常。ディスクを圧迫し混乱の原因となる。",
      "what": "- .worktrees/ディレクトリを走査\n- 対応する.git/worktrees/エントリの存在を確認\n- 孤立worktreeがあればsystemMessageで警告\n- 削除コマンドを提示",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで情報提供）\n- PreToolUse:Bashで発火（セッション毎に1回）\n- merged-worktree-check.pyはマージ済みPR検出（責務分離）\n- ファイルロックで競合状態を防止\n- Python版: orphan_worktree_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "parallel_edit_conflict_check",
      "path": ".claude/hooks/handlers/parallel_edit_conflict_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "sibling fork-session間での同一ファイル編集を警告する。",
      "keywords": ["conflict", "edit", "fork", "parallel", "session", "sibling"],
      "why": "複数のfork-sessionが同一ファイルを編集すると、マージ時に\nコンフリクトが発生する。事前に警告し調整を促す。",
      "what": "- 編集対象ファイルを取得\n- sibling fork-sessionの変更ファイル一覧を取得\n- 同一ファイルを編集中のsiblingがあれば警告\n\nState:\n- reads: transcript files\n- reads: git worktree status",
      "remarks": "- 警告型フック（ブロックしない、systemMessageで警告）\n- PreToolUse:Edit/Writeで発火（fork-sessionのみ）\n- session-worktree-statusは起動時のみ（リアルタイム警告との違い）\n- パス正規化でworktree間の比較を可能に",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "phase_issue_auto_continuation",
      "path": ".claude/hooks/handlers/phase_issue_auto_continuation.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Phase Issueクローズ後に残作業があれば次Phase Issueを自動作成。",
      "keywords": ["auto", "continuation", "issue", "phase", "python", "typescript"],
      "why": "Phase分割タスク（TypeScript移行 Phase 3等）がクローズされた際、\n外部の残作業（Pythonフック等）があっても次Phaseが作成されず、\n作業が中断してしまう問題があった（Issue #2917）。",
      "what": "- gh issue close 成功後（PostToolUse）に発火\n- Issue titleに「Phase N」が含まれるか確認\n- 残作業検出（settings.jsonのPythonフック数等）\n- 残作業があれば次Phase Issueを自動作成",
      "remarks": "- PostToolUseフック（Issueクローズ成功後に実行）\n- 残作業検出ロジックはTypeScript移行に特化（拡張可能）\n- 作成されたIssue番号をsystemMessageで通知",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "phase_progression_guard",
      "path": ".claude/hooks/handlers/phase_progression_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Phase完了時に次Phaseの開始を強制する。",
      "keywords": ["agents", "guard", "phase", "progression"],
      "why": "Phase分割タスクでPhase 1完了後にセッションが止まり、\nユーザーが指摘するまで次Phaseが開始されない問題があった。\nAGENTS.mdに原則として記載されているが、強制機構がなかった。",
      "what": "- 計画ファイル（~/.claude/plans/*.md, .claude/plans/*.md）をスキャン\n- フェーズ構造を検出（## フェーズX: または ## Phase X:）\n- 完了したフェーズの後に未完了フェーズがある場合、ブロック",
      "remarks": "- Stopフックとして実行\n- 直近1時間以内に更新されたファイルのみ対象\n- コードブロック内のチェックボックスは除外",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "plan_ai_review",
      "path": ".claude/hooks/handlers/plan_ai_review.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ExitPlanMode時にPlanファイルをGemini CLIでレビューする",
      "keywords": ["cli", "exitplanmode", "gemini", "issue", "plan", "review"],
      "why": "Plan段階でAIレビューを実行することで、技術的実現性や設計妥当性を\n実装前に検証できる。Issue作成時のAIレビューは冗長だったが、\nPlan段階ではコードベース調査後の具体的な計画があるため価値が高い。",
      "what": "- ExitPlanMode成功後に発火\n- .claude/plans/および~/.claude/plans/配下の最新planファイルを検出\n- Gemini CLIでレビューを実行\n- レビュー結果をsystemMessageでClaudeに通知",
      "remarks": "- PostToolUse:ExitPlanModeで発火\n- バックグラウンド実行（ブロッキングなし）\n- Gemini CLI単体使用（Codexは精度問題のため除外）",
      "trigger": "PostToolUse",
      "matcher": "ExitPlanMode"
    },
    {
      "name": "plan_checklist_guard",
      "path": ".claude/hooks/handlers/plan_checklist_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "計画ファイルの未完了チェックリストを検出する。",
      "keywords": ["checklist", "guard", "issue", "phase", "plan"],
      "why": "Phase完了時に計画書のチェックリストを自動検証し、\n見落としを防止する。Issue #2849の振り返りで発見。",
      "what": "- ~/.claude/plans/*.md と .claude/plans/*.md をスキャン\n- 未完了チェックボックス（- [ ], * [ ], + [ ], 1. [ ]）を検出\n- 警告を出力（ブロックしない）\n\nState:\n- reads: ~/.claude/plans/*.md\n- reads: .claude/plans/*.md",
      "remarks": "- Stopフックとして実行\n- コードブロック内のチェックボックスは除外\n- 直近1時間以内に更新されたファイルのみ対象",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "plan_file_updater",
      "path": ".claude/hooks/handlers/plan_file_updater.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr merge成功後に計画ファイルのチェックボックスを自動更新する。",
      "keywords": ["file", "merge", "plan", "updater"],
      "why": "PRマージ後に計画ファイルのチェックボックスが未完了のまま残ると、\n進捗状況が不明確になる。自動更新で一貫性を維持する。",
      "what": "- gh pr mergeの成功を検出\n- PRからブランチ名→Issue番号を抽出\n- 対応する計画ファイルを検索\n- 全チェックボックスを[ ]から[x]に更新\n\nState:\n- writes: .claude/plans/*.md\n- writes: ~/.claude/plans/*.md",
      "remarks": "- 自動化型フック（ブロックしない、ファイル自動更新）\n- PostToolUse:Bashで発火（gh pr merge成功時）\n- .claude/plans/と~/.claude/plans/の両方を検索\n- コードブロック内のチェックボックスは更新しない",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "planning_enforcement",
      "path": ".claude/hooks/handlers/planning_enforcement.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PreToolUse hook: Enforce plan file before Issue work.",
      "keywords": [
        "before",
        "enforce",
        "enforcement",
        "file",
        "hook",
        "issue",
        "plan",
        "planning",
        "pretooluse",
        "work"
      ],
      "why": "Issue作業を開始する前にプラン作成を強制することで、\n設計なしの実装による手戻りを防ぐ。",
      "what": "- git worktree add コマンドを検出\n- issue-XXX パターンからIssue番号を抽出\n- バイパス条件をチェック（ラベル、タイトル、環境変数）\n- ブランチ存在チェック（競合リスク検出）\n- 既に解決済みかチェック（merged PRs）\n- plan file存在チェック",
      "remarks": "- ブロック型フック（PreToolUse:Bash）\n- バイパス: SKIP_PLAN, SKIP_ALREADY_FIXED, SKIP_BRANCH_CHECK環境変数\n- バイパス: documentation/trivial/p2/p3/enhancementラベル\n- バイパス: test:/chore:/docs:/fix:タイトルプレフィックス\n- Python版: planning_enforcement.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "post_merge_flow_completion",
      "path": ".claude/hooks/handlers/post_merge_flow_completion.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ後のフローステップ（issue_updated）を自動完了。",
      "keywords": ["completion", "flow", "issue", "merge", "post", "updated"],
      "why": "gh pr merge成功後、Issueにコメントを追加してフローステップを\n自動完了させる。手動操作なしでフローを進行させる。",
      "what": "- PRからリンクされたIssue番号を抽出\n- Issueに完了コメントを追加（issue_updatedステップトリガー）",
      "remarks": "- PostToolUseフック\n- pr-merge-pull-reminderはpull、本フックはフローステップ完了\n- 自動化型: マージ成功後にIssueコメントを自動追加",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "post_merge_observation_issue",
      "path": ".claude/hooks/handlers/post_merge_observation_issue.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ後に動作確認Issueを自動作成。",
      "keywords": ["issue", "merge", "observation", "post"],
      "why": "PRマージ後の動作確認を体系的に追跡するため、\n軽量な確認Issueを自動作成する。",
      "what": "- PRに非ドキュメント変更が含まれるかチェック\n- 軽量な確認Issue（チェックリスト付き）を作成\n- マージしたPRとリンク",
      "remarks": "- PostToolUseフック\n- post-merge-flow-completion.py と補完関係\n- 自動化型: マージ成功後に軽量な動作確認Issueを作成\n- Issue #2501参照",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "post_merge_reflection_enforcer",
      "path": ".claude/hooks/handlers/post_merge_reflection_enforcer.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ成功後に振り返りを即時実行させる。",
      "keywords": ["enforcer", "merge", "post", "reflection"],
      "why": "PRマージ後の振り返りを後回しにすると、コンテキストが失われ、\n教訓が得られない。即時実行を促進することで、振り返りの質を高める。",
      "what": "- gh pr mergeの成功を検出\n- decision: \"block\" + continue: trueで即時アクションを誘発\n- [IMMEDIATE: /reflecting-sessions]をsystemMessageで出力（トランスクリプトに記録）\n- immediate-pending-check.pyが次のユーザー入力時に実行を強制\n- reflection-completion-check.pyがセッション終了時に最終チェック\n\nState:\n- writes: /tmp/claude-hooks/immediate-pending-{session_id}.json",
      "remarks": "- reflection-reminderはリマインド表示、本フックは即時実行促進\n- guard_rules.tsがworktree内マージも同様に処理",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_body_quality_check",
      "path": ".claude/hooks/handlers/pr_body_quality_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRボディに「なぜ」と「参照」が含まれているかチェックする。",
      "keywords": ["body", "issue", "quality"],
      "why": "PRの背景・動機が不明なままマージすると、将来の変更履歴追跡が困難になる。\nまた、Issue/PRへの参照がないとトレーサビリティが失われる。",
      "what": "- gh pr create/mergeコマンドを検出\n- PRボディから「なぜ」セクションの存在を確認\n- Issue/PR/ドキュメントへの参照を確認\n- 不足している場合はブロック",
      "remarks": "- closes-keyword-checkはClosesキーワードの提案、これは全体品質チェック\n- --body-file/-F使用時はファイル内容を確認できないため警告のみ\n- 段階的移行PRにはIssue参照強制（Issue #2608）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_defer_check",
      "path": ".claude/hooks/handlers/pr_defer_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PR/Issue説明文に「後で」系キーワードがIssue参照なしで含まれる場合にブロックする。",
      "keywords": ["defer", "issue", "keyword", "transcript"],
      "why": "「別途対応予定」「将来改善」等の表現がIssue参照なしで使用されると、\n対応が忘れられ、技術的負債が蓄積する。defer_keyword_check.pyは\ntranscriptをチェックするがPR/Issue説明文は対象外だった。",
      "what": "- gh pr create/gh issue createコマンドの--body引数を検出\n- 「後で」系キーワードを正規表現でチェック\n- Issue参照（#数字）が近くにない場合はブロック",
      "remarks": "- ブロック型フック（PreToolUse:Bash）\n- defer_keyword_check.pyと同じキーワードパターンを使用\n- Issue参照が100文字以内にあれば許可",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_issue_alignment_check",
      "path": ".claude/hooks/handlers/pr_issue_alignment_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PR作成時に対象Issueの受け入れ条件を検証する。",
      "keywords": [
        "added",
        "alignment",
        "closed",
        "debug",
        "different",
        "fix",
        "implemented",
        "issue",
        "logs",
        "only",
        "something"
      ],
      "why": "- Issue #538 was closed with a PR that implemented something different\n- Issue #590 was closed with a PR that only added debug logs (not a fix)\n受け入れ条件を可視化し、不完全な状態でのクローズを防止する。",
      "what": "- gh pr create コマンドを検出\n- Closes/Fixes キーワードからIssue番号を抽出\n- Issue内容と受け入れ条件を取得\n- 未完了の条件がある場合は警告",
      "remarks": "- 非ブロック型（警告のみ）\n- closes-validation.pyはキーワード検証、このフックは内容検証\n- Python版: pr_issue_alignment_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_issue_assign_check",
      "path": ".claude/hooks/handlers/pr_issue_assign_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr create 時に Closes で参照される Issue のアサイン確認・自動アサイン。",
      "keywords": ["assign", "closes", "create", "issue"],
      "why": "PRで参照されるIssueが誰にもアサインされていないと、\n他のセッションが同じIssueに着手する競合リスクがある。\n自動アサインで競合を防止する。",
      "what": "- gh pr createコマンドからPRボディを抽出\n- Closes #xxxパターンからIssue番号を抽出\n- アサインされていないIssueを自動アサイン\n- 他者にアサイン済みの場合は警告",
      "remarks": "- 非ブロック型（PreToolUse）\n- issue-auto-assign.pyはworktree作成時、本フックはPR作成時\n- --body inline引数のみ対応（エディタ入力は対象外）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_merge_pull_reminder",
      "path": ".claude/hooks/handlers/pr_merge_pull_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PostToolUse hook to auto-pull main after PR merge.",
      "keywords": [
        "after",
        "auto",
        "hook",
        "main",
        "merge",
        "posttooluse",
        "pull",
        "reminder",
        "worktree"
      ],
      "why": "PRマージ後にmainブランチを最新化しないと、次のworktree作成時に\n古いmainをベースにしてしまう問題を防ぐ。",
      "what": "- gh pr merge 成功を検出\n- mainリポジトリのmainブランチを自動pull\n- worktree内でも親リポジトリのmainをpull",
      "remarks": "- PostToolUse:Bash フック\n- 非ブロック型（自動pull実行、失敗時はリマインド表示）\n- mainブランチ以外の場合は手動pullをリマインド\n- Python版: pr_merge_pull_reminder.py",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_metrics_collector",
      "path": ".claude/hooks/handlers/pr_metrics_collector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRメトリクス自動収集フック（PostToolUse）",
      "keywords": ["collector", "metrics", "posttooluse"],
      "why": "PRのメトリクス（サイクルタイム、レビュー数等）を自動収集し、\n開発プロセスの改善に役立てる。",
      "what": "- gh pr merge コマンドの成功を検出\n- PR番号を抽出\n- collect_pr_metrics.py スクリプトを実行してメトリクスを収集\n\nState:\n- calls: .claude/scripts/collect_pr_metrics.py",
      "remarks": "- 非ブロック型（PostToolUse）\n- メトリクス収集失敗時もブロックしない",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_overlap_check",
      "path": ".claude/hooks/handlers/pr_overlap_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "git push/gh pr create時に他PRとのファイル重複を警告。",
      "keywords": ["create", "git", "overlap", "push"],
      "why": "複数PRが同じファイルを変更するとマージ時にコンフリクトが発生する。\npush/PR作成時点で重複を検知し、早期に調整できるようにする。",
      "what": "- git push / gh pr create コマンドを検出\n- 現在のブランチで変更されたファイルを取得\n- オープン中の他PRの変更ファイルと比較\n- 重複があればsystemMessageで警告",
      "remarks": "- 非ブロック型（警告のみ）\n- gh CLI 2.35.0+が必要（files取得のため）\n- 最大50件のPRをチェック",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_related_issue_check",
      "path": ".claude/hooks/handlers/pr_related_issue_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr create 時に関連オープンIssueの確認を促す。",
      "keywords": ["create", "issue", "related"],
      "why": "PR作成時に関連するオープンIssueがあることを知らないと、\n重複作業や見落としが発生する。キーワードベースで関連Issueを\n検索し、確認を促す。",
      "what": "- gh pr createコマンドからタイトル・ボディを抽出\n- キーワードを抽出してIssue検索\n- 関連するオープンIssueを警告表示",
      "remarks": "- 非ブロック型（警告のみ）\n- ストップワード（助詞、一般的なGit用語）を除外\n- 最大5件のIssueを表示",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_scope_check",
      "path": ".claude/hooks/handlers/pr_scope_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr create時に1 Issue = 1 PRルールを強制。",
      "keywords": ["create", "issue", "scope"],
      "why": "複数Issueを1つのPRにまとめると、レビューが複雑になり、\n問題発生時のリバートが困難になり、変更履歴が不明確になる。",
      "what": "- gh pr create コマンドを検出\n- PRタイトルからIssue参照を抽出\n- 複数Issue参照がある場合はブロック\n- 単一Issue参照はOKメッセージを表示",
      "remarks": "- ブロック型フック\n- -F/--body-file使用時は--titleも指定するよう警告\n- Python版: pr_scope_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "pr_test_coverage_check",
      "path": ".claude/hooks/handlers/pr_test_coverage_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "gh pr create時に変更されたフックのテストカバレッジを確認。",
      "keywords": ["coverage", "create", "test"],
      "why": "フック変更時にテストがないとエッジケースの見落としが発生する。\nPR作成前にテスト不足を警告し、品質維持を促す。",
      "what": "- gh pr create コマンドを検出\n- mainブランチとの差分から変更ファイルを取得\n- .claude/hooks/*.py に対応する tests/test_{name}.py の存在確認\n- テストがないフックについて警告",
      "remarks": "- 非ブロック型（警告のみ、fail-open設計）\n- __init__.py, common.py はスキップ",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "problem_report_check",
      "path": ".claude/hooks/handlers/problem_report_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に問題報告とIssue作成の整合性を確認。",
      "keywords": ["issue", "problem", "report"],
      "why": "問題を発見してもIssueを作成せずセッションを終了すると、\n問題が放置される。問題報告パターンを検出し、Issue作成を促す。",
      "what": "- セッションのトランスクリプトを解析\n- Claude発言から問題報告パターン（バグ発見、エラー発生等）を検出\n- gh issue createコマンドの実行有無を確認\n- 問題報告ありかつIssue作成なしなら警告",
      "remarks": "- 非ブロック型（誤検知リスクのため警告のみ）\n- Stopフック\n- AGENTS.md「Issue作成が必要なケース」を仕組み化",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "production_url_warning",
      "path": ".claude/hooks/handlers/production_url_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "本番環境URLへのアクセス前に警告・確認を促す。",
      "keywords": ["dekita", "dev", "pages", "production", "url", "warning"],
      "why": "本番環境への誤アクセスは意図しない副作用を起こす可能性がある。\nまた、類似ドメイン（dekita.pages.dev等）への誤アクセスを防ぐ。",
      "what": "- mcp__chrome-devtools__navigate_page/new_page を検出\n- URLが本番環境（dekita.app, api.dekita.app）なら警告表示\n- 間違ったURL（dekita.pages.dev等）の場合はブロック",
      "remarks": "- 本番URL: 警告のみ（approve with systemMessage）\n- 間違ったURL: ブロック\n- CUSTOMIZE: PRODUCTION_HOSTNAMESを自プロジェクトに合わせて変更",
      "trigger": "PreToolUse",
      "matcher": "mcp__chrome-devtools__navigate_page|mcp__chrome-devtools__new_page"
    },
    {
      "name": "python_hook_guard",
      "path": ".claude/hooks/handlers/python_hook_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Pythonフック新規作成をブロックし、TypeScript使用を推奨する",
      "keywords": ["guard", "hook", "issue", "python", "typescript"],
      "why": "Issue #2816でPython → TypeScript移行計画があるにもかかわらず、\n新規フックをPythonで実装してしまうミスを防止する。",
      "what": "- WriteツールでPythonファイル作成を検出\n- .claude/hooks/配下への新規.pyファイル作成をブロック\n- TypeScript版での実装を推奨",
      "remarks": "- 既存ファイルの編集は許可（移行中のため）\n- tests/配下のテストファイルは許可\n- lib/配下のユーティリティは許可（段階的移行）",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "python_lint_check",
      "path": ".claude/hooks/handlers/python_lint_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "git commit前にPythonコードのフォーマット・lintを自動修正。",
      "keywords": ["commit", "git", "lint", "python"],
      "why": "Pythonコードのスタイル違反でCIが失敗すると手戻りが発生する。\nコミット前に自動修正することでCI失敗を未然に防ぐ。",
      "what": "- git commit コマンドを検出\n- ステージングされたPythonファイルを取得\n- ruff format/checkでフォーマット・lint問題を自動修正\n- 修正後にファイルを再ステージング\n- 自動修正不可能な場合のみブロック",
      "remarks": "- ブロック型フック（自動修正失敗時のみ）\n- fail-open設計（エラー時は許可）\n- worktree対応（絶対パス変換）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "recurring_problem_block",
      "path": ".claude/hooks/handlers/recurring_problem_block.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "繰り返し発生する問題を検出し、Issue作成を強制してからマージを許可。",
      "keywords": ["block", "issue", "problem", "recurring"],
      "why": "同じフックで何度もブロックされる場合、根本的な改善が必要。\nIssue作成を強制することで、問題を放置せず仕組み化を促す。",
      "what": "- gh pr merge コマンドを検出\n- 過去7日間のフック実行ログを集計\n- 3セッション以上で3回以上ブロックされたフックを検出\n- 該当する[改善]Issueがなければブロック\n\nState:\n- reads: .claude/logs/execution/hook-execution-*.jsonl",
      "remarks": "- ブロック型フック\n- PROTECTIVE_HOOKSは繰り返しブロック対象外\n- Issue作成後はブロック解除\n- Python版: recurring_problem_block.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "reference_comment_check",
      "path": ".claude/hooks/handlers/reference_comment_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Edit時に「〜と同じ」参照スタイルのコメントを検出して警告。",
      "keywords": ["comment", "copied", "edit", "reference"],
      "why": "「〜と同じ」「copied from 〜」などの参照コメントは、\n参照先が変更されると嘘になりやすい。コードの整合性が崩れる。",
      "what": "- Editツール実行を検出\n- new_stringから参照スタイルのコメントパターンを検索\n- 検出時はsystemMessageで警告（importや理由説明への変更を推奨）",
      "remarks": "- 非ブロック型（警告のみ）\n- PreToolUse:Edit フック\n- .py, .ts, .tsx, .js, .jsx ファイルが対象\n- Python版: reference_comment_check.py",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "reflection_completion_check",
      "path": ".claude/hooks/handlers/reflection_completion_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ後または/reflecting-sessions skill invoke後の振り返り完了を検証する。",
      "keywords": ["completion", "invoke", "reflecting", "reflection", "sessions", "skill"],
      "why": "PRマージ後に振り返りをせずにセッションを終了すると、学習機会を逃し、\n同じ問題を繰り返す可能性がある。振り返りの完了をブロックで強制する。",
      "what": "- reflection_requiredフラグの確認（post-merge-reflection-enforcerが設定）\n- flow stateからマージ完了フェーズを検知\n- /reflecting-sessions skillの呼び出し確認\n- 五省分析が実行されたか検証\n- [IMMEDIATE: action]タグの実行検証\n- 要件未達成時はセッション終了をブロック\n\nState:\n- reads: /tmp/claude-hooks/reflection-required-{session_id}.json\n- reads: .claude/logs/flow/*.jsonl",
      "remarks": "- post-merge-reflection-enforcer.pyがフラグ設定、本フックが検証\n- Issue作成強制はsystematization-check.pyが担当\n- 振り返り完了条件: 五省分析キーワード検出、または「振り返り完了」明示\n- lib/reflection.tsの共通関数を使用（Issue #2694）",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "reflection_log_collector",
      "path": ".claude/hooks/handlers/reflection_log_collector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "振り返りスキル実行時にセッションログを自動集計して提供。",
      "keywords": ["collector", "log", "reflection"],
      "why": "振り返り時に手動でログを確認するのは手間がかかり、見落としが発生する。\n自動集計することで、客観的データに基づく振り返りを促進する。",
      "what": "- Skill(reflect)ツール呼び出しを検出\n- セッションのブロック回数をhook-errors.logから集計\n- フロー状態（現在フェーズ等）をstate-{session_id}.jsonから取得\n- recurring-problem-block検出情報を取得\n- systemMessageとしてClaudeに提供",
      "remarks": "- 非ブロック型（情報提供のみ）\n- PreToolUse:Skill フック\n- Python版: reflection_log_collector.py",
      "trigger": "PreToolUse",
      "matcher": "Skill"
    },
    {
      "name": "reflection_progress_tracker",
      "path": ".claude/hooks/handlers/reflection_progress_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "振り返り中のIssue作成を検出して進捗を追跡。",
      "keywords": ["completion", "issue", "progress", "reflection", "tracker"],
      "why": "振り返りで発見した改善点はIssue化が必要。Issue作成を追跡し、\nreflection-completion-checkが振り返り完了を判定できるようにする。",
      "what": "- gh issue create コマンドの成功を検出\n- 作成されたIssue番号を抽出\n- セッション状態ファイルにIssue番号を記録\n\nState:\n- writes: /tmp/claude-hooks/reflection-required-{session_id}.json",
      "remarks": "- 非ブロック型（PostToolUse）\n- post-merge-reflection-enforcerがフラグ設定、本フックは進捗追跡\n- reflection-completion-checkがセッション終了時に検証",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "reflection_quality_check",
      "path": ".claude/hooks/handlers/reflection_quality_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "振り返りの形式的評価を防ぐ（ブロック回数との矛盾検出、改善点Issue化強制）。",
      "keywords": ["issue", "quality", "reflection"],
      "why": "形式的・表面的な振り返りは実質的な改善につながらない。\n客観的メトリクス（ブロック回数）と主観的評価（「問題なし」）の\n矛盾を検出し、根本原因分析を強制する。また、改善点を発見しても\nIssue化しなければ忘れられるため、Issue参照を強制する。",
      "what": "- フック実行ログからブロック回数をカウント\n- トランスクリプトから振り返り内容を分析\n- 矛盾検出（3回以上ブロックなのに「問題なし」）時にブロック\n- 改善点があるのにIssue参照がない場合にブロック",
      "remarks": "- reflection-completion-checkはキーワード存在確認、本フックは品質検証\n- ブロック型フック（警告ではなくブロック）\n- 根本原因パターン（なぜ、根本原因、原因は）があれば通過",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "reflection_reminder",
      "path": ".claude/hooks/handlers/reflection_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージや一定アクション後に振り返りをリマインド。",
      "keywords": ["reflection", "reminder"],
      "why": "タスク完了後やセッションが長時間続いた際に振り返りを促し、\n学習機会を逃さないようにする。",
      "what": "- gh pr merge / git merge 成功を検出しリマインド\n- 10アクションごとに定期リマインド\n- セッション状態ファイルでアクション回数を追跡\n\nState:\n- writes: /tmp/claude-hooks/reflection-state-{session_id}.json",
      "remarks": "- 非ブロック型（リマインダー表示のみ）\n- PostToolUse:Bash フック\n- PRマージリマインドと定期リマインドは排他（マージ優先）\n- Python版: reflection_reminder.py",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "reflection_self_check",
      "path": ".claude/hooks/handlers/reflection_self_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "振り返りの観点網羅性を確認し、抜けがあればブロック。",
      "keywords": ["reflection", "self"],
      "why": "振り返りで特定の観点（根本原因分析、見落とし確認等）が抜けると、\n表面的な振り返りになり改善につながらない。観点チェックを強制する。",
      "what": "- トランスクリプトから振り返りキーワードを検出\n- PERSPECTIVESリストの各観点がカバーされているか確認\n- 抜けている観点があればブロック\n- セッション内の繰り返しブロックパターンを提示\n\nState:\n- reads: .claude/logs/metrics/block-patterns-{session_id}.jsonl",
      "remarks": "- ブロック型フック（Stopフック）\n- reflection-quality-checkは矛盾検出、本フックは観点網羅性\n- 振り返りなしの場合はスキップ",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "regex_pattern_reminder",
      "path": ".claude/hooks/handlers/regex_pattern_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "正規表現パターン実装時にAGENTS.mdチェックリストを表示。",
      "keywords": ["agents", "pattern", "regex", "reminder"],
      "why": "正規表現実装でよくあるミス（成功条件確認漏れ、フラグ不一致等）を\n防ぐため、編集時にチェックリストを提示する。",
      "what": "- Edit操作でPythonファイルを検出\n- new_stringに正規表現パターン（re.compile, PATTERN= 等）があるか確認\n- 検出時はAGENTS.mdのチェックリストをsystemMessageで表示\n- 同一ファイルへのリマインドは1セッション1回\n\nState:\n- writes: /tmp/claude-hooks/regex-pattern-reminded-{session_id}.json",
      "remarks": "- 非ブロック型（情報提供のみ）\n- PreToolUse:Edit フック\n- AGENTS.md「パターンマッチング実装（P1）」を仕組み化\n- Python版: regex_pattern_reminder.py",
      "trigger": "PostToolUse",
      "matcher": "Edit"
    },
    {
      "name": "related_task_check",
      "path": ".claude/hooks/handlers/related_task_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時にセッション内作成Issueのステータスを確認し、未完了ならブロック。",
      "keywords": ["issue", "related", "task"],
      "why": "セッション内で作成したIssueは同セッションで実装まで完遂する必要がある。\nIssue作成だけで終了させず、実装を強制する。",
      "what": "- セッション終了時（Stopフック）に発火\n- session-created-issues-{session_id}.jsonから作成Issue一覧を取得\n- GitHubでIssueステータスを確認\n- 未完了（OPEN）Issueがあればセッション終了をブロック\n- fork-sessionへの委譲（PR/ロック済worktree存在）は許可\n\nState:\n- reads: .claude/logs/flow/session-created-issues-{session_id}.json",
      "remarks": "- ブロック型フック（回数制限なし、完了まで無限ブロック）\n- issue-creation-trackerが記録、本フックが検証\n- 見送る場合は `gh issue close --reason \"not planned\"` で明示",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "research_requirement_check",
      "path": ".claude/hooks/handlers/research_requirement_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Issue/PR作成前にWeb調査を強制する。",
      "keywords": ["issue", "requirement", "research", "web"],
      "why": "十分な調査なしにIssue/PRを作成すると、既存の解決策を見落としたり、\n同様のIssueが既に存在する可能性がある。事前調査を強制する。",
      "what": "- gh issue create / gh pr create コマンドを検出\n- セッション内のWebSearch/WebFetch履歴を確認\n- 調査なしの場合はブロック\n- バイパス条件: documentation/trivialラベル、十分な探索、本文に「調査不要」",
      "remarks": "- ブロック型フック（PreToolUse:Bash）\n- research-trackerがWeb調査を記録、本フックが検証\n- コードベース探索（Grep/Glob 5回以上）もWeb調査の代替として許可\n- Python版: research_requirement_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "research_tracker",
      "path": ".claude/hooks/handlers/research_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション内のWebSearch/WebFetch使用を追跡。",
      "keywords": ["issue", "research", "tracker", "web", "webfetch", "websearch"],
      "why": "Issue/PR作成前に調査が行われたかを検証するため、\nWeb検索活動をセッション単位で記録する必要がある。",
      "what": "- WebSearch/WebFetchツール使用を検出\n- 検索クエリ/URLをセッションマーカーファイルに記録\n- research-requirement-checkが後で参照\n\nState:\n- writes: /tmp/claude-hooks/research-activity-{session_id}.json",
      "remarks": "- 非ブロック型（PostToolUse、記録のみ）\n- research-requirement-checkと連携\n- クエリは200文字に切り詰めて記録\n- Python版: research_tracker.py",
      "trigger": "PostToolUse",
      "matcher": "WebSearch|WebFetch"
    },
    {
      "name": "resolve_thread_guard",
      "path": ".claude/hooks/handlers/resolve_thread_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "レビュースレッドResolve時に応答コメントを強制。",
      "keywords": ["guard", "resolve", "thread"],
      "why": "レビューコメントに返信せずにResolveすると、レビュアーへの説明責任が\n果たされず、対応内容が不明確になる。返信を強制する。",
      "what": "- resolveReviewThread GraphQL mutationを検出\n- スレッド内にClaude Code応答コメントがあるか確認\n- 応答なしの場合はブロック\n- 修正主張には検証内容（Verified:）を要求\n- 範囲外発言にはIssue番号を要求",
      "remarks": "- ブロック型フック（PreToolUse:Bash）\n- batch_resolve_threads.tsの使用を推奨\n- REST APIも併用してコメント取得（GraphQLの遅延対策）\n- fail-open設計（APIエラー時は許可）\n- Python版: resolve_thread_guard.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "review_comment_action_reminder",
      "path": ".claude/hooks/handlers/review_comment_action_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "レビューコメント読み込み後にアクション継続を促すリマインダー。",
      "keywords": ["action", "api", "comment", "reminder", "review"],
      "why": "レビューコメントを `gh api` で読み込んだ後、テキストのみで終わると\n問題の見落としや対応漏れが発生する。リアルタイムでリマインドすることで\nアクション継続を促進する。",
      "what": "- `gh api repos/.../pulls/.../comments` の成功を検出\n- systemMessage でアクション継続を促すリマインダーを出力\n- 振り返り時に事後チェック（reflection_self_check.py）と連携\n\nTrigger:\n- PostToolUse (Bash)\n\nState:\n- Stateless（状態管理なし）",
      "remarks": "- 振り返り観点 `review_comment_action_continuation` と連携\n- ブロックではなくリマインダー（continue: true + systemMessage）",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "review_promise_tracker",
      "path": ".claude/hooks/handlers/review_promise_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "レビュー返信で「別Issue対応」と約束した場合のIssue作成追跡フック。",
      "keywords": ["issue", "promise", "review", "tracker"],
      "why": "レビューコメントへの返信で「別Issue」「今後の改善」等と言いながら\nIssue作成を忘れるケースを防止する。",
      "what": "- PostToolUse: レビュースレッド返信で約束パターンを検出 → 記録\n- PostToolUse: gh issue create を検出 → 約束を解消\n- Stop: 未解消の約束があれば警告\n\nState:\n- writes: {SESSION_DIR}/review-promises-{session}.json",
      "remarks": "- PostToolUse:Bash と Stop の両方で発火\n- 約束パターンは日本語/英語両方対応\n- path traversal攻撃対策済み",
      "trigger": ["PostToolUse", "Stop"],
      "matcher": ["Bash", null]
    },
    {
      "name": "review_response_check",
      "path": ".claude/hooks/handlers/review_response_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "AIレビューのMEDIUM以上の指摘に対する対応を強制する。",
      "keywords": ["codex", "gemini", "medium", "response", "review"],
      "why": "AIレビュー（Codex/Gemini）でMEDIUM以上の指摘があっても、修正せずに\nプッシュできてしまう問題がある。対応を強制して品質を担保する。",
      "what": "- git pushコマンドを検出\n- 未対応指摘マーカーファイル（pending-review-{branch}.json）を確認\n- マーカーが存在する場合、対応状況を確認\n- 対応がない場合はプッシュをブロック\n\nState:\n- reads: .claude/logs/markers/pending-review-{branch}.json",
      "remarks": "- ブロック型フック（未対応指摘がある場合はブロック）\n- PreToolUse:Bashで発火（git pushコマンド）\n- 対応方法: コード修正コミット or Issue参照コミット\n- SKIP_REVIEW_RESPONSE_CHECK=1でバイパス可能",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "reviewer_removal_check",
      "path": ".claude/hooks/handlers/reviewer_removal_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PreToolUse hook: Block removal of AI reviewers from PRs.",
      "keywords": [
        "api",
        "block",
        "circumvents",
        "codex",
        "complete",
        "copilot",
        "hook",
        "naturally",
        "pretooluse",
        "process",
        "prs",
        "removal",
        "removing",
        "review",
        "reviewer",
        "reviewers",
        "reviews",
        "should",
        "their",
        "them",
        "via"
      ],
      "why": "AI reviewers (Copilot, Codex) should complete their reviews naturally.\nRemoving them via API circumvents the review process.",
      "what": "- Detects gh api calls that would remove AI reviewers\n- Blocks removal of Copilot or Codex from requested reviewers\n- Allows legitimate reviewer management\n\nDetection methods:\n- Here-string: <<< '{\"reviewers\":[\"Copilot\"]}'\n- Heredoc: << EOF ... EOF\n- Flag: -f reviewers='[\"Copilot\"]'",
      "remarks": "- ブロック型フック（AI reviewer削除試行時にブロック）\n- PreToolUseで発火（Bashコマンドのみ）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "rework_tracker",
      "path": ".claude/hooks/handlers/rework_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "同一ファイルへの短時間複数編集（手戻り）を追跡。",
      "keywords": ["rework", "tracker"],
      "why": "同一ファイルへの繰り返し編集は、計画不足や試行錯誤を示唆。\n警告することで、事前調査・計画の重要性を強調する。",
      "what": "- Edit成功後（PostToolUse:Edit）に発火\n- 5分以内の同一ファイル編集回数を追跡\n- 閾値超過で3段階警告（3回: 軽度、5回: 強め、7回: 停止推奨）\n- メトリクスログに記録\n\nState:\n- reads/writes: /tmp/claude-hooks/edit-history.json\n- writes: .claude/logs/metrics/rework-metrics.log",
      "remarks": "- 非ブロック型（警告のみ、systemMessageで通知）\n- セッション変更時に履歴リセット\n- 計画的な編集（テスト駆動開発等）を促進",
      "trigger": "PostToolUse",
      "matcher": "Edit"
    },
    {
      "name": "scope_check",
      "path": ".claude/hooks/handlers/scope_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "作業中Issueへのスコープ外タスク混入を検出する",
      "keywords": ["issue", "scope"],
      "why": "Issue #Xの作業中に関係のないタスク（Issue #Y相当）を同じPRに混入すると：\n- PRのスコープが曖昧になる\n- レビューが困難になる\n- 問題発生時の切り分けが難しくなる",
      "what": "- Writeツールで新規ファイル作成を検出\n- worktree/ブランチ名からIssue番号を抽出\n- 新規機能ファイル（フック、コンポーネント等）作成時に警告\n- 「作業中のIssue #Xのスコープ内ですか？」と確認",
      "remarks": "- ブロックではなく警告のみ（approve + message）\n- 既存ファイルの編集は対象外\n- テストファイルや設定ファイルは警告対象外",
      "trigger": "PostToolUse",
      "matcher": "Write"
    },
    {
      "name": "script_test_reminder",
      "path": ".claude/hooks/handlers/script_test_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PostToolUse hook: Remind to add tests when new functions are added to scripts.",
      "keywords": [
        "add",
        "added",
        "adding",
        "already",
        "claude",
        "corresponding",
        "definitions",
        "developer",
        "editing",
        "exists",
        "file",
        "files",
        "function",
        "functions",
        "hook",
        "new",
        "posttooluse",
        "remind",
        "reminder",
        "reminds",
        "script",
        "scripts",
        "test",
        "tests",
        "when"
      ],
      "why": "When editing .claude/scripts/*.py files and adding new function\ndefinitions, this hook reminds the developer to add corresponding tests\nif a test file already exists.",
      "what": "- Single responsibility: Remind to add tests when new functions are added\n- Uses systemMessage (non-blocking) as this is a reminder, not enforcement\n- Does not overlap with existing hooks",
      "remarks": "- PostToolUse:Edit hookとして発火\n- .claude/scripts/*.pyファイルへの編集時のみ対象",
      "trigger": "PostToolUse",
      "matcher": "Edit"
    },
    {
      "name": "secret_deploy_check",
      "path": ".claude/hooks/handlers/secret_deploy_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に未デプロイのフロントエンドシークレットがないか確認。",
      "keywords": ["deploy", "secret"],
      "why": "フロントエンドシークレット（広告ID等）を更新した場合、\nデプロイしないと本番に反映されない。セッション終了前に確認する。",
      "what": "- セッション終了時（Stopフック）に発火\n- secret-deploy-trigger.pyが作成した追跡ファイルを確認\n- シークレット更新後にCIが成功していなければブロック\n- デプロイ済みなら追跡ファイルをクリア\n\nState:\n- reads: /tmp/claude-secret-updates.json",
      "remarks": "- ブロック型（未デプロイのシークレットがあればブロック）\n- secret-deploy-trigger.pyと連携\n- CI成功確認はGitHub API経由",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "secret_deploy_trigger",
      "path": ".claude/hooks/handlers/secret_deploy_trigger.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "VITE_プレフィックスのシークレット更新を記録。",
      "keywords": ["deploy", "secret", "stop", "trigger", "vite"],
      "why": "フロントエンドのシークレット（VITE_*）を更新した場合、\nデプロイしないと本番に反映されない。Stopフックで確認を促す。",
      "what": "- gh secret set VITE_* コマンドを検出\n- 成功した場合、シークレット名を追跡ファイルに記録\n- Stopフックでデプロイ確認を促す\n\nWhen:\n- PostToolUse（Bashコマンド実行後）\n\nState:\n- writes: /tmp/claude-secret-updates.json",
      "remarks": "- 非ブロック型（記録のみ）\n- VITE_プレフィックスのみ対象（フロントエンドシークレット）\n- Python版: secret_deploy_trigger.py",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "security_bypass_test_reminder",
      "path": ".claude/hooks/handlers/security_bypass_test_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セキュリティガードファイル編集時にバイパステストの追加を促す。",
      "keywords": [
        "always",
        "branch",
        "bypass",
        "color",
        "guard",
        "issue",
        "reminder",
        "rename",
        "security",
        "test"
      ],
      "why": "Issue #1006の振り返りで発見された教訓:\n- branch_rename_guardが--color=alwaysでバイパスできた\n- セキュリティガード実装時は「バイパステスト」を意識すべき",
      "what": "- ガードファイル（*_guard.py, *_block.py, *_check.py）の編集を検出\n- 対応するテストファイルにバイパステストがあるか確認\n- なければ警告メッセージを出力（ブロックはしない）",
      "remarks": "- PreToolUse:Edit/Write hookとして発火\n- 警告のみ、決定はエージェントに委ねる",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "session_end_main_check",
      "path": ".claude/hooks/handlers/session_end_main_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Stop hook to verify main branch is up-to-date at session end.",
      "keywords": ["branch", "date", "end", "hook", "main", "session", "stop", "verify"],
      "why": "",
      "what": "",
      "remarks": "",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_end_worktree_cleanup",
      "path": ".claude/hooks/handlers/session_end_worktree_cleanup.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時のworktree自動クリーンアップ。",
      "keywords": ["cleanup", "end", "session", "worktree"],
      "why": "セッション終了時に、マージ済み/クローズ済みのworktreeを自動的に\nクリーンアップし、現在のworktreeのロックを解除する。",
      "what": "- 現在のworktreeのロック解除（Issue #1315）\n- マージ済み/クローズ済みのworktree削除\n- ロック中や現在作業中のworktreeはスキップ",
      "remarks": "- Stop hookで発火\n- 現在のworktreeは削除しない（ロック解除のみ）\n- Fail-open: エラー時は処理をスキップ\n- Python版: session_end_worktree_cleanup.py",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_file_state_check",
      "path": ".claude/hooks/handlers/session_file_state_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション再開時ファイル状態検証フック（SessionStart）",
      "keywords": ["file", "session", "sessionstart", "state"],
      "why": "セッション再開時にサマリーと実際のファイル状態が乖離していることがある。\nサマリーには「編集完了」と記載されているが、実際は未コミットの場合、\nサマリーを信頼して次のステップに進むと問題が発生する。",
      "what": "- `git status` でuncommitted changesを確認\n- セッション再開時（resume/compact）に未コミット変更があれば警告を表示\n- 直前のコミット内容を表示して整合性確認を促す\n\nState:\n- reads: none (git commandのみ)",
      "remarks": "- 非ブロック型（情報表示のみ）\n- 責務: セッション再開時にファイル状態を検証\n- session-resume-warningは競合警告、こちらはファイル状態検証\n- Python版: session_file_state_check.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "session_handoff_reader",
      "path": ".claude/hooks/handlers/session_handoff_reader.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時に前回の引き継ぎメモを読み込み表示。",
      "keywords": ["claude", "code", "handoff", "reader", "session"],
      "why": "Claude Codeはセッション間で記憶を保持しない。前回の作業状態、\n未対応タスク、教訓を引き継ぐことで、継続性を確保する。",
      "what": "- セッション開始時（SessionStart）に発火\n- .claude/handoff/配下の有効なメモを読み込み\n- 自セッションと他セッションのメモを区別して表示\n- Git状態、オープンPR、ロック中worktreeも表示\n\nState:\n- reads: .claude/handoff/*.json",
      "remarks": "- 非ブロック型（情報表示のみ）\n- session-handoff-writerが生成、本フックが読み込み\n- メモの有効期間は24時間\n- Python版: session_handoff_reader.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "session_handoff_writer",
      "path": ".claude/hooks/handlers/session_handoff_writer.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に引き継ぎメモを生成。",
      "keywords": ["claude", "code", "handoff", "session", "writer"],
      "why": "Claude Codeはセッション間で記憶を保持しない。作業状態、\n未対応タスク、教訓を記録して次のセッションに引き継ぐ。",
      "what": "- セッション終了時（Stop）に発火\n- Git状態、worktree、オープンPRを収集\n- セッションサマリー（ブロック回数等）を抽出\n- ブロック理由から教訓を自動生成\n- .claude/handoff/にセッションIDベースで保存\n\nState:\n- reads: .claude/logs/execution/hook-execution-*.jsonl\n- writes: .claude/handoff/{session_id}.json",
      "remarks": "- 非ブロック型（情報保存のみ）\n- session-handoff-readerが読み込み、本フックが生成\n- 古いファイルは10個まで保持（自動クリーンアップ）",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_issue_integrity_check",
      "path": ".claude/hooks/handlers/session_issue_integrity_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション別Issue追跡データの整合性を検証。",
      "keywords": ["creation", "integrity", "issue", "session", "tracker"],
      "why": "issue-creation-trackerで記録したIssueが正しくファイルに保存されているか\n検証する必要がある。データ損失を早期に検出し、警告する。",
      "what": "- セッション開始時（SessionStart）に発火\n- 過去5セッションのログとファイルを照合\n- 実行ログに記録されたIssueがファイルにも存在するか確認\n- 不一致があればsystemMessageで警告\n\nState:\n- reads: .claude/logs/execution/hook-execution-*.jsonl\n- reads: .claude/logs/flow/session-created-issues-*.json\n- reads: .claude/logs/flow/state-*.json",
      "remarks": "- 非ブロック型（警告のみ）\n- Issue #2003の修正適用前のデータで不整合が発生する可能性\n- Python版: session_issue_integrity_check.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "session_log_compressor",
      "path": ".claude/hooks/handlers/session_log_compressor.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時にローテート済みログを圧縮。",
      "keywords": ["compressor", "gzip", "log", "session"],
      "why": "ログファイルのローテート後、古いファイル（.log.1, .log.2等）が\nディスクを圧迫する。gzip圧縮してストレージを節約する。",
      "what": "- セッション終了時（Stop）に発火\n- execution/とmetrics/のローテート済みログを検索\n- .log.N形式のファイルをgzip圧縮\n- 圧縮した件数をログに記録",
      "remarks": "- 非ブロック型（Stopフック）\n- ローテーション自体はcommon.pyが担当\n- 既に圧縮済み（.gz）のファイルはスキップ",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_marker_refresh",
      "path": ".claude/hooks/handlers/session_marker_refresh.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree内のセッションマーカーのmtimeを定期更新。",
      "keywords": ["marker", "mtime", "refresh", "removal", "session", "worktree"],
      "why": "長時間セッション（30分以上）でマーカーのmtimeが古くなると、\nworktree-removal-checkが「古いセッション」と判断してしまう。\n定期的にmtimeを更新してセッション活性を示す。",
      "what": "- PostToolUse時に発火\n- CWDがworktree内かどうか確認\n- マーカーのmtimeが10分以上古ければtouchで更新\n- 更新が不要なら何もしない（パフォーマンス最適化）\n\nWhen:\n- PostToolUse\n\nState:\n- writes: .worktrees/*\\/.claude-session（mtimeのみ更新）",
      "remarks": "- 非ブロック型（マーカーのtouchのみ）\n- session-marker-updaterはSessionStart時、本フックはPostToolUse\n- 10分間隔でのみ更新（REFRESH_INTERVAL）\n- Python版: session_marker_refresh.py",
      "trigger": "PostToolUse",
      "matcher": ".*"
    },
    {
      "name": "session_marker_updater",
      "path": ".claude/hooks/handlers/session_marker_updater.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にworktree内のセッションマーカーを更新。",
      "keywords": ["guard", "locked", "marker", "session", "updater", "worktree"],
      "why": "既存worktree内でセッションを開始した場合、マーカーが古いセッションIDのまま\nだとlocked-worktree-guardの自己セッションバイパスが機能しない。\n現在のセッションIDで更新する必要がある。",
      "what": "- セッション開始時（SessionStart）に発火\n- CWDがworktree内かどうか確認\n- .claude-sessionファイルを現在のセッションIDで上書き\n\nState:\n- writes: .worktrees/{name}/.claude-session",
      "remarks": "- 非ブロック型（情報書き込みのみ）\n- worktree-creation-markerは新規作成時、本フックは既存worktreeでのセッション開始時\n- session-marker-refreshと連携してマーカーを維持\n- Python版: session_marker_updater.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "session_metrics_collector",
      "path": ".claude/hooks/handlers/session_metrics_collector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッションメトリクス収集フック（Stop）",
      "keywords": ["collector", "metrics", "session", "stop"],
      "why": "セッションの品質を継続的に改善するため、終了時にメトリクスを\n収集して分析可能にする必要がある。",
      "what": "- collect_session_metrics.pyでメトリクス収集\n- session_report_generator.pyでレポート生成\n- ブロックせず、情報収集のみ",
      "remarks": "- SRP: セッション終了時のメトリクス収集のみを担当\n- 既存フックとの重複なし\n- ブロックなし（情報収集のみのため）\n- Python版: session_metrics_collector.py からの移行",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_outcome_collector",
      "path": ".claude/hooks/handlers/session_outcome_collector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に成果物（PR、Issue、コミット）を収集。",
      "keywords": ["collector", "issue", "outcome", "session"],
      "why": "セッションの成果を定量的に記録することで、フック有効性の測定や\n事後分析が可能になる。リアルタイム追跡ではなく結果ベースで評価する。",
      "what": "- セッション終了時（Stop）に発火\n- セッション開始時刻以降のPR作成・マージを収集\n- Issue作成、コミット数を収集\n- 成果物からタスクタイプを推定\n- outcomes/にセッション別で保存\n\nState:\n- reads: .claude/logs/flow/state-*.json（セッション開始時刻）\n- writes: .claude/logs/outcomes/session-outcomes-*.jsonl",
      "remarks": "- 非ブロック型（Stopフック）\n- GitHub API経由でPR/Issueを取得\n- flow_definitions.tsのestimateTaskType()でタスクタイプ推定",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_resume_warning",
      "path": ".claude/hooks/handlers/session_resume_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション再開時に競合状況警告を表示。",
      "keywords": ["continue", "fork", "resume", "session", "warning", "worktree"],
      "why": "--resume/--continue/--fork-sessionでセッションを再開すると、\n元セッションと重複作業してしまうリスクがある。既存worktreeや\nオープンPRの一覧を表示して、競合を早期に認識させる。",
      "what": "- セッション開始時（SessionStart）に発火\n- sourceがresume/compactの場合のみ処理\n- 既存worktree一覧を取得\n- オープンPR一覧を取得\n- 競合リスクの警告メッセージを表示",
      "remarks": "- 非ブロック型（情報表示のみ）\n- session-handoff-readerは引き継ぎ情報、本フックは競合警告\n- fork-session判定はClaudeがコンテキスト内で実施\n- Python版: session_resume_warning.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "session_todo_check",
      "path": ".claude/hooks/handlers/session_todo_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に未完了TODOを検出して警告。",
      "keywords": ["issue", "session", "todo"],
      "why": "未完了のTODOがIssue化されないままセッションが終了すると、\nタスクが忘れられる。セッション終了時に警告することで対応漏れを防ぐ。",
      "what": "- セッション終了時（Stop）に発火\n- transcriptからTodoWriteツール呼び出しを解析\n- 未完了かつIssue参照（#xxx）のないTODOを抽出\n- 該当TODOがあれば警告メッセージを表示",
      "remarks": "- 非ブロック型（警告のみ、セッション終了は許可）\n- Issue参照があるTODOはスキップ（Issue化済みと判断）\n- 5件まで表示し、残りは件数のみ表示\n- Python版: session_todo_check.py",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "session_worktree_status",
      "path": ".claude/hooks/handlers/session_worktree_status.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時に既存worktreeの状況を確認し警告する。",
      "keywords": ["session", "status", "worktree"],
      "why": "別セッションが作業中のworktreeに介入すると、競合やコンフリクトが発生する。\nセッション開始時に既存worktreeの状況を把握することで、問題を未然に防ぐ。",
      "what": "- CWDがworktree内かどうかをチェック\n- 既存worktreeの一覧を取得（git worktree list）\n- 各worktreeの.claude-sessionマーカーを確認\n- 別セッションIDのマーカーがある場合、警告表示\n- 直近1時間以内のコミットがあるworktreeも警告\n- fork-sessionの場合、祖先セッションのworktreeへの介入を禁止警告\n\nState:\nreads: .worktrees/{name}/.claude-session\nreads: .claude/logs/flow/session-created-issues-{session}.json",
      "remarks": "- ブロックせず警告のみ（実際のブロックはworktree-session-guard.tsが担当）\n- fork-session-collaboration-advisorは提案、これは警告\n- Python版: session_worktree_status.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "signature_change_check",
      "path": ".claude/hooks/handlers/signature_change_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Pythonの関数シグネチャ変更時にテスト更新漏れを検出。",
      "keywords": ["change", "python", "signature"],
      "why": "関数の引数や戻り値の型を変更した場合、対応するテストも更新する必要がある。\nテスト更新漏れがあると、CI通過後に実際の動作で問題が発生する。",
      "what": "- git diff でPython関数シグネチャ（引数、戻り値）の変更を検出\n- 対応するテストファイル（test_xxx.py）がコミットに含まれているか確認\n- テストファイル更新がない場合に警告を表示\n- .claude/hooks/ と .claude/scripts/ 配下のファイルを対象\n\nState:\n- reads: git diff output",
      "remarks": "- 非ブロック型（警告のみ、pushは許可）\n- pre-pushフックとして使用可能\n- ファイル名のハイフンはアンダースコアに変換してテストファイル名を推定\n- 制限: 単一行の関数定義のみ検出（複数行定義は未対応）",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "similar_code_check",
      "path": ".claude/hooks/handlers/similar_code_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "新規フック作成時に類似コードを検索して参考情報を提供。",
      "keywords": ["code", "similar"],
      "why": "フック実装時に既存のパターンを知らずに独自実装すると、一貫性が失われ\nレビューで指摘される。類似コードを事前に提示することで品質を向上させる。",
      "what": "- フックファイル（.claude/hooks/*.py, .claude/hooks/*.ts）へのWrite/Edit時に発火\n- 新しい関数定義（def xxx, function xxx）を抽出\n- 既存フックから類似パターン（has_skip_, check_, get_等）を検索\n- 見つかった場合はsystemMessageで参照ファイルを提示",
      "remarks": "- 非ブロック型（情報提供のみ）\n- existing-impl-checkはworktree作成時、本フックはWrite/Edit時\n- 検索パターンは SEARCH_PATTERNS で定義",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "similar_pattern_search",
      "path": ".claude/hooks/handlers/similar_pattern_search.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ後にコードベース内の類似パターンを検索し修正漏れを防ぐ。",
      "keywords": ["dumps", "json", "pattern", "search", "similar"],
      "why": "共通パターン（json.dumps等）を修正する際、同様のパターンが他ファイルに\n存在すると修正漏れが発生する。マージ後に自動検索して警告する。",
      "what": "- PRマージ成功後（PostToolUse:Bash）に発火\n- PR diffから関数呼び出しパターンを抽出\n- 変更されたファイル以外で同パターンを検索\n- 見つかった場合はsystemMessageで通知\n\nState:\n- reads: GitHub API (PR diff, changed files)",
      "remarks": "- 非ブロック型（情報提供のみ）\n- duplicate-issue-checkはIssue重複、本フックはコードパターン重複\n- 一般的すぎる関数（print, len等）はCOMMON_FUNCTIONSで除外",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "skill_failure_detector",
      "path": ".claude/hooks/handlers/skill_failure_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Skill呼び出し失敗を検出して調査・Issue化を促す。",
      "keywords": ["detector", "failure", "issue", "skill"],
      "why": "Skillツールが失敗した場合（ファイル不在等）、手動で回避するだけでは\n根本問題が解決されない。失敗を検出して問題のIssue化を強制する。",
      "what": "- Skillツール実行後（PostToolUse:Skill）に発火\n- ツール結果からエラーパターンを検出\n- 失敗検出時は警告メッセージを表示し、Issue作成を促す\n- worktree削除後の失敗ケースへのヒントも提供",
      "remarks": "- 警告型（ブロックせず、情報提供と行動促進）\n- エラーパターンは isSkillFailure() で定義\n- 問題を手動回避せず、必ずIssue化することを要求",
      "trigger": "PostToolUse",
      "matcher": "Skill"
    },
    {
      "name": "skill_usage_reminder",
      "path": ".claude/hooks/handlers/skill_usage_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "特定操作の前にSkill使用を強制。",
      "keywords": ["reminder", "skill", "usage", "worktree"],
      "why": "worktree作成やPR作成時にSkillの手順を確認せずに進めると、\n推奨手順を見落とす。操作前にSkill使用を強制することで品質を担保する。",
      "what": "- 特定コマンド実行前（PreToolUse:Bash）に発火\n- OPERATION_SKILL_MAPで定義されたコマンドパターンを検出\n- transcriptから当該Skillの使用履歴を確認\n- Skill未使用の場合はブロック",
      "remarks": "- ブロック型フック（Skill未使用時はブロック）\n- managing-development: worktree add, gh pr create, gh pr merge\n- reviewing-code: レビューコメント操作, スレッド解決\n- Python版: skill_usage_reminder.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "skip_review_env_check",
      "path": ".claude/hooks/handlers/skip_review_env_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "SKIP_CODEX_REVIEW/SKIP_GEMINI_REVIEW環境変数の使用を禁止する。",
      "keywords": ["codex", "env", "gemini", "review", "skip"],
      "why": "SKIP環境変数でレビューチェックをバイパスすると、コード品質チェックが\n欠落したままPRがマージされる可能性がある。これはAIレビューを\n「安全網」として期待する悪習慣を助長する。",
      "what": "- git push / gh pr createコマンドを検出\n- SKIP_CODEX_REVIEW または SKIP_GEMINI_REVIEW が設定されていたらブロック\n- 環境変数とインラインの両方をチェック",
      "remarks": "- ブロック型フック（SKIP使用時はブロック）\n- PreToolUse:Bashで発火（git push / gh pr createコマンド）\n- 緊急時の回避策は提供しない（レビュー実行が正しい対応）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "stop_auto_review",
      "path": ".claude/hooks/handlers/stop_auto_review.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に未レビューの変更を検出しレビュー実行を促す。",
      "keywords": ["auto", "review", "stop"],
      "why": "実装完了後にレビューせずセッションを終了すると、動作不備を見逃す。\nセッション終了時に未レビューを検出してレビュー実行を強制する。",
      "what": "- セッション終了時（Stop）に発火\n- main以外のブランチで未プッシュコミットまたは未コミット変更を検出\n- codex reviewの実行履歴を確認\n- 未レビューの場合はセッション終了をブロック\n\nState:\n- reads: .claude/logs/markers/codex-review-*.done\n- writes: {TMPDIR}/claude-hooks/stop-auto-review-*.json（リトライカウント）",
      "remarks": "- ブロック型フック（未レビュー時はセッション終了をブロック）\n- MAX_REVIEW_RETRIES（2回）を超えると自動許可\n- SKIP_STOP_AUTO_REVIEW=1でスキップ可能",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "subprocess_lint_check",
      "path": ".claude/hooks/handlers/subprocess_lint_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Pythonフック内の問題のあるsubprocess使用パターンを検出。",
      "keywords": ["lint", "python", "shell", "subprocess", "true"],
      "why": "shell=Trueはセキュリティリスク、リスト引数でのシェル演算子は動作しない。\nコミット前にこれらの問題を検出して修正を強制する。",
      "what": "- git commit時（PreToolUse:Bash）に発火\n- .claude/hooks/配下のステージ済みPythonファイルを解析\n- shell=True使用、リスト引数内のシェル演算子を検出\n- 問題がある場合はコミットをブロック",
      "remarks": "- ブロック型フック（問題検出時はコミットをブロック）\n- 正規表現ベースでsubprocess.run/call/Popenを検出\n- --jq引数やgit --format内の|はスキップ（Issue #1226）",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "systematization_check",
      "path": ".claude/hooks/handlers/systematization_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時に教訓が仕組み化されたか確認する。",
      "keywords": ["systematization"],
      "why": "教訓をドキュメント化しただけでは、同じ問題が再発する。\nフック/CI/ツールによる仕組み化を強制することで、再発を防止する。",
      "what": "- 教訓パターン検出（教訓、反省点、学び、気づき、lesson learned等）\n- 仕組み化ファイル変更検出（.claude/hooks/*.py、.github/workflows/*.yml等）\n- 教訓あり＆仕組み化なしの場合にブロック\n- 誤検知緩和（複数インジケータ要求、明示的スキップ許可）",
      "remarks": "- problem-report-checkはIssue作成を確認、本フックは仕組み化を確認\n- 強パターン（「仕組み化が必要」等）は単独でもトリガー\n- 「仕組み化しました」等の完了パターンは誤検知として除外\n- Python版: systematization_check.py",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "systematization_issue_close_check",
      "path": ".claude/hooks/handlers/systematization_issue_close_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "仕組み化Issueクローズ時にフック/ツール実装を検証。",
      "keywords": ["close", "issue", "systematization"],
      "why": "「仕組み化」を謳うIssueがドキュメント追加のみでクローズされると、\n強制機構がなく問題が再発する。クローズ前に実装を確認する。",
      "what": "- gh issue close時（PreToolUse:Bash）に発火\n- Issue内容から「仕組み化」系キーワードを検出\n- 関連PRで強制機構ファイル（hooks/workflows/scripts）の変更を確認\n- 強制機構がない場合はクローズをブロック",
      "remarks": "- ブロック型フック（強制機構なしの場合はブロック）\n- systematization-checkはセッション終了時、本フックはIssueクローズ時\n- SKIP_SYSTEMATIZATION_CHECK=1でスキップ可能\n- Python版: systematization_issue_close_check.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "task_start_checklist",
      "path": ".claude/hooks/handlers/task_start_checklist.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "タスク開始時に確認チェックリストをリマインド表示する。",
      "keywords": ["checklist", "start", "task"],
      "why": "タスク開始時に要件・設計の確認を怠ると、実装後の手戻りが発生する。\nチェックリストをリマインドすることで、確認漏れを防ぐ。",
      "what": "- セッションの最初のツール実行時にチェックリストを表示\n- 要件確認、設計判断、影響範囲、前提条件のチェック項目を提示\n- systemMessageで情報提供（ブロックしない）",
      "remarks": "- open-issue-reminderはIssue確認、本フックは要件・設計確認\n- セッションマーカー機構を使用（セッション毎に1回のみ表示）",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "test_deletion_check",
      "path": ".claude/hooks/handlers/test_deletion_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "Python関数/クラス削除時のテスト参照漏れを検出。",
      "keywords": ["deletion", "python", "test"],
      "why": "関数やクラスを削除しても、テストファイルに参照が残っているとCIで失敗する。\nコミット前に参照漏れを検出してブロックすることで、CI失敗を防止する。",
      "what": "- git diffでステージ済みの関数/クラス削除を検出\n- 削除されたシンボルへのテストファイル参照をgit grepで検索\n- 参照が残っている場合はコミットをブロック",
      "remarks": "- pre-commitフックとして使用\n- リファクタリング（同名追加）や移動は除外\n- プライベート関数（_prefix）はスキップ\n- 削除元モジュールからインポートしているテストのみ対象（Issue #1958）",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "tool_efficiency_tracker",
      "path": ".claude/hooks/handlers/tool_efficiency_tracker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ツール呼び出しパターンを追跡し非効率なパターンを検出。",
      "keywords": ["efficiency", "tool", "tracker"],
      "why": "同じファイルの繰り返し読み書きや、同じ検索パターンの重複実行は非効率。\nこれらのパターンを検出して警告することで、作業効率を向上させる。",
      "what": "- 全ツール実行後（PostToolUse）に発火\n- ツール呼び出し履歴をセッション単位で記録\n- 非効率パターンを検出して警告（Read→Edit繰り返し、検索重複等）\n- 検出結果をメトリクスログに記録\n\nState:\n- reads/writes: /tmp/claude-hooks/tool-sequence.json（呼び出し履歴）\n- writes: .claude/logs/metrics/tool-efficiency-metrics.log",
      "remarks": "- 非ブロック型（警告のみ）\n- 10分ウィンドウ内のパターンを検出\n- セッション変更時に履歴リセット",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "tool_substitution_detector",
      "path": ".claude/hooks/handlers/tool_substitution_detector.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "パッケージマネージャの実行とツール代替パターンを追跡。",
      "keywords": ["detector", "substitution", "tool"],
      "why": "ツールが失敗した際に、原因調査せずに別ツールに切り替えると根本問題が\n解決されない。パターンを記録して振り返りで分析できるようにする。",
      "what": "- パッケージマネージャコマンド実行後（PostToolUse:Bash）に発火\n- uvx/npm/pip/brew/cargo等のコマンドを検出\n- 実行結果（成功/失敗）をセッション別ログに記録\n- 振り返り時に代替パターンを分析可能に\n\nState:\n- writes: .claude/logs/metrics/tool-substitution-*.jsonl",
      "remarks": "- 非ブロック型（記録のみ、振り返りで分析）\n- 検出対象はTOOL_PATTERNSで定義",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "ui_check_reminder",
      "path": ".claude/hooks/handlers/ui_check_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "フロントエンド変更時にブラウザ確認を強制。",
      "keywords": ["reminder"],
      "why": "フロントエンドファイル変更後にブラウザ確認せずコミットすると、\nランタイムエラーやUI崩れに気づかないまま本番に反映される。",
      "what": "- git commit時（PreToolUse:Bash）に発火\n- frontend/src/配下のTS/TSX/JSON/CSS変更を検出\n- ブラウザ確認マーカーファイルがなければブロック\n- confirm_ui_check.ts実行後にコミット可能\n\nState:\n- reads: .claude/logs/markers/ui-check-*.done",
      "remarks": "- ブロック型フック（確認なしはコミット不可）\n- main/masterブランチはスキップ\n- .ts/.tsxはlib/hooks/workersも含む（Issue #209）\n- Python版: ui_check_reminder.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "user_feedback_systematization_check",
      "path": ".claude/hooks/handlers/user_feedback_systematization_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ユーザーフィードバック検出時の仕組み化を確認する。",
      "keywords": ["feedback", "systematization", "user"],
      "why": "ユーザーが問題を指摘した場合、その問題の修正だけでなく、\n類似問題を将来検出できる仕組み化が必要。セッション終了時に\n仕組み化されていなければ警告する。",
      "what": "- セッション状態から `user_feedback_detected` フラグを確認\n- フィードバック検出時、仕組み化ファイル変更を検出\n- 仕組み化なしの場合にACTION_REQUIREDを出力",
      "remarks": "- feedback_detector.py がセッション状態に記録\n- systematization_check.py とは別の観点（ユーザー指摘への対応）\n- ブロックではなく警告（exit 0）",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "uv_run_guard",
      "path": ".claude/hooks/handlers/uv_run_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree内でのuv run使用を防止",
      "keywords": ["guard", "pyproject", "run", "toml", "worktree"],
      "why": "worktreeにはpyproject.tomlがシンボリックリンクされないため、\nuv runはエラーになる。事前にブロックして代替コマンドを提示する。",
      "what": "- Bashコマンド実行前（PreToolUse:Bash）に発火\n- cwdが.worktrees/内かを確認\n- uv runコマンドを検出したらブロック\n- 代替としてuvxコマンドを提案",
      "remarks": "- ブロック型フック（worktree内のuv runはブロック）\n- ツール名を抽出してuvx推奨コマンドを提示\n- Python版: uv_run_guard.py",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "vague_action_block",
      "path": ".claude/hooks/handlers/vague_action_block.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "曖昧な対策表現（精神論）を検出してACTION_REQUIRED警告。",
      "keywords": ["action", "block", "required", "vague"],
      "why": "「注意する」「気をつける」「徹底する」といった精神論は再発防止策にならない。\n具体的な仕組み化（フック/CI/スクリプト）を強制することで実効性を担保する。",
      "what": "- セッション終了時（Stop）に発火\n- transcriptから対策文脈の曖昧表現を検出\n- 「守る」「注意」「心がけ」等のパターンをマッチング\n- 曖昧表現があればACTION_REQUIREDで警告",
      "remarks": "- 警告型フック（ACTION_REQUIRED、ブロックはしない）\n- 具体的アクション（Issue作成、フック実装等）があればスキップ\n- systematization-checkは教訓→仕組み化要求、本hookは表現自体を検出\n- Python版: vague_action_block.py",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "workflow_skill_reminder",
      "path": ".claude/hooks/handlers/workflow_skill_reminder.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成・PR作成時にmanaging-development Skillを参照するようリマインド。",
      "keywords": ["development", "managing", "reminder", "skill", "workflow", "worktree"],
      "why": "AIエージェントはセッション間で学習しないため「手順は身についている」は誤り。\n常にSkillを参照することで、手順の見落としを防ぐ。",
      "what": "- Bashコマンド実行前（PreToolUse:Bash）に発火\n- git worktree add / gh pr create を検出\n- managing-development Skill参照のリマインダーを表示\n- チェックリスト付きのメッセージで確認事項を提示",
      "remarks": "- 警告型フック（systemMessage、ブロックしない）\n- hook-change-detectorはフックファイル変更、本フックはワークフロー操作\n- Issue #2387: 「手順が身についている」思考を防止",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "workflow_verifier",
      "path": ".claude/hooks/handlers/workflow_verifier.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "ワークフロー実行を検証するユーティリティモジュール。",
      "keywords": ["verifier", "workflow"],
      "why": "期待されるフック動作と実際の実行結果を比較することで、\nワークフローの進行状況や問題を可視化できる。",
      "what": "- flow_definitions.tsの期待動作とhook-execution.logを比較\n- フェーズごとの進捗状況を算出\n- 予期せぬブロック/承認を検出\n- レポート生成（テキスト/辞書形式）\n\nState:\n- reads: .claude/logs/execution/hook-execution-*.jsonl",
      "remarks": "- フックではなくユーティリティモジュール\n- WorkflowVerifierクラスとverifycurrentSession関数を提供\n- CLIからも実行可能（--session-id, --since, --verbose）",
      "trigger": null,
      "matcher": null
    },
    {
      "name": "worktree_auto_cleanup",
      "path": ".claude/hooks/handlers/worktree_auto_cleanup.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "PRマージ成功後にworktreeを自動削除。",
      "keywords": ["auto", "cleanup", "worktree"],
      "why": "PRマージ後にworktreeが残るとディスク容量を消費し、管理が煩雑になる。\nマージ成功時に自動削除することで、worktree蓄積を防ぐ。",
      "what": "- gh pr merge成功後（PostToolUse:Bash）に発火\n- コマンドまたは出力からPR番号を抽出\n- 対応するブランチのworktreeを検索\n- ロック解除後にworktreeを削除",
      "remarks": "- 自動化型フック（マージ成功後に即座に実行）\n- cwdがworktree内の場合はスキップ（削除不可）\n- merged-worktree-checkはセッション開始時、本フックはマージ直後",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "worktree_auto_setup",
      "path": ".claude/hooks/handlers/worktree_auto_setup.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成成功後にsetup_worktree.shを自動実行。",
      "keywords": ["auto", "pre", "push", "setup", "worktree"],
      "why": "worktree作成後に依存インストールを忘れると、pre-pushフック等が失敗する。\n自動実行することで、依存インストール漏れを防ぐ。",
      "what": "- git worktree add成功後（PostToolUse:Bash）に発火\n- コマンドからworktreeパスを抽出\n- .claude/scripts/setup_worktree.shを実行\n- 結果をsystemMessageで通知",
      "remarks": "- 自動化型フック（worktree作成成功後に即座に実行）\n- setup_worktree.shがプロジェクト種別を自動検出（pnpm/npm等）\n- 失敗時は警告のみ（ブロックしない）",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "worktree_cleanup_suggester",
      "path": ".claude/hooks/handlers/worktree_cleanup_suggester.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション終了時にマージ/クローズ済みPRのworktreeクリーンアップを提案。",
      "keywords": ["cleanup", "suggester", "worktree"],
      "why": "PRがマージ/クローズされた後もworktreeが残ると管理が煩雑になる。\nセッション終了時に提案することで、不要なworktreeの蓄積を防ぐ。",
      "what": "- セッション終了時（Stop）に発火\n- cwdがworktree内かを確認\n- 関連PRの状態（MERGED/CLOSED）をチェック\n- マージ/クローズ済みならクリーンアップ手順を提案",
      "remarks": "- 提案型フック（ブロックせず、systemMessageで案内）\n- ロック中のworktreeはスキップ（別セッション使用中の可能性）\n- worktree-auto-cleanupはマージ直後、本フックはセッション終了時",
      "trigger": "Stop",
      "matcher": null
    },
    {
      "name": "worktree_commit_integrity_check",
      "path": ".claude/hooks/handlers/worktree_commit_integrity_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "セッション開始時にworktree内のコミット整合性をチェック。",
      "keywords": ["commit", "integrity", "issue", "worktree"],
      "why": "セッション引き継ぎ時、worktreeに複数Issueの変更が混在していると\n状態が混乱する。開始時にチェックして問題を早期に警告する。",
      "what": "- セッション開始時（SessionStart）に発火\n- main..HEADのコミット履歴を取得\n- コミットメッセージからIssue番号を抽出\n- 複数Issue混在やマージ済みコミットがあれば警告\n\nState:\n- writes: .claude/logs/flow/worktree-integrity-*.jsonl",
      "remarks": "- 警告型フック（ブロックしない）\n- cwdがworktree外ならスキップ\n- session-worktree-statusは一般警告、本フックはコミット内容分析\n- Python版: worktree_commit_integrity_check.py",
      "trigger": "SessionStart",
      "matcher": null
    },
    {
      "name": "worktree_creation_marker",
      "path": ".claude/hooks/handlers/worktree_creation_marker.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成時にセッションIDをマーカーファイルとして記録する。",
      "keywords": ["creation", "marker", "worktree"],
      "why": "worktreeの所有者（作成セッション）を記録することで、\n別セッションによる誤介入を防止できる。",
      "what": "- git worktree addコマンドの成功を検出\n- 作成されたworktreeにセッションIDを.claude-sessionとして記録\n- worktree-session-guard.pyがこのマーカーを参照\n\nWhen:\n- PostToolUse（Bashコマンド実行後）\n\nState:\n- writes: .worktrees/<name>/.claude-session",
      "remarks": "- ブロックせず情報記録のみ\n- worktree-session-guard.pyと連携（マーカー作成→マーカー検証）\n- JSON形式でsession_idとcreated_atを記録\n- Python版: worktree_creation_marker.py",
      "trigger": "PostToolUse",
      "matcher": "Bash"
    },
    {
      "name": "worktree_main_freshness_check",
      "path": ".claude/hooks/handlers/worktree_main_freshness_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成前にmainブランチが最新か確認。",
      "keywords": ["freshness", "main", "pull", "worktree"],
      "why": "PRマージ後にローカルmainをpullし忘れると、古いコードをベースに\nworktreeが作成される。事前チェックで最新化を強制する。",
      "what": "- git worktree add ... main コマンド実行前（PreToolUse:Bash）に発火\n- worktree内からのworktree作成を検出してブロック（ネスト防止）\n- origin/mainをfetchしてローカルmainと比較\n- 遅れている場合は自動pull、失敗時はブロック",
      "remarks": "- ブロック型フック（mainが古い場合はブロック）\n- git -Cオプションをサポート（worktree内からメインリポジトリ指定可）\n- 自動pullを試行、失敗時のみ手動対応を要求",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "worktree_path_guard",
      "path": ".claude/hooks/handlers/worktree_path_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree作成先が.worktrees/内かを検証。",
      "keywords": ["guard", "path", "worktree", "worktrees"],
      "why": "worktreeがファイルシステム全体に散らばると管理が困難になる。\n.worktrees/に集約することで一覧確認が容易になり、他エージェントとの競合も避けられる。",
      "what": "- git worktree addコマンド実行前（PreToolUse:Bash）に発火\n- パス引数を抽出して.worktrees/配下かを検証\n- 絶対パスや..を使った迂回パスもブロック\n- リポジトリルート以外からの相対パス指定もブロック\n- 正しい使い方を提示",
      "remarks": "- ブロック型フック（.worktrees/外への作成はブロック）\n- worktree-main-freshness-checkはmain最新確認、本フックはパス検証",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "worktree_removal_check",
      "path": ".claude/hooks/handlers/worktree_removal_check.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "worktree削除前にアクティブな作業やcwd衝突を検出。",
      "keywords": ["cwd", "enoent", "removal", "worktree"],
      "why": "別セッション作業中や、cwdが削除対象内にある状態でworktreeを削除すると、\nセッション破損（ENOENT）や作業消失が発生する。削除前に検出してブロックする。",
      "what": "- git worktree remove実行前（PreToolUse:Bash）に発火\n- コマンドからworktreeパスを抽出\n- 別セッションのマーカーファイルを確認（30分以内なら作業中）\n- マージ済みPRがあればcwd/作業チェックをスキップ\n- cwdが削除対象内ならブロック\n- 未コミット変更・最近のコミット・stashがあれば警告\n\nState:\n- reads: .worktrees/<name>/.claude-session",
      "remarks": "- ブロック型フック（危険な削除はブロック）\n- 別セッションチェックは--forceでもバイパス不可\n- マージ済みPRならcwdチェックをスキップ（Issue #1809）\n- SKIP_WORKTREE_CHECK=1で全チェックをバイパス可能",
      "trigger": "PreToolUse",
      "matcher": "Bash"
    },
    {
      "name": "worktree_session_guard",
      "path": ".claude/hooks/handlers/worktree_session_guard.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "別セッションが作業中のworktreeへの誤介入を防止する。",
      "keywords": ["guard", "session", "worktree"],
      "why": "別セッションが作業中のworktreeを編集すると、競合やコンフリクトが発生し、\n両セッションの作業が無駄になる。セッションマーカーで所有権を確認し、\n別セッションのworktreeへの編集をブロックする。",
      "what": "- Edit対象ファイルが.worktrees/配下かチェック\n- 該当worktreeの.claude-sessionマーカーを読む\n- 現在のセッションIDと比較\n- 不一致ならブロック（別セッションが作業中）\n- 一致またはマーカーなしなら許可\n\nState:\nreads: .worktrees/{name}/.claude-session",
      "remarks": "- worktree-creation-marker.pyがマーカー作成、本フックがマーカー検証\n- session-worktree-status.pyは警告、本フックはブロック\n- Python版: worktree_session_guard.py",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    },
    {
      "name": "worktree_warning",
      "path": ".claude/hooks/handlers/worktree_warning.ts",
      "type": "hook",
      "language": "typescript",
      "hook_type": "unknown",
      "summary": "mainブランチでの編集をブロックし、worktreeでの作業を強制する。",
      "keywords": ["main", "warning", "worktree"],
      "why": "mainで直接編集すると競合やレビューなしの変更が発生するリスクがある。\nロック中のworktreeは別セッションが作業中の可能性がある。",
      "what": "- main/masterブランチでEdit/Write時にブロック\n- ロック中worktreeでの編集時に警告\n- worktree作成手順を提示",
      "remarks": "- ブロック型フック（mainでの編集はブロック）\n- .claude/plans/は例外として許可（Issue #844）\n- worktree-session-guardはセッション間競合、本フックはブランチ保護",
      "trigger": "PreToolUse",
      "matcher": "Edit|Write"
    }
  ],
  "scripts": [
    {
      "name": "analyze_api_operations",
      "path": ".claude/scripts/analyze_api_operations.py",
      "type": "script",
      "language": "python",
      "summary": "API操作ログの分析ツールを提供する。",
      "why": "開発ワークフローの洞察を得るため、gh/git APIの\n操作履歴を分析する機能が必要。",
      "what": "- timeline: セッション単位の操作タイムライン表示\n- pr-lifecycle: PR単位のライフサイクル分析\n- issue-lifecycle: Issue単位のライフサイクル分析\n- errors: エラー発生パターンの分析\n- duration-stats: 操作時間の統計\n- summary: 全体サマリー生成\n\nState:\n- reads: .claude/logs/execution/api-operations.jsonl",
      "remarks": "- --since オプションで期間指定（例: 2h, 3d, 1w）\n- --session-id でセッションフィルタリング可能"
    },
    {
      "name": "analyze_false_positives",
      "path": ".claude/scripts/analyze_false_positives.py",
      "type": "script",
      "language": "python",
      "summary": "フック誤検知の分析と改善提案を生成する。",
      "why": "フックの誤検知（false positive）を減らすため、\n評価ログから改善ポイントを抽出する機能が必要。",
      "what": "- load_evaluations(): 評価ログを読み込み\n- analyze_false_positives(): 誤検知パターンを分析\n- generate_suggestions(): 改善提案を生成\n\nState:\n- reads: .claude/logs/metrics/block-evaluations.log",
      "remarks": "- --hook オプションで特定フックにフィルタリング可能\n- 評価ログはblock-evaluator.pyで記録される"
    },
    {
      "name": "analyze_flow_effectiveness",
      "path": ".claude/scripts/analyze_flow_effectiveness.py",
      "type": "script",
      "language": "python",
      "summary": "開発フローの効果を評価・分析する。",
      "why": "フック・ワークフローの改善点を特定するため、\nメトリクスを自動収集し改善提案を生成する機能が必要。",
      "what": "- report: 全体レポート生成\n- weekly: 週次サマリー生成\n- check: 問題検出（CI用）\n- create-issues: 改善Issue自動作成\n\nState:\n- reads: .claude/logs/session/*.jsonl（セッションログ）\n- reads: .claude/logs/metrics/*.log（メトリクス）",
      "remarks": "- worktree内でも本体のログを参照する\n- lib.loggingモジュールを使用してログを読み込む"
    },
    {
      "name": "analyze_fork_tree",
      "path": ".claude/scripts/analyze_fork_tree.py",
      "type": "script",
      "language": "python",
      "summary": "fork-sessionの親子関係を分析・可視化する。",
      "why": "複数のClaude Codeセッション間の関係を把握するため、\ntranscriptからfork-sessionツリーを構築する機能が必要。",
      "what": "- get_project_id(): 現在のプロジェクトIDを取得\n- build_fork_tree(): fork-sessionツリーを構築\n- display_tree(): ツリーを可視化\n\nState:\n- reads: ~/.claude/projects/*/*.jsonl（transcript）",
      "remarks": "- --json オプションでJSON形式出力\n- CLAUDE_PROJECT_DIR環境変数からプロジェクトを推測"
    },
    {
      "name": "analyze_hook_dependencies",
      "path": ".claude/scripts/analyze_hook_dependencies.ts",
      "type": "script",
      "language": "typescript",
      "summary": "フックのlib/依存関係を分析しMermaid図を生成する。",
      "why": "フック間の依存関係を可視化し、\nリファクタリングの影響範囲を把握するため。",
      "what": "- extractImports(): TypeScriptファイルからlib/*インポートを抽出\n- analyzeDependencies(): 全フックの依存関係を分析\n- generateMermaid(): Mermaid図を生成",
      "remarks": "- --output オプションでファイル出力\n- lib/index.tsは除外される\n- TypeScript版フック（.claude/hooks/）を分析"
    },
    {
      "name": "analyze_hook_timing",
      "path": ".claude/scripts/analyze_hook_timing.py",
      "type": "script",
      "language": "python",
      "summary": "フック実行時間を分析する。",
      "why": "フックのパフォーマンスボトルネックを特定し、\n遅いフックを改善するためのデータが必要。",
      "what": "- parse_log_entries(): 実行ログをパース\n- analyze_hooks(): フック実行統計を計算\n- show_slow_hooks(): 遅いフックを表示\n\nState:\n- reads: .claude/logs/session/*/hook-execution-*.jsonl",
      "remarks": "- --top N で上位N件の遅いフックを表示（デフォルト: 10）\n- --slow MS で「遅い」の閾値を指定（デフォルト: 100ms）\n- --session-id でセッションフィルタリング可能"
    },
    {
      "name": "analyze_interrupts",
      "path": ".claude/scripts/analyze_interrupts.py",
      "type": "script",
      "language": "python",
      "summary": "ユーザー中断・バックグラウンド化・ツール拒否を分析する。",
      "why": "ユーザーの不満や改善ポイントを特定するため、\n中断（Escape）、Ctrl+B、ツール拒否を検出・統計化する。",
      "what": "- detect_interrupts(): 中断イベントを検出\n- detect_backgrounds(): バックグラウンド化を検出\n- detect_denials(): ツール拒否を検出\n- generate_summary(): 統計サマリーを生成\n\nState:\n- reads: ~/.claude/projects/*/*.jsonl（transcript）\n- writes: .claude/logs/metrics/interrupts-*.jsonl（--save時）",
      "remarks": "- --all で全セッションを分析\n- --summary で統計サマリーを表示\n- SRP: 中断・バックグラウンド化検出・分析のみを担当"
    },
    {
      "name": "analyze_pattern_data",
      "path": ".claude/scripts/analyze_pattern_data.py",
      "type": "script",
      "language": "python",
      "summary": "パターン検出フック作成のための実データ分析を行う。",
      "why": "フックのパターン設計時に、実際のPR/Issueコメントから\nパターンの有効性を検証するデータが必要。",
      "what": "- search: PR/Issueコメントからパターンを検索\n- analyze: パターンの頻度分析\n- validate: パターンリストの検出率・誤検知率を検証",
      "remarks": "- GitHub CLIを使用してコメントを取得\n- --pattern で正規表現パターンを指定\n- --patterns-file でパターンリストファイルを指定"
    },
    {
      "name": "analyze_review_quality",
      "path": ".claude/scripts/analyze_review_quality.py",
      "type": "script",
      "language": "python",
      "summary": "レビュー品質メトリクスを分析する。",
      "why": "AIレビュワー（Copilot/Codex）の有効性を評価し、\nカテゴリ別の妥当性を分析するため。",
      "what": "- summary: 全体統計を表示\n- --by-reviewer: レビュワー別統計\n- --by-category: カテゴリ別統計\n- --detail: 全レコード詳細表示\n\nState:\n- reads: .claude/logs/metrics/review-quality-*.jsonl",
      "remarks": "- --since/--until で日付フィルタリング可能\n- --json でJSON形式出力\n- lib.loggingモジュールを使用"
    },
    {
      "name": "analyze_session_outcomes",
      "path": ".claude/scripts/analyze_session_outcomes.ts",
      "type": "script",
      "language": "typescript",
      "summary": "セッション成果データを分析する。",
      "why": "セッションの生産性とタスク種別の分布を把握し、\n改善ポイントを特定するため。",
      "what": "- loadOutcomes(): 成果ログを読み込み\n- showSessions(): セッション一覧を表示\n- showSummary(): 統計サマリーを表示\n\nState:\n- reads: .claude/logs/outcomes/session-outcomes.jsonl",
      "remarks": "- --days N で直近N日間にフィルタリング\n- --summary で統計サマリーを表示"
    },
    {
      "name": "analyze_stale_hooks",
      "path": ".claude/scripts/analyze_stale_hooks.py",
      "type": "script",
      "language": "python",
      "summary": "フックの有効性を分析し陳腐化候補を特定する。",
      "why": "不要なフックを特定・削除するため、\n承認率・ブロック頻度・経過時間を分析する。",
      "what": "- get_hook_files(): フックファイル一覧を取得\n- get_file_created_at(): git logから作成日を取得\n- analyze_effectiveness(): 有効性スコアを計算\n- identify_stale(): 陳腐化候補を特定\n\nState:\n- reads: .claude/hooks/*.py (hook files)\n- reads: .claude/logs/execution/hook-execution-*.jsonl",
      "remarks": "- 95%以上の承認率 → 陳腐化候補\n- 4週間以上ブロックなし → 陳腐化候補\n- 90日以上経過 → レビュー推奨\n- metadata.json廃止に伴い、git logから作成日を取得"
    },
    {
      "name": "audit_review_comments",
      "path": ".claude/scripts/audit_review_comments.py",
      "type": "script",
      "language": "python",
      "summary": "マージ済みPRのレビューコメントを監査する。",
      "why": "PreToolUseフックは事前ブロックのみで、GitHub UI操作などでバイパスされた場合は\n検知できない。マージ後に違反を検出する事後監査の仕組みが必要。",
      "what": "- 最近マージされたPRのレビューコメントを検査\n- Claude Code署名付きコメントの違反を検出:\n  1. コミットハッシュ必須: 修正主張にコミットハッシュが含まれているか\n  2. Verified必須: 修正主張に検証内容が含まれているか\n  3. 署名必須: Claude Code署名があるか\n- 違反があればサマリーを出力\n\nState:\n- reads: GitHub API (PRs, review comments)",
      "remarks": "- `gh` CLIが必要\n- --limit で検査対象PR数を指定可能（デフォルト: 10）\n- --json でJSON形式出力\n- --since で日付フィルタリング可能"
    },
    {
      "name": "background_task_logger",
      "path": ".claude/scripts/background_task_logger.py",
      "type": "script",
      "language": "python",
      "summary": "バックグラウンドタスクのログを永続化する。",
      "why": "コンテキスト要約時にバックグラウンドタスクの出力が失われる問題を解決し、\nセッション終了後もログを確認可能にするため。",
      "what": "- log_background_event(): イベントをファイルに記録\n- list_events(): イベント一覧を表示\n- filter_by_session(): セッション別にフィルタリング\n\nState:\n- writes: .claude/logs/background-tasks/events.jsonl",
      "remarks": "- ログローテーション: 10MB、最大5ファイル\n- --session-id, --task, --since でフィルタリング可能\n- SRP: バックグラウンドタスクのログ記録と表示のみを担当"
    },
    {
      "name": "block_evaluator",
      "path": ".claude/scripts/block_evaluator.py",
      "type": "script",
      "language": "python",
      "summary": "フックブロック判断を評価・記録する。",
      "why": "フックの誤検知（false positive）を特定し、\n改善フィードバックループを確立するため。",
      "what": "- list: 直近のブロックイベントを表示\n- evaluate: 特定ブロックを評価（valid/false_positive）\n- summary: 評価サマリーを表示\n\nState:\n- reads: .claude/logs/session/*/hook-execution-*.jsonl\n- writes: .claude/logs/metrics/block-evaluations.log",
      "remarks": "- ブロックIDはタイムスタンプ・フック名・ブランチから生成\n- 評価結果はanalyze_false_positives.pyで分析可能"
    },
    {
      "name": "check_hook_patterns",
      "path": ".claude/scripts/check_hook_patterns.py",
      "type": "script",
      "language": "python",
      "summary": "フック実装パターンの一貫性をチェックする。",
      "why": "PostToolUseフックのtool_result/tool_response両対応や、\n類似フックの存在を検出し、実装漏れを防ぐため。",
      "what": "- PATTERN001: PostToolUseフックでtool_response未対応を検出\n- PATTERN002: 類似フック（同トリガー）の存在を警告\n- PATTERN003: コミット対象と同パターンを持つ他ファイルの漏れを警告",
      "remarks": "- --all で全フックをチェック\n- # hook-pattern-check: skip でスキップ可能"
    },
    {
      "name": "check_hook_test_coverage",
      "path": ".claude/scripts/check_hook_test_coverage.ts",
      "type": "script",
      "language": "typescript",
      "summary": "フックのテストカバレッジをチェックする。",
      "why": "PRで追加・変更されたフックにテストがあるか確認し、\nテスト不足を検出するため。",
      "what": "- getChangedFiles(): PR内の変更ファイルを取得\n- getPythonHookFiles(): Pythonフックファイル一覧を取得\n- getTsHookFiles(): TypeScriptフックファイル一覧を取得\n- checkTestCoverage(): テストファイルの存在を確認",
      "remarks": "- 新規フック: テストファイル必須（なければCI失敗）\n- 既存フック（テストなし）: 警告のみ\n- Python: .claude/hooks/*.py → tests/test_{hook_name}.py\n- TypeScript: .claude/hooks/handlers/*.ts → tests/{hook_name}.test.ts"
    },
    {
      "name": "check_workflow_definitions",
      "path": ".claude/scripts/check_workflow_definitions.py",
      "type": "script",
      "language": "python",
      "summary": "ワークフロー定義の整合性をチェックする。",
      "why": "settings.jsonとflow_definitions.pyの定義漏れを防ぎ、\nフック追加時の一貫性を保証するため。",
      "what": "- extract_hook_names_from_settings(): settings.jsonからフック名を抽出\n- check_consistency(): 定義の整合性を検証\n\nState:\n- reads: .claude/settings.json\n- reads: .claude/hooks/flow_definitions.py",
      "remarks": "- Exit 0: 整合性OK、Exit 1: 不整合検出\n- settings.jsonとEXPECTED_HOOK_BEHAVIORSの双方向チェック"
    },
    {
      "name": "collect_pr_metrics",
      "path": ".claude/scripts/collect_pr_metrics.py",
      "type": "script",
      "language": "python",
      "summary": "PRライフサイクルメトリクスを収集する。",
      "why": "PRのサイクルタイム、レビュー時間、CI時間を分析し、\n開発プロセスの改善ポイントを特定するため。",
      "what": "- collect_pr_metrics(): PRメトリクスを収集\n- collect_recent(): 最近マージされたPRを一括収集\n\nState:\n- reads: GitHub API（gh pr view）\n- writes: .claude/logs/metrics/pr-metrics.jsonl",
      "remarks": "- --recent で直近のマージ済みPRを収集\n- worktree内でも本体のログに書き込む"
    },
    {
      "name": "collect_session_metrics",
      "path": ".claude/scripts/collect_session_metrics.py",
      "type": "script",
      "language": "python",
      "summary": "セッション終了時のメトリクスを収集する。",
      "why": "セッション単位のフック実行統計・成果を記録し、\n改善分析に活用するため。",
      "what": "- collect_metrics(): セッションメトリクスを収集\n- write_metrics(): メトリクスをログファイルに書き込み\n\nState:\n- reads: .claude/logs/session/*/hook-execution-*.jsonl\n- writes: .claude/logs/metrics/session-metrics.jsonl",
      "remarks": "- Stop hookから呼び出される\n- lib.logging.read_session_log_entries()を使用"
    },
    {
      "name": "dependabot_batch_merge",
      "path": ".claude/scripts/dependabot_batch_merge.py",
      "type": "script",
      "language": "python",
      "summary": "Dependabot PRを一括処理する。",
      "why": "複数のDependabot PRを効率的に処理し、\nリベース→CI待機→マージのフローを自動化するため。",
      "what": "- list_dependabot_prs(): オープンなDependabot PRを取得\n- process_pr(): 1つのPRをリベース→CI待機→マージ\n- batch_merge(): 複数PRを順次処理",
      "remarks": "- production-patch → dev-dependencies の順で処理\n- --dry-run でプレビュー\n- --group でグループ指定可能\n- エラー時はスキップして次へ進む"
    },
    {
      "name": "evaluate-issue-decisions",
      "path": ".claude/scripts/evaluate-issue-decisions.py",
      "type": "script",
      "language": "python",
      "summary": "Issue判定の妥当性を評価する。",
      "why": "Issue作成/不作成の判定が適切だったかを後から評価し、\n判定基準の改善に活用するため。",
      "what": "- create判定: Issue状態をGH APIで確認し、NOT_PLANNEDなら不適切判定\n- skip判定: 類似Issueが後から作成されたかを確認\n\nUsage:\n# 直近7日間の判定を評価\npython3 evaluate-issue-decisions.py --days 7\n\n# 特定セッションの判定を評価\npython3 evaluate-issue-decisions.py --session-id \"session-uuid\"\n\n# JSON形式で出力\npython3 evaluate-issue-decisions.py --days 7 --json",
      "remarks": ""
    },
    {
      "name": "extract_reflection_patterns",
      "path": ".claude/scripts/extract_reflection_patterns.py",
      "type": "script",
      "language": "python",
      "summary": "過去のトランスクリプトから振り返りパターンを分析するスクリプト.",
      "why": "reflection_self_check.pyのPERSPECTIVESキーワードが実際にどの程度\nマッチしているかを分析し、キーワード改善に役立てる。\n\nUsage:\npython3 .claude/scripts/extract_reflection_patterns.py --days 7\n\nOutput:\n観点ごとのマッチ統計:\n- マッチしたキーワードとその回数\n- マッチしなかった振り返りセッション",
      "what": "",
      "remarks": ""
    },
    {
      "name": "flow_status",
      "path": ".claude/scripts/flow_status.py",
      "type": "script",
      "language": "python",
      "summary": "セッション内のフロー進捗状況を表示する。",
      "why": "現在のセッションで進行中・未完了のフローを把握し、\n作業の継続性を確保するため。",
      "what": "- get_all_flows(): 全フローの進捗を取得\n- get_incomplete_flows(): 未完了フローを取得\n- display_status(): 進捗状況を表示\n\nState:\n- reads: .claude/logs/session/*/flow-progress-*.jsonl",
      "remarks": "- --all で全フローを表示\n- --json でJSON形式出力\n- デフォルトは未完了フローのみ表示"
    },
    {
      "name": "generate_index",
      "path": ".claude/scripts/generate_index.py",
      "type": "script",
      "language": "python",
      "summary": "開発フローファイルからインデックスを自動生成し、.fdp/に出力する。",
      "why": "FDPの移植性向上のため、各プロジェクトが自己完結したドキュメントを生成する。\ndocstring/Markdown/YAMLから自動的にインデックス情報を抽出し、\nフロー図やカタログも同時に生成する。",
      "what": "1. hooks/*.py - docstringからWhy/What/Remarksを抽出\n2. scripts/*.py - docstringからWhy/What/Remarksを抽出\n3. skills/*/SKILL.md - Markdownから説明を抽出\n4. flow_definitions.py - 開発フェーズ情報を抽出\n5. .fdp/に以下を出力:\n   - index.json（機械処理用）\n   - README.md（機能カタログ）\n   - prompts/（生成・参照用プロンプト）",
      "remarks": "- ASTでPython docstringを抽出\n- 正規表現でMarkdownセクションを抽出\n- settings.jsonからhookトリガー情報を追加\n- flow_definitions.pyからDEVELOPMENT_PHASESを抽出"
    },
    {
      "name": "hook_lint",
      "path": ".claude/scripts/hook_lint.py",
      "type": "script",
      "language": "python",
      "summary": "フック専用のカスタムLintルールを適用する。",
      "why": "フック実装の一貫性を保証し、よくあるミスや\nアンチパターンを検出するため。",
      "what": "- check_parse_hook_input(): json.loads(stdin)の代わりにparse_hook_input()使用を強制\n- check_log_hook_execution(): 引数数を検証\n- check_make_block_result(): 引数数を検証\n- check_except_pass(): except-passブロックにコメント必須\n- check_hardcoded_paths(): /tmp等のハードコードを検出",
      "remarks": "- --check-only でサマリーのみ表示\n- ファイル指定なしで全フックをチェック"
    },
    {
      "name": "migrate_hook_context",
      "path": ".claude/scripts/migrate_hook_context.py",
      "type": "script",
      "language": "python",
      "summary": "フックをHookContextパターンに移行する。",
      "why": "グローバル状態（get_claude_session_id等）を廃止し、\n依存性注入パターン（HookContext）に統一するため。",
      "what": "- is_simple_migration(): 単純移行か判定\n- migrate_file(): ファイルを移行\n- migrate_all(): 全フックを移行",
      "remarks": "- 旧: get_claude_session_id() → 新: ctx.get_session_id()\n- --dry-run でプレビュー\n- ヘルパー関数内での使用は手動移行が必要"
    },
    {
      "name": "pr_merge_workflow",
      "path": ".claude/scripts/pr_merge_workflow.py",
      "type": "script",
      "language": "python",
      "summary": "PRライフサイクル全体を自動化する統合ワークフロー。",
      "why": "Codexレビュー→プッシュ→CI待機→レビュー対応→マージ→worktree削除\nの一連のフローを自動化し、手作業を削減するため。",
      "what": "- run_codex_review(): Codex CLIレビューを実行\n- wait_for_ci(): CI完了を待機\n- handle_reviews(): レビューコメントを処理\n- merge_pr(): PRをマージ\n- cleanup_worktree(): worktreeを削除",
      "remarks": "- --skip-codex, --skip-push, --skip-ci でステップスキップ可能\n- --auto-verify で修正確認を自動化\n- --force で未解決スレッドがあってもマージ"
    },
    {
      "name": "record-issue-decision",
      "path": ".claude/scripts/record-issue-decision.py",
      "type": "script",
      "language": "python",
      "summary": "Issue作成/不作成の判定を記録する。",
      "why": "振り返り等でIssue作成/不作成を判定した際、その判定が適切だったか\nを後から評価するために、判定内容を記録する必要がある。",
      "what": "- create: Issue作成時の判定を記録\n- skip: Issue不作成時の判定を記録\n- 記録はJSONL形式でセッションIDごとに保存\n\nUsage:\n# Issue作成時（issue-creation-tracker.pyから呼び出される）\npython3 record-issue-decision.py create \\\n    --issue-number 1234 \\\n    --problem \"発見した問題\" \\\n    --reason \"作成理由\" \\\n    --severity P2 \\\n    --context reflect \\\n    --session-id \"session-uuid\"\n\n# Issue不作成時（Claude Codeが明示的に実行）\npython3 record-issue-decision.py skip \\\n    --problem \"検討した問題\" \\\n    --reason \"既存ルールでカバー\" \\\n    --context reflect \\\n    --session-id \"session-uuid\"\n\n# 重複の場合\npython3 record-issue-decision.py skip \\\n    --problem \"検討した問題\" \\\n    --reason \"重複\" \\\n    --related-issue 1234 \\\n    --session-id \"session-uuid\"",
      "remarks": ""
    },
    {
      "name": "review_contradiction_check",
      "path": ".claude/scripts/review_contradiction_check.ts",
      "type": "script",
      "language": "typescript",
      "summary": "AIレビューコメントの矛盾可能性を検出する。",
      "why": "同一ファイルの近接行に複数コメントがある場合、\n矛盾の可能性を警告しレビュー品質を向上させるため。",
      "what": "- detectPotentialContradictions(): 矛盾候補を検出\n- formatContradictionWarnings(): 警告メッセージをフォーマット",
      "remarks": "- 10行以内の近接コメントを矛盾候補として検出\n- 意味解析は行わず、人間のレビュー用にフラグのみ\n- ci_monitor_ts から呼び出される"
    },
    {
      "name": "session_report_generator",
      "path": ".claude/scripts/session_report_generator.py",
      "type": "script",
      "language": "python",
      "summary": "セッション終了時に統合レポートを生成する。",
      "why": "セッション単位の活動サマリーを生成し、\n成果と改善点を把握するため。",
      "what": "- collect_session_data(): セッションデータを収集\n- generate_report(): 統合レポートを生成\n\nState:\n- reads: .claude/logs/session/*/hook-execution-*.jsonl\n- writes: .claude/logs/reports/session-{session_id}.md",
      "remarks": "- Stop hookから呼び出される\n- worktree内でも本体のログを参照"
    },
    {
      "name": "session_summary",
      "path": ".claude/scripts/session_summary.py",
      "type": "script",
      "language": "python",
      "summary": "セッション活動サマリーを生成する。",
      "why": "フック実行ログからセッション単位の活動を分析し、\nブロック・トリガー・時間を可視化するため。",
      "what": "- analyze_session(): セッションを分析\n- generate_summary(): サマリーを生成\n- list_sessions(): 最近のセッションを一覧表示\n\nState:\n- reads: .claude/logs/session/*/hook-execution-*.jsonl",
      "remarks": "- --session でセッションID指定\n- --json でJSON形式出力\n- --list で最近のセッション一覧"
    },
    {
      "name": "track_hook_removal_impact",
      "path": ".claude/scripts/track_hook_removal_impact.py",
      "type": "script",
      "language": "python",
      "summary": "フック削除・非推奨化の影響を追跡する。",
      "why": "フック削除後のリグレッションを検出し、\n復元または完全削除の判断材料を提供するため。",
      "what": "- analyze_impact(): 削除後の影響を分析\n- check_related_issues(): 関連Issueを検索\n- check_error_patterns(): エラーパターンを検出\n\nState:\n- reads: .claude/hooks/removal-history.json\n- reads: GitHub Issues/PRs（gh API）",
      "remarks": "- --weeks N で分析期間を指定（デフォルト: 4週間）\n- --hook で特定フックに絞り込み\n- キーワードマッチで関連問題を検出"
    },
    {
      "name": "update_secret",
      "path": ".claude/scripts/update_secret.py",
      "type": "script",
      "language": "python",
      "summary": "GitHub Secretを更新し本番デプロイを実行する。",
      "why": "Secret更新→デプロイ→本番確認の一連の作業を\n自動化し、手作業ミスを防ぐため。",
      "what": "- update_secret(): GitHub Secretを更新\n- trigger_deploy(): デプロイワークフローを起動\n- wait_for_deploy(): デプロイ完了を待機\n- verify_production(): 本番環境を確認",
      "remarks": "- gh CLIがインストール・認証済みであること\n- デプロイタイムアウト: 10分\n- ポーリング間隔: 15秒"
    },
    {
      "name": "check_ts_hook_execution",
      "path": ".claude/scripts/check_ts_hook_execution.sh",
      "type": "script",
      "language": "shell",
      "summary": "TypeScriptフックのBun実行テスト",
      "description": "TypeScriptフックのBun実行テスト  Why: Issue #2933: JSDocコメント内のglob風パターン（*/.）がBunでパースエラーになる問題があった。 構文チェック（typecheck）では検出できず、実際にBunで実行しないと発覚しない。  What: 各TypeScriptフックを実際にBunで実行し、パースエラーがないか確認する。 空の入力（{}）を与えて即座に終了させ、パースが成功することのみを検証。  Usage: ./check_ts_hook_execution.sh [--verbose]  Note: - フックの実行結果（approve/block）は検証しない（パースのみ） - 入力不足によるエラー（decision出力なし）は許容 - Bunのパースエラー（SyntaxError等）は失敗  Skip list: 既知の問題があるフックをスキップするには、SKIP_HOOKS環境変数にカンマ区切りで指定: SKIP_HOOKS=\"branch_rename_guard,checkout_block\" ./check_ts_hook_execution.sh  または .claude/scripts/check_ts_hook_execution_skip.txt にフック名を1行1つで記載"
    },
    {
      "name": "codex_design_review",
      "path": ".claude/scripts/codex_design_review.sh",
      "type": "script",
      "language": "shell",
      "summary": "Codex CLIで設計品質重視のコードレビューを実行する。",
      "description": "Codex CLIで設計品質重視のコードレビューを実行する。  Why: 結合度・凝集度・単一責任原則の観点で 自動コードレビューを行い、設計品質を向上させるため。  What: - codex review: 設計品質観点でレビュー実行 - --security: セキュリティ観点に集中 - --coupling: 結合度観点に集中 - --cohesion: 凝集度観点に集中  Remarks: - design-review-prompt.txtからプロンプトを読み込む - --uncommitted: 未コミット変更をレビュー - --base <branch>: 比較対象ブランチを指定（デフォルト: main）  Changelog: - silenvx/dekita#1500: 設計品質レビュー機能を追加"
    },
    {
      "name": "setup_agent_cli",
      "path": ".claude/scripts/setup_agent_cli.sh",
      "type": "script",
      "language": "shell",
      "summary": "Agent CLI（Gemini/Codex）の初期セットアップ。",
      "description": "Agent CLI（Gemini/Codex）の初期セットアップ。  Why: Gemini/Codex CLIのデフォルト設定を適用し、 404エラー等の初期設定問題を回避するため。  What: - setup_gemini_cli(): Gemini設定ファイルを作成/更新 - verify_gemini_cli(): 動作確認テストを実行 - setup_codex_cli(): Codex CLIの存在確認  Remarks: - Usage: .claude/scripts/setup_agent_cli.sh [--verify] - ~/.gemini/settings.jsonにモデル設定を書き込む - jqがある場合は既存設定を保持して更新  Changelog: - silenvx/dekita#1700: Agent CLIセットアップ機能を追加"
    },
    {
      "name": "setup_worktree",
      "path": ".claude/scripts/setup_worktree.sh",
      "type": "script",
      "language": "shell",
      "summary": "Worktree作成後の自動セットアップ。",
      "description": "Worktree作成後の自動セットアップ。  Why: worktree作成後に依存関係インストール等の初期化を 自動実行し、作業開始までの手順を簡略化するため。  What: - pnpm install: package.json存在時に依存インストール - uvx連携: pyproject.toml存在時はuvxに委譲  Remarks: - Usage: .claude/scripts/setup_worktree.sh <worktree-path> - CI環境変数を自動設定（対話プロンプト抑制） - 相対パスは自動で絶対パスに変換  Changelog: - silenvx/dekita#1170: worktree初期化自動化機能を追加 - silenvx/dekita#1179: 相対パスの絶対パス変換を追加"
    }
  ],
  "skills": [
    {
      "name": "adding-perspectives",
      "path": ".claude/skills/adding-perspectives/SKILL.md",
      "type": "skill",
      "summary": "振り返り観点追加ガイド",
      "description": "--- name: adding-perspectives description: Adds reflection perspectives to detect similar issues in future sessions. Learns from user feedback and systematizes detection. Use when [ACTION_REQUIRED: /adding-perspectives] appears, user points out overlooked issues, or new check criteria are needed. ---"
    },
    {
      "name": "analyzing-trends",
      "path": ".claude/skills/analyzing-trends/SKILL.md",
      "type": "skill",
      "summary": "傾向分析",
      "description": "--- name: analyzing-trends description: Analyzes trends over the past 3 days including fix ratio, NOT_PLANNED Issues, and block patterns to detect systemic problems. Use when /analyzing-trends is invoked or cross-session pattern analysis is needed. ---"
    },
    {
      "name": "applying-standards",
      "path": ".claude/skills/applying-standards/SKILL.md",
      "type": "skill",
      "summary": "コーディング規約",
      "description": "--- name: applying-standards description: Applies coding standards, testing guidelines, linting rules, type checking, and backward compatibility requirements. Use when writing code, running tests, linting, type checking, or ensuring code quality compliance. ---"
    },
    {
      "name": "authoring-skills",
      "path": ".claude/skills/authoring-skills/SKILL.md",
      "type": "skill",
      "summary": "Skill作成ガイド",
      "description": "--- name: authoring-skills description: Guides the user through the end-to-end process of creating high-quality Agent Skills. Enforces evaluation-first design, checks for progressive disclosure compliance, and validates metadata. Use when you need to create a new Skill or refactor an oversized existing Skill. ---"
    },
    {
      "name": "exploring-claude-code",
      "path": ".claude/skills/exploring-claude-code/SKILL.md",
      "type": "skill",
      "summary": "Claude Code機能調査ガイド",
      "description": "--- name: exploring-claude-code description: Explores Claude Code features including Skills, Hooks, Slash Commands, and Subagents. Provides design guidelines for feature proposals. Use when investigating new features, proposing extensions, or confirming design principles. ---"
    },
    {
      "name": "implementing-hooks",
      "path": ".claude/skills/implementing-hooks/SKILL.md",
      "type": "skill",
      "summary": "フックリファレンス",
      "description": "--- name: implementing-hooks description: Provides detailed specifications, design principles, and configuration guides for Claude Code hooks. Use when implementing, modifying, or debugging PreToolUse, PostToolUse, or Stop hooks. ---"
    },
    {
      "name": "managing-development",
      "path": ".claude/skills/managing-development/SKILL.md",
      "type": "skill",
      "summary": "開発ワークフロー",
      "description": "--- name: managing-development description: Manages development workflow using Git Worktree, including PR creation, CI monitoring, and merge procedures. Use when creating worktrees, branches, PRs, monitoring CI, or merging changes. ---"
    },
    {
      "name": "reflecting-sessions",
      "path": ".claude/skills/reflecting-sessions/SKILL.md",
      "type": "skill",
      "summary": "振り返り実行ガイド",
      "description": "--- name: reflecting-sessions description: Reflects on session behavior using the Five Reflections (Gosei) framework, performs self-evaluation, and creates Issues for improvements. Supports log analysis and root cause analysis. Use when session ends, /reflecting-sessions is invoked, or periodic self-assessment is needed. ---"
    },
    {
      "name": "reviewing-code",
      "path": ".claude/skills/reviewing-code/SKILL.md",
      "type": "skill",
      "summary": "コードレビュー対応",
      "description": "--- name: reviewing-code description: Handles AI code reviews from Copilot, Codex, Gemini, and others. Covers comment response, resolution procedures, and merge checklists. Use when reviewing PR comments, responding to AI reviewers, or resolving review threads. ---"
    },
    {
      "name": "simplifying-code",
      "path": ".claude/skills/simplifying-code/SKILL.md",
      "type": "skill",
      "summary": "Code Simplifier",
      "description": "--- name: simplifying-code description: Simplifies and refines code for clarity, consistency, and maintainability while preserving all functionality. Focuses on recently modified code with strict scope limitations. Use when PR creation is blocked by code-simplifier-check or when explicitly requested. ---"
    },
    {
      "name": "troubleshooting",
      "path": ".claude/skills/troubleshooting/SKILL.md",
      "type": "skill",
      "summary": "トラブルシューティング",
      "description": "--- name: troubleshooting description: Provides solutions for common development issues including worktree failures, hook errors, CI failures, and deployment problems. Use when errors occur, commands fail, or unexpected behavior is encountered. ---"
    }
  ],
  "phases": [
    {
      "id": "session_start",
      "name": "セッション開始",
      "description": "セッション開始時の自動フック発動",
      "order": 0,
      "expected_hooks": [
        "date_context_injector",
        "check-lefthook.sh",
        "session_handoff_reader",
        "open_pr_warning",
        "branch_check"
      ],
      "trigger_step": null,
      "completion_step": null
    },
    {
      "id": "pre_check",
      "name": "事前確認",
      "description": "Issue/worktree/PRの確認",
      "order": 1,
      "expected_hooks": [
        "open_issue_reminder",
        "task_start_checklist",
        "research_requirement_check",
        "planning_enforcement",
        "locked_worktree_guard",
        "plan_ai_review"
      ],
      "trigger_step": null,
      "completion_step": "worktree_created"
    },
    {
      "id": "worktree_create",
      "name": "Worktree作成",
      "description": "Issue用worktreeの作成",
      "order": 2,
      "expected_hooks": [
        "worktree_path_guard",
        "orphan_worktree_check",
        "merged_worktree_check",
        "active_worktree_check",
        "issue_auto_assign",
        "development_workflow_tracker",
        "git_operations_tracker",
        "flow_progress_tracker",
        "worktree_main_freshness_check"
      ],
      "trigger_step": "worktree_created",
      "completion_step": "worktree_created"
    },
    {
      "id": "implementation",
      "name": "実装",
      "description": "コード編集・変更",
      "order": 3,
      "expected_hooks": [
        "worktree_warning",
        "empty_return_check",
        "ui_check_reminder",
        "dependency_check_reminder",
        "hooks_design_check",
        "rework_tracker",
        "tool_efficiency_tracker",
        "exploration_tracker",
        "research_tracker"
      ],
      "trigger_step": "worktree_created",
      "completion_step": "committed"
    },
    {
      "id": "pre_commit_check",
      "name": "コミット前検証",
      "description": "lint/test/typecheckの実行",
      "order": 4,
      "expected_hooks": [
        "python_lint_check",
        "existing_impl_check",
        "bash_failure_tracker",
        "e2e_test_check",
        "e2e_test_recorder"
      ],
      "trigger_step": "implementation",
      "completion_step": "committed"
    },
    {
      "id": "local_ai_review",
      "name": "ローカルAIレビュー",
      "description": "codex reviewの実行",
      "order": 5,
      "expected_hooks": ["codex_review_logger", "codex_review_output_logger"],
      "trigger_step": "committed",
      "completion_step": "pushed"
    },
    {
      "id": "pr_create",
      "name": "PR作成",
      "description": "PRの作成とレビュー依頼",
      "order": 6,
      "expected_hooks": [
        "codex_review_check",
        "pr_scope_check",
        "closes_keyword_check",
        "closes_validation",
        "pr_issue_assign_check",
        "pr_overlap_check",
        "pr_issue_alignment_check",
        "pr_metrics_collector"
      ],
      "trigger_step": "pushed",
      "completion_step": "pr_created"
    },
    {
      "id": "issue_work",
      "name": "Issue作成",
      "description": "問題発見時のIssue作成",
      "order": 7,
      "expected_hooks": ["issue_label_check", "issue_scope_check", "issue_creation_tracker"],
      "trigger_step": null,
      "completion_step": null
    },
    {
      "id": "ci_review",
      "name": "CI監視+レビュー対応",
      "description": "CI完了待ちとレビューコメント対応",
      "order": 8,
      "expected_hooks": [
        "ci_wait_check",
        "ci_recovery_tracker",
        "copilot_review_retry_suggestion",
        "issue_comments_check",
        "issue_review_response_check",
        "recurring_problem_block",
        "reflection_reminder"
      ],
      "trigger_step": "pr_created",
      "completion_step": "ci_passed"
    },
    {
      "id": "merge",
      "name": "マージ",
      "description": "PRのマージ",
      "order": 9,
      "expected_hooks": [
        "merge_check",
        "reviewer_removal_check",
        "force_push_guard",
        "issue_incomplete_close_check",
        "worktree_auto_cleanup",
        "pr_merge_pull_reminder",
        "resolve_thread_guard"
      ],
      "trigger_step": "ci_passed",
      "completion_step": "merged"
    },
    {
      "id": "cleanup",
      "name": "クリーンアップ",
      "description": "worktree削除とmain pull",
      "order": 10,
      "expected_hooks": ["worktree_removal_check"],
      "trigger_step": "merged",
      "completion_step": "cleaned_up"
    },
    {
      "id": "production",
      "name": "本番確認",
      "description": "本番環境でのデプロイ確認",
      "order": 11,
      "expected_hooks": ["production_url_warning", "secret_deploy_trigger"],
      "trigger_step": "merged",
      "completion_step": null
    },
    {
      "id": "session_end",
      "name": "セッション終了",
      "description": "セッション終了時の評価・振り返り",
      "order": 12,
      "expected_hooks": [
        "hook_effectiveness_evaluator",
        "hook_behavior_evaluator",
        "session_metrics_collector",
        "session_handoff_writer",
        "secret_deploy_check",
        "cwd_check",
        "git_status_check",
        "related_task_check",
        "problem_report_check",
        "systematization_check",
        "flow_effect_verifier",
        "reflection_prompt",
        "worktree_cleanup_suggester",
        "session_end_worktree_cleanup"
      ],
      "trigger_step": null,
      "completion_step": null
    }
  ],
  "docs": [
    {
      "name": "AGENTS",
      "path": "AGENTS.md",
      "type": "doc",
      "format": "markdown",
      "summary": "AGENTS.md",
      "description": "AIコーディングエージェント向けのプロジェクト指示。"
    },
    {
      "name": "lefthook",
      "path": "lefthook.yml",
      "type": "config",
      "format": "yaml",
      "summary": "Git hooks configuration (lefthook)"
    }
  ]
}
